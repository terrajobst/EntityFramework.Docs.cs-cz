---
title: Zlepšuje výkon při spouštění pomocí technologie NGen – EF6
author: divega
ms.date: 2016-10-23
ms.prod: entity-framework
ms.author: divega
ms.manager: avickers
ms.technology: entity-framework-6
ms.topic: article
ms.assetid: dc6110a0-80a0-4370-8190-cea942841cee
caps.latest.revision: 4
ms.openlocfilehash: cffd2deea3148a16ed704d1e5e7b365eda06f72b
ms.sourcegitcommit: bdd06c9a591ba5e6d6a3ec046c80de98f598f3f3
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/10/2018
ms.locfileid: "37949048"
---
# <a name="improving-startup-performance-with-ngen"></a><span data-ttu-id="82f65-102">Zlepšuje výkon při spouštění pomocí technologie NGen</span><span class="sxs-lookup"><span data-stu-id="82f65-102">Improving startup performance with NGen</span></span>
> [!NOTE]
> <span data-ttu-id="82f65-103">**EF6 a vyšší pouze** – funkce rozhraní API, atd. popsané na této stránce se zavedly v Entity Framework 6.</span><span class="sxs-lookup"><span data-stu-id="82f65-103">**EF6 Onwards Only** - The features, APIs, etc. discussed in this page were introduced in Entity Framework 6.</span></span> <span data-ttu-id="82f65-104">Pokud používáte starší verzi, některé nebo všechny informace neplatí.</span><span class="sxs-lookup"><span data-stu-id="82f65-104">If you are using an earlier version, some or all of the information does not apply.</span></span>  

<span data-ttu-id="82f65-105">Rozhraní .NET Framework podporuje generování nativních bitových kopií pro spravované aplikace a knihovny jako způsob, jak pomoci rychleji spouštět aplikace a také v některých případech použijte méně paměti.</span><span class="sxs-lookup"><span data-stu-id="82f65-105">The .NET Framework supports the generation of native images for managed applications and libraries as a way to help applications start faster and also in some cases use less memory.</span></span> <span data-ttu-id="82f65-106">Nativní bitové kopie jsou vytvořeny pomocí překladu sestavení spravovaného kódu do souborů před spuštěním aplikace, který obsahuje nativních strojové instrukce homogenního .NET JIT (Just-In-Time) kompilátorem by bylo nutné generovat nativní pokynů na adrese Doba spuštění aplikace.</span><span class="sxs-lookup"><span data-stu-id="82f65-106">Native images are created by translating managed code assemblies into files containing native machine instructions before the application is executed, relieving the .NET JIT (Just-In-Time) compiler from having to generate the native instructions at application runtime.</span></span>  

<span data-ttu-id="82f65-107">Starší než verze 6 knihovny EF runtime core byly součástí rozhraní .NET Framework a nativní bitové kopie byly automaticky generovány pro ně.</span><span class="sxs-lookup"><span data-stu-id="82f65-107">Prior to version 6, the EF runtime’s core libraries were part of the .NET Framework and native images were generated automatically for them.</span></span> <span data-ttu-id="82f65-108">Od verze 6 celý modul runtime EF byl sloučen do balíčku NuGet objektu EntityFramework.</span><span class="sxs-lookup"><span data-stu-id="82f65-108">Starting with version 6 the whole EF runtime has been combined into the EntityFramework NuGet package.</span></span> <span data-ttu-id="82f65-109">Nativní bitové kopie do tohoto okamžiku se vygenerovaly pomocí příkazového řádku nástroje NGen.exe získat podobné výsledky.</span><span class="sxs-lookup"><span data-stu-id="82f65-109">Native images have to now be generated using the NGen.exe command line tool to obtain similar results.</span></span>  

<span data-ttu-id="82f65-110">Empirických pozorování ukazují, že můžete vyjmout nativní bitové kopie sestavení modulu runtime EF mezi 1 a 3 sekund dobu spuštění aplikace.</span><span class="sxs-lookup"><span data-stu-id="82f65-110">Empirical observations show that native images of the EF runtime assemblies can cut between 1 and 3 seconds of application startup time.</span></span>  

## <a name="how-to-use-ngenexe"></a><span data-ttu-id="82f65-111">Jak používat NGen.exe</span><span class="sxs-lookup"><span data-stu-id="82f65-111">How to use NGen.exe</span></span>  

<span data-ttu-id="82f65-112">Většina základních funkcí nástroj NGen.exe je "instalaci" (to znamená, že pro vytvoření a uložení na disk) nativních bitových kopií pro sestavení a všechny její závislosti s přímým přístupem.</span><span class="sxs-lookup"><span data-stu-id="82f65-112">The most basic function of the NGen.exe tool is to “install” (that is, to create and persist to disk) native images for an assembly and all its direct dependencies.</span></span> <span data-ttu-id="82f65-113">Tady je způsob, který můžete dosáhnout:</span><span class="sxs-lookup"><span data-stu-id="82f65-113">Here is how you can achieve that:</span></span>  

1. <span data-ttu-id="82f65-114">Otevřete okno příkazového řádku jako správce</span><span class="sxs-lookup"><span data-stu-id="82f65-114">Open a Command Prompt window as an administrator</span></span>  
2. <span data-ttu-id="82f65-115">Změňte aktuální pracovní adresář na umístění sestavení, kterou chcete vygenerovat nativních bitových kopií pro:</span><span class="sxs-lookup"><span data-stu-id="82f65-115">Change the current working directory to the location of the assemblies you want to generate native images for:</span></span>  

  ``` console
    cd <*Assemblies location*>  
  ```
3. <span data-ttu-id="82f65-116">V závislosti na operačním systému a konfigurace aplikace může potřebovat ke generování nativních bitových kopií pro 32bitovou architekturu 64bitovou architekturu nebo oba systémy.</span><span class="sxs-lookup"><span data-stu-id="82f65-116">Depending on your operating system and the application’s configuration you might need to generate native images for 32 bit architecture, 64 bit architecture or for both.</span></span>  

    <span data-ttu-id="82f65-117">Pro 32bitové spustit:</span><span class="sxs-lookup"><span data-stu-id="82f65-117">For 32 bit run:</span></span>  
  ``` console
    %WINDIR%\Microsoft.NET\Framework\v4.0.30319\ngen install <Assembly name>  
  ```
    <span data-ttu-id="82f65-118">Pro 64bitový spustit:</span><span class="sxs-lookup"><span data-stu-id="82f65-118">For 64 bit run:</span></span>
  ``` console
    %WINDIR%\Microsoft.NET\Framework64\v4.0.30319\ngen install <Assembly name>  
  ```

> [!TIP]
> <span data-ttu-id="82f65-119">Generování nativních bitových kopií pro chybný architekturu je velmi běžné chyby.</span><span class="sxs-lookup"><span data-stu-id="82f65-119">Generating native images for the wrong architecture is a very common mistake.</span></span> <span data-ttu-id="82f65-120">Pokud máte pochybnosti můžete jednoduše generování nativních bitových kopií pro všechny architektury, které platí pro operační systém nainstalovaný na počítači.</span><span class="sxs-lookup"><span data-stu-id="82f65-120">When in doubt you can simply generate native images for all the architectures that apply to the operating system installed in the machine.</span></span>  

<span data-ttu-id="82f65-121">NGen.exe podporuje také další funkce, jako je například odinstalace a zobrazení nainstalovaných nativní bitové kopie, služby Řízení front generování více imagí, atd. Podrobnosti o použití najdete [NGen.exe dokumentaci](https://msdn.microsoft.com/library/6t9t5wcf.aspx).</span><span class="sxs-lookup"><span data-stu-id="82f65-121">NGen.exe also supports other functions such as uninstalling and displaying the installed native images, queuing the generation of multiple images, etc. For more details of usage read the [NGen.exe documentation](https://msdn.microsoft.com/library/6t9t5wcf.aspx).</span></span>  

## <a name="when-to-use-ngenexe"></a><span data-ttu-id="82f65-122">Kdy použít NGen.exe</span><span class="sxs-lookup"><span data-stu-id="82f65-122">When to use NGen.exe</span></span>  

<span data-ttu-id="82f65-123">Pokud jde o rozhodnout, která sestavení pro generování nativních bitových kopií pro aplikace založené na EF verze 6 nebo novější, je třeba zvážit následující možnosti:</span><span class="sxs-lookup"><span data-stu-id="82f65-123">When it comes to decide which assemblies to generate native images for in an application based on EF version 6 or greater, you should consider the following options:</span></span>  

- <span data-ttu-id="82f65-124">**Hlavní EF sestavení modulu runtime, EntityFramework.dll**: Typická aplikace EF na základě spustí značné množství kódu z tohoto sestavení při spuštění nebo na jeho první přístup k databázi.</span><span class="sxs-lookup"><span data-stu-id="82f65-124">**The main EF runtime assembly, EntityFramework.dll**: A typical EF based application executes a significant amount of code from this assembly on startup or on its first access to the database.</span></span> <span data-ttu-id="82f65-125">Vytvoření nativní bitové kopie tohoto sestavení. v důsledku toho vytvoří největší nárůst výkon při spuštění.</span><span class="sxs-lookup"><span data-stu-id="82f65-125">Consequently, creating native images of this assembly will produce the biggest gains in startup performance.</span></span>  
- <span data-ttu-id="82f65-126">**Jakékoli sestavení zprostředkovatele na EF používaný vaší aplikací**: spuštění také využívají výhod mírně generování nativních bitových kopií z nich.</span><span class="sxs-lookup"><span data-stu-id="82f65-126">**Any EF provider assembly used by your application**: Startup time can also benefit slightly from generating native images of these.</span></span> <span data-ttu-id="82f65-127">Například pokud aplikace používá zprostředkovatele EF pro SQL Server můžete ke generování nativních bitových kopií pro EntityFramework.SqlServer.dll.</span><span class="sxs-lookup"><span data-stu-id="82f65-127">For example, if the application uses the EF provider for SQL Server you will want to generate a native image for EntityFramework.SqlServer.dll.</span></span>  
- <span data-ttu-id="82f65-128">**Sestavení vaší aplikace a další závislosti**: [NGen.exe dokumentaci](https://msdn.microsoft.com/library/6t9t5wcf.aspx) popisuje obecná kritéria pro výběr sestavení pro generování nativních bitových kopií pro a dopad na zabezpečení, nativní bitové kopie Rozšířené možnosti, jako například "Pevná vazba" scénáře, jako je třeba použití nativních bitových kopií při ladění a profilování scénáře atd.</span><span class="sxs-lookup"><span data-stu-id="82f65-128">**Your application’s assemblies and other dependencies**: The [NGen.exe documentation](https://msdn.microsoft.com/library/6t9t5wcf.aspx) covers general criteria for choosing which assemblies to generate native images for and the impact of native images on security, advanced options such as “hard binding”, scenarios such as using native images in debugging and profiling scenarios, etc.</span></span>  

> [!TIP]
> <span data-ttu-id="82f65-129">Ujistěte se, že pečlivě měřit dopad na výkon při spouštění a celkového výkonu aplikace pomocí nativních bitových kopií a porovnání skutečné požadavky.</span><span class="sxs-lookup"><span data-stu-id="82f65-129">Make sure you carefully measure the impact of using native images on both the startup performance and the overall performance of your application and compare them against actual requirements.</span></span> <span data-ttu-id="82f65-130">Zatímco nativní bitové kopie obvykle pomůže zvýšit výkon spuštění a v některých případech omezit využití paměti, bude rovnoměrně přínosem pro všechny scénáře.</span><span class="sxs-lookup"><span data-stu-id="82f65-130">While native images will generally help improve startup up performance and in some cases reduce memory usage, not all scenarios will benefit equally.</span></span> <span data-ttu-id="82f65-131">Například na stálé spuštění (po všechny metody, které používá aplikaci alespoň jednou vyvolání) kód generovaný kompilátorem JIT může ve skutečnosti přinést mírně vyšší výkon než nativní bitové kopie.</span><span class="sxs-lookup"><span data-stu-id="82f65-131">For instance, on steady state execution (that is, once all the methods being used by the application have been invoked at least once) code generated by the JIT compiler can in fact yield slightly better performance than native images.</span></span>  

## <a name="using-ngenexe-in-a-development-machine"></a><span data-ttu-id="82f65-132">Pomocí NGen.exe ve vývojovém počítači</span><span class="sxs-lookup"><span data-stu-id="82f65-132">Using NGen.exe in a development machine</span></span>  

<span data-ttu-id="82f65-133">Při vývoji v .NET JIT kompilátoru nabídne doporučené celkové kompromis pro kód, který se často mění.</span><span class="sxs-lookup"><span data-stu-id="82f65-133">During development the .NET JIT compiler will offer the best overall tradeoff for code that is changing frequently.</span></span> <span data-ttu-id="82f65-134">Generování nativních bitových kopií pro kompilované závislosti, jako jsou sestavení modulu runtime EF pomáhá urychlit vývoj a testování pomocí cutting pár sekund navýšení kapacity na začátku každé spuštění.</span><span class="sxs-lookup"><span data-stu-id="82f65-134">Generating native images for compiled dependencies such as the EF runtime assemblies can help accelerate development and testing by cutting a few seconds out at the beginning of each execution.</span></span>  

<span data-ttu-id="82f65-135">Je vhodné místo, kde můžete najít sestavení modulu runtime EF umístění balíčku NuGet pro řešení.</span><span class="sxs-lookup"><span data-stu-id="82f65-135">A good place to find the EF runtime assemblies is the NuGet package location for the solution.</span></span> <span data-ttu-id="82f65-136">Pro aplikaci pomocí EF 6.0.2 s SQL serverem a cílit na rozhraní .NET 4.5 nebo vyšší můžete například zadat následující, v okně příkazového řádku (nezapomeňte ho spusťte jako správce):</span><span class="sxs-lookup"><span data-stu-id="82f65-136">For example, for an application using EF 6.0.2 with SQL Server and targeting .NET 4.5 or greater you can type the following in a Command Prompt window (remember to open it as an administrator):</span></span>  

``` console
cd <Solution directory>\packages\EntityFramework.6.0.2\lib\net45
%WINDIR%\Microsoft.NET\Framework\v4.0.30319\ngen install EntityFramework.SqlServer.dll
%WINDIR%\Microsoft.NET\Framework64\v4.0.30319\ngen install EntityFramework.SqlServer.dll
```  

> [!NOTE]
> <span data-ttu-id="82f65-137">Toto využívá skutečnost, že instalaci nativních bitových kopií pro EF zprostředkovatele pro SQL Server také ve výchozím nastavení nainstaluje nativních bitových kopií pro hlavní sestavení modulu runtime EF.</span><span class="sxs-lookup"><span data-stu-id="82f65-137">This takes advantage of the fact that installing the native images for EF provider for SQL Server will also by default install the native images for the main EF runtime assembly.</span></span> <span data-ttu-id="82f65-138">Tento postup funguje, protože NGen.exe lze zjistit, že EntityFramework.dll přímou závislost sestavení EntityFramework.SqlServer.dll nachází ve stejném adresáři.</span><span class="sxs-lookup"><span data-stu-id="82f65-138">This works because NGen.exe can detect that EntityFramework.dll is a direct dependency of the EntityFramework.SqlServer.dll assembly located in the same directory.</span></span>  

## <a name="creating-native-images-during-setup"></a><span data-ttu-id="82f65-139">Během instalace vytváření nativních obrázků</span><span class="sxs-lookup"><span data-stu-id="82f65-139">Creating native images during setup</span></span>  

<span data-ttu-id="82f65-140">Podporuje se sadou nástrojů WiX služby Řízení front generování nativních bitových kopií pro spravovaná sestavení během instalace, jak je popsáno v tomto [Příručka](http://wixtoolset.org/documentation/manual/v3/howtos/files_and_registry/ngen_managed_assemblies.html).</span><span class="sxs-lookup"><span data-stu-id="82f65-140">The WiX Toolkit supports queuing the generation of native images for managed assemblies during setup, as explained in this [how-to guide](http://wixtoolset.org/documentation/manual/v3/howtos/files_and_registry/ngen_managed_assemblies.html).</span></span> <span data-ttu-id="82f65-141">Další možností je vytvořit vlastní nastavení úkol, který spustíte příkaz NGen.exe.</span><span class="sxs-lookup"><span data-stu-id="82f65-141">Another alternative is to create a custom setup task that execute the NGen.exe command.</span></span>  

## <a name="verifying-that-native-images-are-being-used-for-ef"></a><span data-ttu-id="82f65-142">Ověřuje se, že se nativní bitové kopie slouží pro EF</span><span class="sxs-lookup"><span data-stu-id="82f65-142">Verifying that native images are being used for EF</span></span>  

<span data-ttu-id="82f65-143">Můžete ověřit, že konkrétní aplikace používá nativní sestavení tím, že hledají načtená sestavení, které mají příponu ". ni.dll"nebo". ni.exe".</span><span class="sxs-lookup"><span data-stu-id="82f65-143">You can verify that a specific application is using a native assembly by looking for loaded assemblies that have the extension “.ni.dll” or “.ni.exe”.</span></span> <span data-ttu-id="82f65-144">Například nativní bitovou kopii pro sestavení EF hlavní modul runtime zavolá se EntityFramework.ni.dll.</span><span class="sxs-lookup"><span data-stu-id="82f65-144">For example, a native image for the EF’s main runtime assembly will be called EntityFramework.ni.dll.</span></span> <span data-ttu-id="82f65-145">Snadný způsob, jak kontrolovat načtená sestavení .NET procesu je použití [Process Explorer](https://technet.microsoft.com/sysinternals/bb896653).</span><span class="sxs-lookup"><span data-stu-id="82f65-145">An easy way to inspect the loaded .NET assemblies of a process is to use [Process Explorer](https://technet.microsoft.com/sysinternals/bb896653).</span></span>  

## <a name="other-things-to-be-aware-of"></a><span data-ttu-id="82f65-146">Je dobré mít na paměti</span><span class="sxs-lookup"><span data-stu-id="82f65-146">Other things to be aware of</span></span>  

<span data-ttu-id="82f65-147">**Vytváření nativních bitových kopií sestavení, neměly by být zaměňovány s registrací v sestavení [GAC (Global Assembly Cache)](https://msdn.microsoft.com/library/yf1d93sz.aspx)**.</span><span class="sxs-lookup"><span data-stu-id="82f65-147">**Creating a native image of an assembly should not be confused with registering the assembly in the [GAC (Global Assembly Cache)](https://msdn.microsoft.com/library/yf1d93sz.aspx)**.</span></span> <span data-ttu-id="82f65-148">NGen.exe umožňuje vytváření bitových kopií sestavení, které nejsou v mezipaměti GAC, a ve skutečnosti více aplikací, které používají určité verze EF můžou sdílet stejné nativních bitových kopií.</span><span class="sxs-lookup"><span data-stu-id="82f65-148">NGen.exe allows creating images of assemblies that are not in the GAC, and in fact, multiple applications that use a specific version of EF can share the same native image.</span></span> <span data-ttu-id="82f65-149">Když Windows 8 může automaticky vytvářet nativní bitové kopie pro sestavení, které jsou umístěny v mezipaměti GAC, modul runtime EF je optimalizována pro se nasadí společně s vaší aplikací a nedoporučujeme registrace v mezipaměti GAC, jak to nemá negativní vliv na sestavení řešení a Údržba aplikací mezi další aspekty.</span><span class="sxs-lookup"><span data-stu-id="82f65-149">While Windows 8 can automatically create native images for assemblies placed in the GAC, the EF runtime is optimized to be deployed alongside your application and we do not recommend registering it in the GAC as this has a negative impact on assembly resolution and servicing your applications among other aspects.</span></span>  
