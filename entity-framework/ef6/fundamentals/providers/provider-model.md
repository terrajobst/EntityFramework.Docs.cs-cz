---
title: Model poskytovatele Entity Framework 6 – EF6
author: divega
ms.date: 06/27/2018
ms.assetid: 066832F0-D51B-4655-8BE7-C983C557E0E4
ms.openlocfilehash: 8bda3f51e8934f2add862c30e60f1185f068c515
ms.sourcegitcommit: cc0ff36e46e9ed3527638f7208000e8521faef2e
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/06/2020
ms.locfileid: "78419358"
---
# <a name="the-entity-framework-6-provider-model"></a><span data-ttu-id="1ee93-102">Model poskytovatele Entity Framework 6</span><span class="sxs-lookup"><span data-stu-id="1ee93-102">The Entity Framework 6 provider model</span></span>

<span data-ttu-id="1ee93-103">Model poskytovatele Entity Framework povoluje použití Entity Framework s různými typy databázového serveru.</span><span class="sxs-lookup"><span data-stu-id="1ee93-103">The Entity Framework provider model allows Entity Framework to be used with different types of database server.</span></span> <span data-ttu-id="1ee93-104">Například jeden poskytovatel může být napájen do sítě, aby bylo možné použít EF pro Microsoft SQL Server, zatímco jiný poskytovatel může být připojen do, aby bylo možné použít EF v Microsoft SQL Server Compact Edition.</span><span class="sxs-lookup"><span data-stu-id="1ee93-104">For example, one provider can be plugged in to allow EF to be used against Microsoft SQL Server, while another provider can be plugged into to allow EF to be used against Microsoft SQL Server Compact Edition.</span></span> <span data-ttu-id="1ee93-105">Poskytovatelé pro EF6, o kterých jsme se dozvěděli, najdete na stránce [poskytovatelé Entity Framework](~/ef6/fundamentals/providers/index.md) .</span><span class="sxs-lookup"><span data-stu-id="1ee93-105">The providers for EF6 that we are aware of can be found on the [Entity Framework providers](~/ef6/fundamentals/providers/index.md) page.</span></span>

<span data-ttu-id="1ee93-106">Byly vyžadovány určité změny, jak EF spolupracuje s poskytovateli, aby bylo možné vydat EF v rámci licence Open Source.</span><span class="sxs-lookup"><span data-stu-id="1ee93-106">Certain changes were required to the way EF interacts with providers to allow EF to be released under an open source license.</span></span> <span data-ttu-id="1ee93-107">Tyto změny vyžadují nové sestavení zprostředkovatelů EF proti sestavením EF6 spolu s novými mechanismy pro registraci zprostředkovatele.</span><span class="sxs-lookup"><span data-stu-id="1ee93-107">These changes require rebuilding of EF providers against the EF6 assemblies together with new mechanisms for registration of the provider.</span></span>

## <a name="rebuilding"></a><span data-ttu-id="1ee93-108">Nové sestavení</span><span class="sxs-lookup"><span data-stu-id="1ee93-108">Rebuilding</span></span>

<span data-ttu-id="1ee93-109">EF6 je nyní součástí základního kódu, který byl dřív součástí .NET Framework, jako sestavení mimo pásmo (OOB).</span><span class="sxs-lookup"><span data-stu-id="1ee93-109">With EF6 the core code that was previously part of the .NET Framework is now being shipped as out-of-band (OOB) assemblies.</span></span> <span data-ttu-id="1ee93-110">Podrobnosti o tom, jak sestavovat aplikace pro EF6, najdete na stránce [aktualizace aplikací pro EF6](~/ef6/what-is-new/upgrading-to-ef6.md) .</span><span class="sxs-lookup"><span data-stu-id="1ee93-110">Details on how to build applications against EF6 can be found on the [Updating applications for EF6](~/ef6/what-is-new/upgrading-to-ef6.md) page.</span></span> <span data-ttu-id="1ee93-111">V těchto pokynech bude také potřeba znovu sestavit poskytovatele.</span><span class="sxs-lookup"><span data-stu-id="1ee93-111">Providers will also need to be rebuilt using these instructions.</span></span>

## <a name="provider-types-overview"></a><span data-ttu-id="1ee93-112">Přehled typů zprostředkovatelů</span><span class="sxs-lookup"><span data-stu-id="1ee93-112">Provider types overview</span></span>

<span data-ttu-id="1ee93-113">Zprostředkovatel EF je ve skutečnosti kolekce služeb specifických pro poskytovatele definovaných typy CLR, které tyto služby rozšířily (pro základní třídu) nebo implementující (pro rozhraní).</span><span class="sxs-lookup"><span data-stu-id="1ee93-113">An EF provider is really a collection of provider-specific services defined by CLR types that these services extend from (for a base class) or implement (for an interface).</span></span> <span data-ttu-id="1ee93-114">Dvě z těchto služeb jsou zásadní a je nezbytné, aby EF fungovalo vůbec.</span><span class="sxs-lookup"><span data-stu-id="1ee93-114">Two of these services are fundamental and necessary for EF to function at all.</span></span> <span data-ttu-id="1ee93-115">Jiné jsou volitelné a je potřeba je implementovat jenom v případě, že je potřeba zadat konkrétní funkčnost a/nebo výchozí implementace těchto služeb nefungují pro konkrétní cílový databázový server.</span><span class="sxs-lookup"><span data-stu-id="1ee93-115">Others are optional and only need to be implemented if specific functionality is required and/or the default implementations of these services does not work for the specific database server being targeted.</span></span>

## <a name="fundamental-provider-types"></a><span data-ttu-id="1ee93-116">Základní typy zprostředkovatelů</span><span class="sxs-lookup"><span data-stu-id="1ee93-116">Fundamental provider types</span></span>

### <a name="dbproviderfactory"></a><span data-ttu-id="1ee93-117">DbProviderFactory</span><span class="sxs-lookup"><span data-stu-id="1ee93-117">DbProviderFactory</span></span>

<span data-ttu-id="1ee93-118">EF závisí na typu odvozeném z typu [System. data. Common. DbProviderFactory](https://msdn.microsoft.com/library/system.data.common.dbproviderfactory.aspx) pro provádění všech přístupů k databázi nízké úrovně.</span><span class="sxs-lookup"><span data-stu-id="1ee93-118">EF depends on having a type derived from [System.Data.Common.DbProviderFactory](https://msdn.microsoft.com/library/system.data.common.dbproviderfactory.aspx) for performing all low-level database access.</span></span> <span data-ttu-id="1ee93-119">DbProviderFactory není ve skutečnosti součástí EF, ale je to třída v .NET Framework, která slouží vstupnímu bodu pro poskytovatele ADO.NET, který může být použit v EF, jiné O/RMs nebo přímo v aplikaci k získání instancí připojení, příkazů, parametrů a dalších ADO.NET abstrakcí v poskytovateli nezávislá.</span><span class="sxs-lookup"><span data-stu-id="1ee93-119">DbProviderFactory is not actually part of EF but is instead a class in the .NET Framework that serves an entry point for ADO.NET providers that can be used by EF, other O/RMs or directly by an application to obtain instances of connections, commands, parameters and other ADO.NET abstractions in a provider agnostic way.</span></span> <span data-ttu-id="1ee93-120">Další informace o DbProviderFactory najdete v [dokumentaci MSDN pro ADO.NET](https://msdn.microsoft.com/library/a6cd7c08.aspx).</span><span class="sxs-lookup"><span data-stu-id="1ee93-120">More information about DbProviderFactory can be found in the [MSDN documentation for ADO.NET](https://msdn.microsoft.com/library/a6cd7c08.aspx).</span></span>

### <a name="dbproviderservices"></a><span data-ttu-id="1ee93-121">DbProviderServices</span><span class="sxs-lookup"><span data-stu-id="1ee93-121">DbProviderServices</span></span>

<span data-ttu-id="1ee93-122">EF závisí na typu odvozeném od DbProviderServices pro poskytování dalších funkcí požadovaných v EF nad funkčnost, kterou už poskytuje poskytovatel ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="1ee93-122">EF depends on having a type derived from DbProviderServices for providing additional functionality needed by EF on top of the functionality already provided by the ADO.NET provider.</span></span> <span data-ttu-id="1ee93-123">Ve starších verzích EF byla třída DbProviderServices součástí .NET Framework a byla nalezena v oboru názvů System. data. Common.</span><span class="sxs-lookup"><span data-stu-id="1ee93-123">In older versions of EF the DbProviderServices class was part of the .NET Framework and was found in the System.Data.Common namespace.</span></span> <span data-ttu-id="1ee93-124">Počínaje EF6 Tato třída je teď součástí EntityFramework. dll a je v oboru názvů System. data. entity. Core. Common.</span><span class="sxs-lookup"><span data-stu-id="1ee93-124">Starting with EF6 this class is now part of EntityFramework.dll and is in the System.Data.Entity.Core.Common namespace.</span></span>

<span data-ttu-id="1ee93-125">Další podrobnosti o základních funkcích implementace DbProviderServices najdete na [webu MSDN](https://msdn.microsoft.com/library/ee789835.aspx).</span><span class="sxs-lookup"><span data-stu-id="1ee93-125">More details about the fundamental functionality of a DbProviderServices implementation can be found on [MSDN](https://msdn.microsoft.com/library/ee789835.aspx).</span></span> <span data-ttu-id="1ee93-126">Upozorňujeme však, že od doby psaní těchto informací není pro EF6 aktualizováno, i když je většina konceptů stále platná.</span><span class="sxs-lookup"><span data-stu-id="1ee93-126">However, note that as of the time of writing this information is not updated for EF6 although most of the concepts are still valid.</span></span> <span data-ttu-id="1ee93-127">SQL Server a SQL Server Compact implementace DbProviderServices jsou také vráceny do [Open Source základu kódu](https://github.com/aspnet/EntityFramework6/) a mohou sloužit jako užitečné odkazy pro jiné implementace.</span><span class="sxs-lookup"><span data-stu-id="1ee93-127">The SQL Server and SQL Server Compact implementations of DbProviderServices are also checked into to the [open-source codebase](https://github.com/aspnet/EntityFramework6/) and can serve as useful references for other implementations.</span></span>

<span data-ttu-id="1ee93-128">Ve starších verzích EF byla implementace DbProviderServices k použití získána přímo od poskytovatele ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="1ee93-128">In older versions of EF the DbProviderServices implementation to use was obtained directly from an ADO.NET provider.</span></span> <span data-ttu-id="1ee93-129">To bylo provedeno přetypováním DbProviderFactory na IServiceProvider a voláním metody GetService.</span><span class="sxs-lookup"><span data-stu-id="1ee93-129">This was done by casting DbProviderFactory to IServiceProvider and calling the GetService method.</span></span> <span data-ttu-id="1ee93-130">Tím se úzce propojí poskytovatel EF s DbProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="1ee93-130">This tightly coupled the EF provider to the DbProviderFactory.</span></span> <span data-ttu-id="1ee93-131">Tento spojovací bod zablokoval EF z .NET Framework, a proto pro EF6 bylo odebráno toto těsné propojení a implementace DbProviderServices je nyní registrována přímo v konfiguračním souboru aplikace nebo v konfiguraci založené na kódu, jak je popsáno dále v části Další informace níže v části _registrace DbProviderServices_ .</span><span class="sxs-lookup"><span data-stu-id="1ee93-131">This coupling blocked EF from being moved out of the .NET Framework and therefore for EF6 this tight coupling has been removed and an implementation of DbProviderServices is now registered directly in the application’s configuration file or in code-based configuration as described in more detail the _Registering DbProviderServices_ section below.</span></span>

## <a name="additional-services"></a><span data-ttu-id="1ee93-132">Další služby</span><span class="sxs-lookup"><span data-stu-id="1ee93-132">Additional services</span></span>

<span data-ttu-id="1ee93-133">Kromě základních služeb popsaných výše je k dispozici také mnoho dalších služeb používaných v rámci EF, které jsou buď vždy, nebo někdy specifické pro konkrétního poskytovatele.</span><span class="sxs-lookup"><span data-stu-id="1ee93-133">In addition to the fundamental services described above there are also many other services used by EF which are either always or sometimes provider-specific.</span></span> <span data-ttu-id="1ee93-134">Výchozí implementace těchto služeb pro konkrétního zprostředkovatele může poskytovat implementace DbProviderServices.</span><span class="sxs-lookup"><span data-stu-id="1ee93-134">Default provider-specific implementations of these services can be supplied by a DbProviderServices implementation.</span></span> <span data-ttu-id="1ee93-135">Aplikace mohou také přepsat implementace těchto služeb nebo poskytovat implementace, když typ DbProviderServices neposkytuje výchozí hodnotu.</span><span class="sxs-lookup"><span data-stu-id="1ee93-135">Applications can also override the implementations of these services, or provide implementations when a DbProviderServices type does not provide a default.</span></span> <span data-ttu-id="1ee93-136">Tato informace je podrobněji popsána v části _řešení dalších služeb_ níže.</span><span class="sxs-lookup"><span data-stu-id="1ee93-136">This is described in more detail in the _Resolving additional services_ section below.</span></span>

<span data-ttu-id="1ee93-137">Níže jsou uvedené další typy služeb, které poskytovatel může přijímat k poskytovateli.</span><span class="sxs-lookup"><span data-stu-id="1ee93-137">The additional service types that a provider may be of interest to a provider are listed below.</span></span> <span data-ttu-id="1ee93-138">Další podrobnosti o jednotlivých typech služeb najdete v dokumentaci k rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="1ee93-138">More details about each of these service types can be found in the API documentation.</span></span>

### <a name="idbexecutionstrategy"></a><span data-ttu-id="1ee93-139">IDbExecutionStrategy</span><span class="sxs-lookup"><span data-stu-id="1ee93-139">IDbExecutionStrategy</span></span>

<span data-ttu-id="1ee93-140">Jedná se o volitelnou službu, která umožňuje zprostředkovateli implementovat opakované pokusy nebo jiné chování při spuštění dotazů a příkazů na databázi.</span><span class="sxs-lookup"><span data-stu-id="1ee93-140">This is an optional service that allows a provider to implement retries or other behavior when queries and commands are executed against the database.</span></span> <span data-ttu-id="1ee93-141">Pokud není k dispozici žádná implementace, pak EF jednoduše provede příkazy a rozšíří všechny vyvolané výjimky.</span><span class="sxs-lookup"><span data-stu-id="1ee93-141">If no implementation is provided, then EF will simply execute the commands and propagate any exceptions thrown.</span></span> <span data-ttu-id="1ee93-142">Pro SQL Server se tato služba používá k poskytnutí zásady opakování, která je obzvláště užitečná při spuštění na cloudových databázových serverech, jako je SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="1ee93-142">For SQL Server this service is used to provide a retry policy which is especially useful when running against cloud-based database servers such as SQL Azure.</span></span>

### <a name="idbconnectionfactory"></a><span data-ttu-id="1ee93-143">IDbConnectionFactory</span><span class="sxs-lookup"><span data-stu-id="1ee93-143">IDbConnectionFactory</span></span>

<span data-ttu-id="1ee93-144">Toto je volitelná služba, která umožňuje poskytovateli vytvářet DbConnection objekty podle konvence, pokud je zadaný jenom název databáze.</span><span class="sxs-lookup"><span data-stu-id="1ee93-144">This is an optional service that allows a provider to create DbConnection objects by convention when given only a database name.</span></span> <span data-ttu-id="1ee93-145">Všimněte si, že zatímco tuto službu je možné vyřešit pomocí implementace DbProviderServices, která je přítomna od EF 4,1 a lze ji také explicitně nastavit buď v konfiguračním souboru, nebo v kódu.</span><span class="sxs-lookup"><span data-stu-id="1ee93-145">Note that while this service can be resolved by a DbProviderServices implementation it has been present since EF 4.1 and can also be explicitly set in either the config file or in code.</span></span> <span data-ttu-id="1ee93-146">Poskytovatel bude mít možnost tuto službu vyřešit jenom v případě, že je zaregistrovaná jako výchozí zprostředkovatel (viz _výchozí zprostředkovatel_ níže) a pokud výchozí objekt pro vytváření připojení není nastavený jinde.</span><span class="sxs-lookup"><span data-stu-id="1ee93-146">The provider will only get a chance to resolve this service if it registered as the default provider (see _The default provider_ below) and if a default connection factory has not been set elsewhere.</span></span>

### <a name="dbspatialservices"></a><span data-ttu-id="1ee93-147">DbSpatialServices</span><span class="sxs-lookup"><span data-stu-id="1ee93-147">DbSpatialServices</span></span>

<span data-ttu-id="1ee93-148">Toto jsou volitelné služby, které poskytovateli umožňují přidat podporu pro geografické a geometrické prostorové typy.</span><span class="sxs-lookup"><span data-stu-id="1ee93-148">This is an optional services that allows a provider to add support for geography and geometry spatial types.</span></span> <span data-ttu-id="1ee93-149">Aby aplikace mohla používat EF s prostorovými typy, musí být dodána implementace této služby.</span><span class="sxs-lookup"><span data-stu-id="1ee93-149">An implementation of this service must be supplied in order for an application to use EF with spatial types.</span></span> <span data-ttu-id="1ee93-150">DbSptialServices se vyzve dvěma způsoby.</span><span class="sxs-lookup"><span data-stu-id="1ee93-150">DbSptialServices is asked for in two ways.</span></span> <span data-ttu-id="1ee93-151">Nejprve jsou požadovány prostorové služby specifické pro poskytovatele pomocí objektu DbProviderInfo (který obsahuje neutrální název a token manifestu) jako klíč.</span><span class="sxs-lookup"><span data-stu-id="1ee93-151">First, provider-specific spatial services are requested using a DbProviderInfo object (which contains invariant name and manifest token) as key.</span></span> <span data-ttu-id="1ee93-152">Druhý DbSpatialServices může být požádán o bez klíče.</span><span class="sxs-lookup"><span data-stu-id="1ee93-152">Second, DbSpatialServices can be asked for with no key.</span></span> <span data-ttu-id="1ee93-153">Slouží k vyřešení "globálního poskytovatele prostorového přístupu", který se používá při vytváření samostatných typů DbGeography nebo DbGeometry.</span><span class="sxs-lookup"><span data-stu-id="1ee93-153">This is used to resolve the “global spatial provider” that is used when creating stand-alone DbGeography or DbGeometry types.</span></span>

### <a name="migrationsqlgenerator"></a><span data-ttu-id="1ee93-154">MigrationSqlGenerator</span><span class="sxs-lookup"><span data-stu-id="1ee93-154">MigrationSqlGenerator</span></span>

<span data-ttu-id="1ee93-155">Toto je volitelná služba, která umožňuje použití migrace EF pro generování SQL používaného při vytváření a úpravách schémat databáze Code First.</span><span class="sxs-lookup"><span data-stu-id="1ee93-155">This is an optional service that allows EF Migrations to be used for the generation of SQL used in creating and modifying database schemas by Code First.</span></span> <span data-ttu-id="1ee93-156">Aby bylo možné podporovat migrace, je vyžadována implementace.</span><span class="sxs-lookup"><span data-stu-id="1ee93-156">An implementation is required in order to support Migrations.</span></span> <span data-ttu-id="1ee93-157">Pokud je k dispozici implementace, bude použita také při vytváření databází pomocí inicializátorů databáze nebo metody Database. Create.</span><span class="sxs-lookup"><span data-stu-id="1ee93-157">If an implementation is provided then it will also be used when databases are created using database initializers or the Database.Create method.</span></span>

### <a name="funcdbconnection-string-historycontextfactory"></a><span data-ttu-id="1ee93-158">Func < DbConnection, String, HistoryContextFactory ></span><span class="sxs-lookup"><span data-stu-id="1ee93-158">Func<DbConnection, string, HistoryContextFactory></span></span>

<span data-ttu-id="1ee93-159">Toto je volitelná služba, která umožňuje poskytovateli nakonfigurovat mapování HistoryContext k tabulce `__MigrationHistory` používané migracemi EF.</span><span class="sxs-lookup"><span data-stu-id="1ee93-159">This is an optional service that allows a provider to configure the mapping of the HistoryContext to the `__MigrationHistory` table used by EF Migrations.</span></span> <span data-ttu-id="1ee93-160">HistoryContext je Code First DbContext a dá se nakonfigurovat pomocí normálního rozhraní API Fluent, aby se změnily položky, jako je název tabulky a specifikace mapování sloupců.</span><span class="sxs-lookup"><span data-stu-id="1ee93-160">The HistoryContext is a Code First DbContext and can be configured using the normal fluent API to change things like the name of the table and the column mapping specifications.</span></span> <span data-ttu-id="1ee93-161">Výchozí implementace této služby vracené EF pro všechny poskytovatele můžou fungovat pro daný databázový server, pokud jsou všechna výchozí mapování tabulek a sloupců podporovaná zprostředkovatelem.</span><span class="sxs-lookup"><span data-stu-id="1ee93-161">The default implementation of this service returned by EF for all providers may work for a given database server if all the default table and column mappings are supported by that provider.</span></span> <span data-ttu-id="1ee93-162">V takovém případě poskytovatel nemusí poskytovat implementaci této služby.</span><span class="sxs-lookup"><span data-stu-id="1ee93-162">In such a case the provider does not need to supply an implementation of this service.</span></span>

### <a name="idbproviderfactoryresolver"></a><span data-ttu-id="1ee93-163">IDbProviderFactoryResolver</span><span class="sxs-lookup"><span data-stu-id="1ee93-163">IDbProviderFactoryResolver</span></span>

<span data-ttu-id="1ee93-164">Toto je volitelná služba pro získání správného DbProviderFactory z daného objektu DbConnection.</span><span class="sxs-lookup"><span data-stu-id="1ee93-164">This is an optional service for obtaining the correct DbProviderFactory from a given DbConnection object.</span></span> <span data-ttu-id="1ee93-165">Výchozí implementace této služby vracené EF pro všechny poskytovatele je určena pro práci pro všechny poskytovatele.</span><span class="sxs-lookup"><span data-stu-id="1ee93-165">The default implementation of this service returned by EF for all providers is intended to work for all providers.</span></span> <span data-ttu-id="1ee93-166">Při spuštění v rozhraní .NET 4 ale DbProviderFactory není veřejně přístupný z jednoho, pokud jeho DbConnections.</span><span class="sxs-lookup"><span data-stu-id="1ee93-166">However, when running on .NET 4, the DbProviderFactory is not publicly accessible from one if its DbConnections.</span></span> <span data-ttu-id="1ee93-167">Proto EF používá některé heuristické metody k vyhledání shody s registrovanými zprostředkovateli.</span><span class="sxs-lookup"><span data-stu-id="1ee93-167">Therefore, EF uses some heuristics to search the registered providers to find a match.</span></span> <span data-ttu-id="1ee93-168">Je možné, že u některých zprostředkovatelů tyto heuristické služby selžou a v takových situacích by měl poskytovatel dodat novou implementaci.</span><span class="sxs-lookup"><span data-stu-id="1ee93-168">It is possible that for some providers these heuristics will fail and in such situations the provider should supply a new implementation.</span></span>

## <a name="registering-dbproviderservices"></a><span data-ttu-id="1ee93-169">Registrace DbProviderServices</span><span class="sxs-lookup"><span data-stu-id="1ee93-169">Registering DbProviderServices</span></span>

<span data-ttu-id="1ee93-170">Implementaci DbProviderServices k použití lze zaregistrovat buď v konfiguračním souboru aplikace (App. config nebo Web. config), nebo pomocí konfigurace založené na kódu.</span><span class="sxs-lookup"><span data-stu-id="1ee93-170">The DbProviderServices implementation to use can be registered either in the application’s configuration file (app.config or web.config) or using code-based configuration.</span></span> <span data-ttu-id="1ee93-171">V obou případech registrace používá jako klíč "neutrální název" poskytovatele.</span><span class="sxs-lookup"><span data-stu-id="1ee93-171">In either case the registration uses the provider’s “invariant name” as a key.</span></span> <span data-ttu-id="1ee93-172">To umožňuje, aby bylo více poskytovatelů registrováno a použito v jediné aplikaci.</span><span class="sxs-lookup"><span data-stu-id="1ee93-172">This allows multiple providers to be registered and used in a single application.</span></span> <span data-ttu-id="1ee93-173">Neutrální název použitý pro registrace EF je stejný jako neutrální název použitý pro registraci poskytovatele ADO.NET a připojovací řetězce.</span><span class="sxs-lookup"><span data-stu-id="1ee93-173">The invariant name used for EF registrations is the same as the invariant name used for ADO.NET provider registration and connection strings.</span></span> <span data-ttu-id="1ee93-174">Například pro SQL Server je použit neutrální název System. data. SqlClient.</span><span class="sxs-lookup"><span data-stu-id="1ee93-174">For example, for SQL Server the invariant name “System.Data.SqlClient” is used.</span></span>

### <a name="config-file-registration"></a><span data-ttu-id="1ee93-175">Registrace konfiguračního souboru</span><span class="sxs-lookup"><span data-stu-id="1ee93-175">Config file registration</span></span>

<span data-ttu-id="1ee93-176">Typ DbProviderServices, který se má použít, se zaregistruje jako element provider v seznamu zprostředkovatelů oddílu entityFramework konfiguračního souboru aplikace.</span><span class="sxs-lookup"><span data-stu-id="1ee93-176">The DbProviderServices type to use is registered as a provider element in the providers list of the entityFramework section of the application’s config file.</span></span> <span data-ttu-id="1ee93-177">Příklad:</span><span class="sxs-lookup"><span data-stu-id="1ee93-177">For example:</span></span>

``` xml
<entityFramework>
  <providers>
    <provider invariantName="My.Invariant.Name" type="MyProvider.MyProviderServices, MyAssembly" />
  </providers>
</entityFramework>
```

<span data-ttu-id="1ee93-178">Řetězec _typu_ musí být kvalifikovaný název typu sestavení DbProviderServices implementace, která se má použít.</span><span class="sxs-lookup"><span data-stu-id="1ee93-178">The _type_ string must be the assembly-qualified type name of the DbProviderServices implementation to use.</span></span>

### <a name="code-based-registration"></a><span data-ttu-id="1ee93-179">Registrace na základě kódu</span><span class="sxs-lookup"><span data-stu-id="1ee93-179">Code-based registration</span></span>

<span data-ttu-id="1ee93-180">Počínaje poskytovatelem EF6 lze také zaregistrovat pomocí kódu.</span><span class="sxs-lookup"><span data-stu-id="1ee93-180">Starting with EF6 providers can also be registered using code.</span></span> <span data-ttu-id="1ee93-181">To umožňuje, aby byl zprostředkovatel EF použit bez jakýchkoli změn konfiguračního souboru aplikace.</span><span class="sxs-lookup"><span data-stu-id="1ee93-181">This allows an EF provider to be used without any change to the application’s configuration file.</span></span> <span data-ttu-id="1ee93-182">Pro použití konfigurace na základě kódu by aplikace měla vytvořit třídu DbConfiguration, jak je popsáno v [dokumentaci konfigurace na základě kódu](https://msdn.com/data/jj680699).</span><span class="sxs-lookup"><span data-stu-id="1ee93-182">To use code-based configuration an application should create a DbConfiguration class as described in the [code-based configuration documentation](https://msdn.com/data/jj680699).</span></span> <span data-ttu-id="1ee93-183">Konstruktor třídy DbConfiguration by pak měl volat SetProviderServices a zaregistrovat poskytovatele EF.</span><span class="sxs-lookup"><span data-stu-id="1ee93-183">The constructor of the DbConfiguration class should then call SetProviderServices to register the EF provider.</span></span> <span data-ttu-id="1ee93-184">Příklad:</span><span class="sxs-lookup"><span data-stu-id="1ee93-184">For example:</span></span>

``` csharp
public class MyConfiguration : DbConfiguration
{
    public MyConfiguration()
    {
        SetProviderServices("My.New.Provider", new MyProviderServices());
    }
}
```

## <a name="resolving-additional-services"></a><span data-ttu-id="1ee93-185">Řešení dalších služeb</span><span class="sxs-lookup"><span data-stu-id="1ee93-185">Resolving additional services</span></span>

<span data-ttu-id="1ee93-186">Jak je uvedeno výše v oddílu _Přehled typů zprostředkovatelů_ , lze také použít třídu DbProviderServices k vyřešení dalších služeb.</span><span class="sxs-lookup"><span data-stu-id="1ee93-186">As mentioned above in the _Provider types overview_ section, a DbProviderServices class can also be used to resolve additional services.</span></span> <span data-ttu-id="1ee93-187">To je možné, protože DbProviderServices implementuje IDbDependencyResolver a každý registrovaný typ DbProviderServices se přidá jako výchozí překladač.</span><span class="sxs-lookup"><span data-stu-id="1ee93-187">This is possible because DbProviderServices implements IDbDependencyResolver and each registered DbProviderServices type is added as a “default resolver”.</span></span> <span data-ttu-id="1ee93-188">Mechanismus IDbDpendencyResolver je podrobněji popsán v tématu [řešení závislostí](~/ef6/fundamentals/configuring/dependency-resolution.md).</span><span class="sxs-lookup"><span data-stu-id="1ee93-188">The IDbDpendencyResolver mechanism is described in more detail in [Dependency Resolution](~/ef6/fundamentals/configuring/dependency-resolution.md).</span></span> <span data-ttu-id="1ee93-189">Není ale nutné porozumět všem konceptům této specifikace, aby bylo možné vyřešit další služby ve zprostředkovateli.</span><span class="sxs-lookup"><span data-stu-id="1ee93-189">However, it is not necessary to understand all the concepts in this specification to resolve additional services in a provider.</span></span>

<span data-ttu-id="1ee93-190">Nejběžnější způsob, jak pro poskytovatele přeložit další služby, je volat DbProviderServices. AddDependencyResolver pro každou službu v konstruktoru třídy DbProviderServices.</span><span class="sxs-lookup"><span data-stu-id="1ee93-190">The most common way for a provider to resolve additional services is to call DbProviderServices.AddDependencyResolver for each service in the constructor of the DbProviderServices class.</span></span> <span data-ttu-id="1ee93-191">Například SqlProviderServices (Provider EF pro SQL Server) má podobný kód jako při inicializaci:</span><span class="sxs-lookup"><span data-stu-id="1ee93-191">For example, SqlProviderServices (the EF provider for SQL Server) has code similar to this for initialization:</span></span>

``` csharp
private SqlProviderServices()
{
    AddDependencyResolver(new SingletonDependencyResolver<IDbConnectionFactory>(
        new SqlConnectionFactory()));

    AddDependencyResolver(new ExecutionStrategyResolver<DefaultSqlExecutionStrategy>(
        "System.data.SqlClient", null, () => new DefaultSqlExecutionStrategy()));

    AddDependencyResolver(new SingletonDependencyResolver<Func<MigrationSqlGenerator>>(
        () => new SqlServerMigrationSqlGenerator(), "System.data.SqlClient"));

    AddDependencyResolver(new SingletonDependencyResolver<DbSpatialServices>(
        SqlSpatialServices.Instance,
        k =>
        {
            var asSpatialKey = k as DbProviderInfo;
            return asSpatialKey == null
                || asSpatialKey.ProviderInvariantName == ProviderInvariantName;
        }));
}
```

<span data-ttu-id="1ee93-192">Tento konstruktor používá následující pomocné třídy:</span><span class="sxs-lookup"><span data-stu-id="1ee93-192">This constructor uses the following helper classes:</span></span>

*   <span data-ttu-id="1ee93-193">SingletonDependencyResolver: poskytuje jednoduchý způsob, jak přeložit služby typu Singleton – to znamená služby, pro které se stejná instance vrací pokaždé, když je volána metoda GetService.</span><span class="sxs-lookup"><span data-stu-id="1ee93-193">SingletonDependencyResolver: provides a simple way to resolve Singleton services—that is, services for which the same instance is returned each time that GetService is called.</span></span> <span data-ttu-id="1ee93-194">Přechodné služby se často registrují jako továrna s jedním objektem, který se použije k vytvoření přechodných instancí na vyžádání.</span><span class="sxs-lookup"><span data-stu-id="1ee93-194">Transient services are often registered as a singleton factory that will be used to create transient instances on demand.</span></span>
*   <span data-ttu-id="1ee93-195">ExecutionStrategyResolver: překladač určený k vrácení IExecutionStrategy implementací.</span><span class="sxs-lookup"><span data-stu-id="1ee93-195">ExecutionStrategyResolver: a resolver specific to returning IExecutionStrategy implementations.</span></span>

<span data-ttu-id="1ee93-196">Místo používání DbProviderServices. AddDependencyResolver je také možné přepsat DbProviderServices. GetService a přímo vyřešit další služby.</span><span class="sxs-lookup"><span data-stu-id="1ee93-196">Instead of using DbProviderServices.AddDependencyResolver it is also possible to override DbProviderServices.GetService and resolve additional services directly.</span></span> <span data-ttu-id="1ee93-197">Tato metoda bude volána, když EF potřebuje službu definovanou určitým typem a v některých případech pro daný klíč.</span><span class="sxs-lookup"><span data-stu-id="1ee93-197">This method will be called when EF needs a service defined by a certain type and, in some cases, for a given key.</span></span> <span data-ttu-id="1ee93-198">Metoda by měla vrátit službu, pokud ji může, nebo vrátit hodnotu null, aby se odhlásila od vrácení služby, a místo toho povolit jinou třídu k jejímu vyřešení.</span><span class="sxs-lookup"><span data-stu-id="1ee93-198">The method should return the service if it can, or return null to opt-out of returning the service and instead allow another class to resolve it.</span></span> <span data-ttu-id="1ee93-199">Například pro vyřešení výchozího objektu pro vytváření připojení může kód v GetService vypadat přibližně takto:</span><span class="sxs-lookup"><span data-stu-id="1ee93-199">For example, to resolve the default connection factory the code in GetService might look something like this:</span></span>

``` csharp
public override object GetService(Type type, object key)
{
    if (type == typeof(IDbConnectionFactory))
    {
        return new SqlConnectionFactory();
    }
    return null;
}
```

### <a name="registration-order"></a><span data-ttu-id="1ee93-200">Objednávka registrace</span><span class="sxs-lookup"><span data-stu-id="1ee93-200">Registration order</span></span>

<span data-ttu-id="1ee93-201">V případě, že je v konfiguračním souboru aplikace registrováno více implementací DbProviderServices, budou přidány jako sekundární překladače v pořadí, v jakém jsou uvedeny.</span><span class="sxs-lookup"><span data-stu-id="1ee93-201">When multiple DbProviderServices implementations are registered in an application’s config file they will be added as secondary resolvers in the order that they are listed.</span></span> <span data-ttu-id="1ee93-202">Vzhledem k tomu, že překladače se vždy přidávají na začátek sekundárního řetězu překladu, znamená to, že poskytovatel na konci seznamu bude mít možnost vyřešit závislosti před ostatními.</span><span class="sxs-lookup"><span data-stu-id="1ee93-202">Since resolvers are always added to the top of the secondary resolver chain this means that the provider at the end of the list will get a chance to resolve dependencies before the others.</span></span> <span data-ttu-id="1ee93-203">(To se může zdát, že je to pro vás málo intuitivní, ale dává smysl, pokud si představte převzetí každého poskytovatele ze seznamu a jeho skládání nad stávajícími poskytovateli.)</span><span class="sxs-lookup"><span data-stu-id="1ee93-203">(This can seem a little counter-intuitive at first, but it makes sense if you imagine taking each provider out of the list and stacking it on top of the existing providers.)</span></span>

<span data-ttu-id="1ee93-204">Toto pořadí většinou nezáleží na tom, že většina služeb poskytovatele je specifická pro poskytovatele a je nastavená jako neutrální název zprostředkovatele.</span><span class="sxs-lookup"><span data-stu-id="1ee93-204">This ordering usually doesn’t matter because most provider services are provider-specific and keyed by provider invariant name.</span></span> <span data-ttu-id="1ee93-205">Pro služby, které nejsou nastavené podle neutrálního názvu poskytovatele nebo nějakého jiného klíče specifického pro poskytovatele, se služba vyřeší v závislosti na tomto pořadí.</span><span class="sxs-lookup"><span data-stu-id="1ee93-205">However, for services that are not keyed by provider invariant name or some other provider-specific key the service will be resolved based on this ordering.</span></span> <span data-ttu-id="1ee93-206">Pokud není třeba explicitně nastavené jinak v jiném místě, bude výchozí továrna připojení od nejvyššího poskytovatele v řetězu.</span><span class="sxs-lookup"><span data-stu-id="1ee93-206">For example, if it is not explicitly set differently somewhere else, then the default connection factory will come from the topmost provider in the chain.</span></span>

## <a name="additional-config-file-registrations"></a><span data-ttu-id="1ee93-207">Další registrace konfiguračního souboru</span><span class="sxs-lookup"><span data-stu-id="1ee93-207">Additional config file registrations</span></span>

<span data-ttu-id="1ee93-208">Některé další služby poskytovatele popsané výše jsou možné explicitně zaregistrovat přímo v konfiguračním souboru aplikace.</span><span class="sxs-lookup"><span data-stu-id="1ee93-208">It is possible to explicitly register some of the additional provider services described above directly in an application’s config file.</span></span> <span data-ttu-id="1ee93-209">V případě, že se to provede, místo cokoli vrácené metodou GetService implementace DbProviderServices se použije registrace v konfiguračním souboru.</span><span class="sxs-lookup"><span data-stu-id="1ee93-209">When this is done the registration in the config file will be used instead of anything returned by the GetService method of the DbProviderServices implementation.</span></span>

### <a name="registering-the-default-connection-factory"></a><span data-ttu-id="1ee93-210">Registrace výchozího objektu pro vytváření připojení</span><span class="sxs-lookup"><span data-stu-id="1ee93-210">Registering the default connection factory</span></span>

<span data-ttu-id="1ee93-211">Počínaje EF5 balíček NuGet EntityFramework automaticky zaregistroval buď objekt pro vytváření připojení SQL Express, nebo objekt pro vytváření připojení LocalDb v konfiguračním souboru.</span><span class="sxs-lookup"><span data-stu-id="1ee93-211">Starting with EF5 the EntityFramework NuGet package automatically registered either the SQL Express connection factory or the LocalDb connection factory in the config file.</span></span>

<span data-ttu-id="1ee93-212">Příklad:</span><span class="sxs-lookup"><span data-stu-id="1ee93-212">For example:</span></span>

``` xml
<entityFramework>
  <defaultConnectionFactory type="System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework" >
</entityFramework>
```

<span data-ttu-id="1ee93-213">_Typ_ je kvalifikovaný název typu sestavení pro výchozí objekt pro vytváření připojení, který musí implementovat IDbConnectionFactory.</span><span class="sxs-lookup"><span data-stu-id="1ee93-213">The _type_ is the assembly-qualified type name for the default connection factory, which must implement IDbConnectionFactory.</span></span>

<span data-ttu-id="1ee93-214">Doporučuje se, aby balíček NuGet poskytovatele při instalaci nastavil výchozí objekt pro vytváření připojení.</span><span class="sxs-lookup"><span data-stu-id="1ee93-214">It is recommended that a provider NuGet package set the default connection factory in this way when installed.</span></span> <span data-ttu-id="1ee93-215">Níže najdete _balíčky NuGet pro poskytovatele_ .</span><span class="sxs-lookup"><span data-stu-id="1ee93-215">See _NuGet Packages for providers_ below.</span></span>

## <a name="additional-ef6-provider-changes"></a><span data-ttu-id="1ee93-216">Další změny zprostředkovatele EF6</span><span class="sxs-lookup"><span data-stu-id="1ee93-216">Additional EF6 provider changes</span></span>

### <a name="spatial-provider-changes"></a><span data-ttu-id="1ee93-217">Změny prostorového poskytovatele</span><span class="sxs-lookup"><span data-stu-id="1ee93-217">Spatial provider changes</span></span>

<span data-ttu-id="1ee93-218">Poskytovatelé, kteří podporují prostorové typy, teď musí implementovat některé další metody pro třídy, které se odvozují z DbSpatialDataReader:</span><span class="sxs-lookup"><span data-stu-id="1ee93-218">Providers that support spatial types must now implement some additional methods on classes deriving from DbSpatialDataReader:</span></span>

*   `public abstract bool IsGeographyColumn(int ordinal)`
*   `public abstract bool IsGeometryColumn(int ordinal)`

<span data-ttu-id="1ee93-219">K dispozici jsou také nové asynchronní verze stávajících metod, které jsou doporučeny pro přepsání jako výchozí implementace delegátů na synchronní metody, a proto neprovádět asynchronně:</span><span class="sxs-lookup"><span data-stu-id="1ee93-219">There are also new asynchronous versions of existing methods that are recommended to be overridden as the default implementations delegate to the synchronous methods and therefore do not execute asynchronously:</span></span>

*   `public virtual Task<DbGeography> GetGeographyAsync(int ordinal, CancellationToken cancellationToken)`
*   `public virtual Task<DbGeometry> GetGeometryAsync(int ordinal, CancellationToken cancellationToken)`

### <a name="native-support-for-enumerablecontains"></a><span data-ttu-id="1ee93-220">Nativní podpora pro vyčíslitelné. obsahuje</span><span class="sxs-lookup"><span data-stu-id="1ee93-220">Native support for Enumerable.Contains</span></span>

<span data-ttu-id="1ee93-221">EF6 zavádí nový typ výrazu DbInExpression, který byl přidán pro řešení problémů s výkonem kolem použití vyčíslitelné. obsahuje v dotazech LINQ.</span><span class="sxs-lookup"><span data-stu-id="1ee93-221">EF6 introduces a new expression type, DbInExpression, which was added to address performance issues around use of Enumerable.Contains in LINQ queries.</span></span> <span data-ttu-id="1ee93-222">Třída DbProviderManifest má novou virtuální metodu SupportsInExpression, která je volána nástrojem EF k určení, zda zprostředkovatel zpracovává nový typ výrazu.</span><span class="sxs-lookup"><span data-stu-id="1ee93-222">The DbProviderManifest class has a new virtual method, SupportsInExpression, which is called by EF to determine if a provider handles the new expression type.</span></span> <span data-ttu-id="1ee93-223">Pro zajištění kompatibility s existujícími implementacemi poskytovatele vrátí metoda hodnotu false.</span><span class="sxs-lookup"><span data-stu-id="1ee93-223">For compatibility with existing provider implementations the method returns false.</span></span> <span data-ttu-id="1ee93-224">Pro zvýšení výhod tohoto vylepšení může poskytovatel EF6 přidat kód pro zpracování DbInExpression a přepsání SupportsInExpression pro vrácení hodnoty true.</span><span class="sxs-lookup"><span data-stu-id="1ee93-224">To benefit from this improvement, an EF6 provider can add code to handle DbInExpression and override SupportsInExpression to return true.</span></span> <span data-ttu-id="1ee93-225">Instance třídy DbInExpression může být vytvořena voláním metody DbExpressionBuilder.In.</span><span class="sxs-lookup"><span data-stu-id="1ee93-225">An instance of DbInExpression can be created by calling the DbExpressionBuilder.In method.</span></span> <span data-ttu-id="1ee93-226">Instance DbInExpression se skládá z DbExpression, obvykle představuje sloupec tabulky, a seznam DbConstantExpression pro otestování shody.</span><span class="sxs-lookup"><span data-stu-id="1ee93-226">A DbInExpression instance is composed of a DbExpression, usually representing a table column, and a list of DbConstantExpression to test for a match.</span></span>

## <a name="nuget-packages-for-providers"></a><span data-ttu-id="1ee93-227">Balíčky NuGet pro poskytovatele</span><span class="sxs-lookup"><span data-stu-id="1ee93-227">NuGet packages for providers</span></span>

<span data-ttu-id="1ee93-228">Jedním ze způsobů, jak poskytovatele EF6 zpřístupnit, je uvolnit ho jako balíček NuGet.</span><span class="sxs-lookup"><span data-stu-id="1ee93-228">One way to make an EF6 provider available is to release it as a NuGet package.</span></span> <span data-ttu-id="1ee93-229">Použití balíčku NuGet má následující výhody:</span><span class="sxs-lookup"><span data-stu-id="1ee93-229">Using a NuGet package has the following advantages:</span></span>

*   <span data-ttu-id="1ee93-230">K přidání registrace poskytovatele do konfiguračního souboru aplikace je snadné použít NuGet.</span><span class="sxs-lookup"><span data-stu-id="1ee93-230">It is easy to use NuGet to add the provider registration to the application’s config file</span></span>
*   <span data-ttu-id="1ee93-231">V konfiguračním souboru je možné provést další změny pro nastavení výchozího objektu pro vytváření připojení, aby připojení vydaná konvencí používala registrovaného poskytovatele.</span><span class="sxs-lookup"><span data-stu-id="1ee93-231">Additional changes can be made to the config file to set the default connection factory so that connections made by convention will use the registered provider</span></span>
*   <span data-ttu-id="1ee93-232">NuGet zpracovává Přidání přesměrování vazby, aby měl poskytovatel EF6 i nadále fungovat i po uvolnění nového balíčku EF.</span><span class="sxs-lookup"><span data-stu-id="1ee93-232">NuGet handles adding binding redirects so that the EF6 provider should continue to work even after a new EF package is released</span></span>

<span data-ttu-id="1ee93-233">Příkladem je balíček EntityFramework. SqlServerCompact, který je součástí [kódu základu Open Source](https://github.com/aspnet/entityframework6).</span><span class="sxs-lookup"><span data-stu-id="1ee93-233">An example of this is the EntityFramework.SqlServerCompact package which is included in the [open source codebase](https://github.com/aspnet/entityframework6).</span></span> <span data-ttu-id="1ee93-234">Tento balíček poskytuje dobrou šablonu pro vytváření balíčků NuGet pro poskytovatele EF.</span><span class="sxs-lookup"><span data-stu-id="1ee93-234">This package provides a good template for creating EF provider NuGet packages.</span></span>

### <a name="powershell-commands"></a><span data-ttu-id="1ee93-235">Příkazy PowerShellu</span><span class="sxs-lookup"><span data-stu-id="1ee93-235">PowerShell commands</span></span>

<span data-ttu-id="1ee93-236">Po nainstalování balíčku NuGet EntityFramework zaregistruje modul prostředí PowerShell, který obsahuje dva příkazy, které jsou velmi užitečné pro balíčky zprostředkovatele:</span><span class="sxs-lookup"><span data-stu-id="1ee93-236">When the EntityFramework NuGet package is installed it registers a PowerShell module that contains two commands that are very useful for provider packages:</span></span>

*   <span data-ttu-id="1ee93-237">Add-EFProvider přidá do konfiguračního souboru cílového projektu novou entitu pro poskytovatele a ověří, zda je na konci seznamu registrovaných zprostředkovatelů.</span><span class="sxs-lookup"><span data-stu-id="1ee93-237">Add-EFProvider adds a new entity for the provider in the target project’s configuration file and makes sure it is at the end of the list of registered providers.</span></span>
*   <span data-ttu-id="1ee93-238">Add-EFDefaultConnectionFactory buď přidá nebo aktualizuje registraci defaultConnectionFactory v konfiguračním souboru cílového projektu.</span><span class="sxs-lookup"><span data-stu-id="1ee93-238">Add-EFDefaultConnectionFactory either adds or updates the defaultConnectionFactory registration in the target project’s configuration file.</span></span>

<span data-ttu-id="1ee93-239">Oba tyto příkazy postarou o přidání oddílu entityFramework do konfiguračního souboru a přidání kolekce Providers v případě potřeby.</span><span class="sxs-lookup"><span data-stu-id="1ee93-239">Both these commands take care of adding an entityFramework section to the config file and adding a providers collection if necessary.</span></span>

<span data-ttu-id="1ee93-240">Je určeno, že tyto příkazy budou volány ze skriptu NuGet Install. ps1.</span><span class="sxs-lookup"><span data-stu-id="1ee93-240">It is intended that these commands be called from the install.ps1 NuGet script.</span></span> <span data-ttu-id="1ee93-241">Například instalace. ps1 pro poskytovatele SQL Compact vypadá nějak takto:</span><span class="sxs-lookup"><span data-stu-id="1ee93-241">For example, install.ps1 for the SQL Compact provider looks similar to this:</span></span>

``` powershell
param($installPath, $toolsPath, $package, $project)
Add-EFDefaultConnectionFactory $project 'System.Data.Entity.Infrastructure.SqlCeConnectionFactory, EntityFramework' -ConstructorArguments 'System.Data.SqlServerCe.4.0'
Add-EFProvider $project 'System.Data.SqlServerCe.4.0' 'System.Data.Entity.SqlServerCompact.SqlCeProviderServices, EntityFramework.SqlServerCompact'</pre>
```

<span data-ttu-id="1ee93-242">Další informace o těchto příkazech lze získat pomocí příkazu Get-Help v okně konzoly Správce balíčků.</span><span class="sxs-lookup"><span data-stu-id="1ee93-242">More information about these commands can be obtained by using get-help in the Package Manager Console window.</span></span>

## <a name="wrapping-providers"></a><span data-ttu-id="1ee93-243">Poskytovatelé zabalení</span><span class="sxs-lookup"><span data-stu-id="1ee93-243">Wrapping providers</span></span>

<span data-ttu-id="1ee93-244">Poskytovatel pro zabalení je poskytovatel EF nebo ADO.NET, který zabalí stávajícího poskytovatele, aby ho rozšířil s jinými funkcemi, jako je například profilace nebo trasování.</span><span class="sxs-lookup"><span data-stu-id="1ee93-244">A wrapping provider is an EF and/or ADO.NET provider that wraps an existing provider to extend it with other functionality such as profiling or tracing capabilities.</span></span> <span data-ttu-id="1ee93-245">Poskytovatelé zabalení mohou být registrováni běžným způsobem, ale je často pohodlnější nastavit poskytovatele zabalení za běhu tím, že zachytí řešení služeb souvisejících s poskytovatelem.</span><span class="sxs-lookup"><span data-stu-id="1ee93-245">Wrapping providers can be registered in the normal way, but it is often more convenient to setup the wrapping provider at runtime by intercepting the resolution of provider-related services.</span></span> <span data-ttu-id="1ee93-246">K tomu lze použít statickou událost OnLockingConfiguration třídy DbConfiguration.</span><span class="sxs-lookup"><span data-stu-id="1ee93-246">The static event OnLockingConfiguration on the DbConfiguration class can be used to do this.</span></span>

<span data-ttu-id="1ee93-247">OnLockingConfiguration se volá poté, co EF určí, kde bude získána všechna konfigurace EF pro doménu aplikace, ale předtím, než bude uzamčena pro použití.</span><span class="sxs-lookup"><span data-stu-id="1ee93-247">OnLockingConfiguration is called after EF has determined where all EF configuration for the app domain will be obtained from but before it is locked for use.</span></span> <span data-ttu-id="1ee93-248">Při spuštění aplikace (před použitím EF) by aplikace měla zaregistrovat obslužnou rutinu události pro tuto událost.</span><span class="sxs-lookup"><span data-stu-id="1ee93-248">At app startup (before EF is used) the app should register an event handler for this event.</span></span> <span data-ttu-id="1ee93-249">(Zvažujeme přidání podpory pro registraci této obslužné rutiny v konfiguračním souboru, ale to ještě není podporováno.) Obslužná rutina události by pak měla zavolat ReplaceService pro každou službu, která musí být zabalená.</span><span class="sxs-lookup"><span data-stu-id="1ee93-249">(We are considering adding support for registering this handler in the config file but this is not yet supported.) The event handler should then make a call to ReplaceService for every service that needs to be wrapped.</span></span>  

<span data-ttu-id="1ee93-250">Například pro zabalení IDbConnectionFactory a DbProviderService by obslužná rutina něco podobného, měla by být registrována:</span><span class="sxs-lookup"><span data-stu-id="1ee93-250">For example, to wrap IDbConnectionFactory and DbProviderService, a handler something like this should be registered:</span></span>

``` csharp
DbConfiguration.OnLockingConfiguration +=
    (_, a) =>
    {
        a.ReplaceService<DbProviderServices>(
            (s, k) => new MyWrappedProviderServices(s));

        a.ReplaceService<IDbConnectionFactory>(
            (s, k) => new MyWrappedConnectionFactory(s));
    };
```

<span data-ttu-id="1ee93-251">Služba, která byla vyřešena a měla by nyní být zabalena spolu s klíčem, který byl použit k překladu služby, se předává obslužné rutině.</span><span class="sxs-lookup"><span data-stu-id="1ee93-251">The service that has been resolved and should now be wrapped together with the key that was used to resolve the service are passed to the handler.</span></span> <span data-ttu-id="1ee93-252">Obslužná rutina pak může tuto službu zabalit a nahradit vrácenou službu obálkovou verzí.</span><span class="sxs-lookup"><span data-stu-id="1ee93-252">The handler can then wrap this service and replace the returned service with the wrapped version.</span></span>

## <a name="resolving-a-dbproviderfactory-with-ef"></a><span data-ttu-id="1ee93-253">Řešení DbProviderFactory pomocí EF</span><span class="sxs-lookup"><span data-stu-id="1ee93-253">Resolving a DbProviderFactory with EF</span></span>

<span data-ttu-id="1ee93-254">DbProviderFactory je jedním ze základních typů poskytovatele, které vyžaduje EF, jak je popsáno výše v části _Přehled typů zprostředkovatelů_ .</span><span class="sxs-lookup"><span data-stu-id="1ee93-254">DbProviderFactory is one of the fundamental provider types needed by EF as described in the _Provider types overview_ section above.</span></span> <span data-ttu-id="1ee93-255">Jak už bylo zmíněno, není to typ EF a registrace obvykle není součástí konfigurace EF, ale je to místo normální registrace poskytovatele ADO.NET v souboru Machine. config nebo v konfiguračním souboru aplikace.</span><span class="sxs-lookup"><span data-stu-id="1ee93-255">As already mentioned, It is not an EF type and registration is usually not part of EF configuration, but is instead the normal ADO.NET provider registration in the machine.config file and/or application’s config file.</span></span>

<span data-ttu-id="1ee93-256">Navzdory tomu, že tento EF stále používá normální mechanismus rozlišení závislosti při hledání DbProviderFactory, který se má použít.</span><span class="sxs-lookup"><span data-stu-id="1ee93-256">Despite this EF still uses its normal dependency resolution mechanism when looking for a DbProviderFactory to use.</span></span> <span data-ttu-id="1ee93-257">Výchozí překladač používá pro konfigurační soubory normální registraci ADO.NET, takže je to obvykle transparentní.</span><span class="sxs-lookup"><span data-stu-id="1ee93-257">The default resolver uses the normal ADO.NET registration in the config files and so this is usually transparent.</span></span> <span data-ttu-id="1ee93-258">Z důvodu normálního mechanismu rozlišení závislosti se ale používá, že IDbDependencyResolver lze použít k překladu DbProviderFactory i v případě, že nebyla provedena normální registrace ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="1ee93-258">But because of the normal dependency resolution mechanism is used it means that an IDbDependencyResolver can be used to resolve a DbProviderFactory even when normal ADO.NET registration has not been done.</span></span>

<span data-ttu-id="1ee93-259">Řešení DbProviderFactory tímto způsobem má několik dopadů:</span><span class="sxs-lookup"><span data-stu-id="1ee93-259">Resolving DbProviderFactory in this way has several implications:</span></span>

*   <span data-ttu-id="1ee93-260">Aplikace používající konfiguraci na základě kódu může přidat volání do své třídy DbConfiguration k registraci příslušného DbProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="1ee93-260">An application using code-based configuration can add calls in their DbConfiguration class to register the appropriate DbProviderFactory.</span></span> <span data-ttu-id="1ee93-261">To je užitečné hlavně u aplikací, které nechtějí (nebo nemůžou) používat jakoukoli konfiguraci založenou na souborech.</span><span class="sxs-lookup"><span data-stu-id="1ee93-261">This is especially useful for applications that do not want to (or cannot) make use of any file-based configuration at all.</span></span>
*   <span data-ttu-id="1ee93-262">Služba může být zabalená nebo nahrazená pomocí ReplaceService, jak je popsáno výše v části _poskytovatelé vybalení_ .</span><span class="sxs-lookup"><span data-stu-id="1ee93-262">The service can be wrapped or replaced using ReplaceService as described in the _Wrapping providers_ section above</span></span>
*   <span data-ttu-id="1ee93-263">Teoreticky by implementace DbProviderServices mohla vyřešit DbProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="1ee93-263">Theoretically, a DbProviderServices implementation could resolve a DbProviderFactory.</span></span>

<span data-ttu-id="1ee93-264">Důležité je vzít v vědomí, že při provádění kterékoli z těchto akcí budou mít vliv pouze na vyhledávání DbProviderFactory podle EF.</span><span class="sxs-lookup"><span data-stu-id="1ee93-264">The important point to note about doing any of these things is that they will only affect the lookup of DbProviderFactory by EF.</span></span> <span data-ttu-id="1ee93-265">Další kód, který není EF, může stále očekávat, že poskytovatel ADO.NET se má zaregistrovat v normálním způsobu, a pokud se registrace nenalezne, může selhat.</span><span class="sxs-lookup"><span data-stu-id="1ee93-265">Other non-EF code may still expect the ADO.NET provider to be registered in the normal way and may fail if the registration is not found.</span></span> <span data-ttu-id="1ee93-266">Z tohoto důvodu je obvykle lepší zaregistrovat DbProviderFactory v normálním ADO.NETm způsobu.</span><span class="sxs-lookup"><span data-stu-id="1ee93-266">For this reason it is normally better for a DbProviderFactory to be registered in the normal ADO.NET way.</span></span>

### <a name="related-services"></a><span data-ttu-id="1ee93-267">Související služby</span><span class="sxs-lookup"><span data-stu-id="1ee93-267">Related services</span></span>

<span data-ttu-id="1ee93-268">Pokud je k vyřešení DbProviderFactory použit EF, pak by měl také vyřešit služby IProviderInvariantName a IDbProviderFactoryResolver.</span><span class="sxs-lookup"><span data-stu-id="1ee93-268">If EF is used to resolve a DbProviderFactory, then it should also resolve the IProviderInvariantName and IDbProviderFactoryResolver services.</span></span>

<span data-ttu-id="1ee93-269">IProviderInvariantName je služba, která se používá k určení neutrálního názvu poskytovatele pro daný typ DbProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="1ee93-269">IProviderInvariantName is a service that is used to determine a provider invariant name for a given type of DbProviderFactory.</span></span> <span data-ttu-id="1ee93-270">Výchozí implementace této služby používá registraci poskytovatele ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="1ee93-270">The default implementation of this service uses the ADO.NET provider registration.</span></span> <span data-ttu-id="1ee93-271">To znamená, že pokud poskytovatel ADO.NET není zaregistrován v normálním způsobu, protože DbProviderFactory je vyřešen pomocí EF, bude také potřeba tuto službu vyřešit.</span><span class="sxs-lookup"><span data-stu-id="1ee93-271">This means that if the ADO.NET provider is not registered in the normal way because DbProviderFactory is being resolved by EF, then it will also be necessary to resolve this service.</span></span> <span data-ttu-id="1ee93-272">Všimněte si, že překladač pro tuto službu je automaticky přidán při použití metody DbConfiguration. SetProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="1ee93-272">Note that a resolver for this service is automatically added when using the DbConfiguration.SetProviderFactory method.</span></span>

<span data-ttu-id="1ee93-273">Jak je popsáno v části _Přehled typů zprostředkovatelů_ , se IDbProviderFactoryResolver používá k získání správného DbProviderFactory z daného objektu DbConnection.</span><span class="sxs-lookup"><span data-stu-id="1ee93-273">As described in the _Provider types overview_ section above, the IDbProviderFactoryResolver is used to obtain the correct DbProviderFactory from a given DbConnection object.</span></span> <span data-ttu-id="1ee93-274">Výchozí implementace této služby při spuštění v rozhraní .NET 4 používá registraci poskytovatele ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="1ee93-274">The default implementation of this service when running on .NET 4 uses the ADO.NET provider registration.</span></span> <span data-ttu-id="1ee93-275">To znamená, že pokud poskytovatel ADO.NET není zaregistrován v normálním způsobu, protože DbProviderFactory je vyřešen pomocí EF, bude také potřeba tuto službu vyřešit.</span><span class="sxs-lookup"><span data-stu-id="1ee93-275">This means that if the ADO.NET provider is not registered in the normal way because DbProviderFactory is being resolved by EF, then it will also be necessary to resolve this service.</span></span>
