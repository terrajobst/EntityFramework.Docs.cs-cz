---
title: Zprostředkovatel modelu Entity Framework 6 - EF6
author: divega
ms.date: 06/27/2018
ms.assetid: 066832F0-D51B-4655-8BE7-C983C557E0E4
ms.openlocfilehash: 8cbf6f87e0936f374c3d8a0c15a0e1d9c828f764
ms.sourcegitcommit: 159c2e9afed7745e7512730ffffaf154bcf2ff4a
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 02/03/2019
ms.locfileid: "55668749"
---
# <a name="the-entity-framework-6-provider-model"></a><span data-ttu-id="debdd-102">Zprostředkovatel modelu Entity Framework 6</span><span class="sxs-lookup"><span data-stu-id="debdd-102">The Entity Framework 6 provider model</span></span>

<span data-ttu-id="debdd-103">Zprostředkovatel modelu Entity Framework umožňuje Entity Framework, který se má použít s různými typy databázového serveru.</span><span class="sxs-lookup"><span data-stu-id="debdd-103">The Entity Framework provider model allows Entity Framework to be used with different types of database server.</span></span> <span data-ttu-id="debdd-104">Například jeden zprostředkovatel může být zapojené do elektrické zásuvky umožňující EF, který se má použít pro Microsoft SQL Server, zatímco jiný zprostředkovatel může být připojeno do umožňující EF, který se má použít pro Microsoft SQL Server Compact Edition.</span><span class="sxs-lookup"><span data-stu-id="debdd-104">For example, one provider can be plugged in to allow EF to be used against Microsoft SQL Server, while another provider can be plugged into to allow EF to be used against Microsoft SQL Server Compact Edition.</span></span> <span data-ttu-id="debdd-105">Zprostředkovatelé pro EF6, která víme o můžete najít na [zprostředkovatele Entity Framework](~/ef6/fundamentals/providers/index.md) stránky.</span><span class="sxs-lookup"><span data-stu-id="debdd-105">The providers for EF6 that we are aware of can be found on the [Entity Framework providers](~/ef6/fundamentals/providers/index.md) page.</span></span>

<span data-ttu-id="debdd-106">Některé změny byly zapotřebí způsobu, jakým EF spolupracuje s poskytovateli umožňující EF se vydávají se na základě licence open source.</span><span class="sxs-lookup"><span data-stu-id="debdd-106">Certain changes were required to the way EF interacts with providers to allow EF to be released under an open source license.</span></span> <span data-ttu-id="debdd-107">Tyto změny vyžadují opětovné sestavení zprostředkovatelů EF proti sestavení EF6 spolu s novou mechanismy pro registraci poskytovatele.</span><span class="sxs-lookup"><span data-stu-id="debdd-107">These changes require rebuilding of EF providers against the EF6 assemblies together with new mechanisms for registration of the provider.</span></span>

## <a name="rebuilding"></a><span data-ttu-id="debdd-108">Opětovné sestavení</span><span class="sxs-lookup"><span data-stu-id="debdd-108">Rebuilding</span></span>

<span data-ttu-id="debdd-109">S EF6 základní kód, který byl dřív součástí rozhraní .NET Framework se nyní dodává jako out-of-band (OOB) sestavení.</span><span class="sxs-lookup"><span data-stu-id="debdd-109">With EF6 the core code that was previously part of the .NET Framework is now being shipped as out-of-band (OOB) assemblies.</span></span> <span data-ttu-id="debdd-110">Podrobnosti o tom, jak vytvářet aplikace využívající EF6 můžete najít na [aktualizace aplikací pro EF6](~/ef6/what-is-new/upgrading-to-ef6.md) stránky.</span><span class="sxs-lookup"><span data-stu-id="debdd-110">Details on how to build applications against EF6 can be found on the [Updating applications for EF6](~/ef6/what-is-new/upgrading-to-ef6.md) page.</span></span> <span data-ttu-id="debdd-111">Poskytovatelé budete muset znovu vytvořit pomocí následujících pokynů.</span><span class="sxs-lookup"><span data-stu-id="debdd-111">Providers will also need to be rebuilt using these instructions.</span></span>

## <a name="provider-types-overview"></a><span data-ttu-id="debdd-112">Přehled zprostředkovatele typů</span><span class="sxs-lookup"><span data-stu-id="debdd-112">Provider types overview</span></span>

<span data-ttu-id="debdd-113">Poskytovatele EF je ve skutečnosti kolekce specifickým pro zprostředkovatele služeb definované typy CLR, které tyto služby rozšířit z (pro základní třídu) nebo implementovat (pro rozhraní).</span><span class="sxs-lookup"><span data-stu-id="debdd-113">An EF provider is really a collection of provider-specific services defined by CLR types that these services extend from (for a base class) or implement (for an interface).</span></span> <span data-ttu-id="debdd-114">Dva z těchto služeb jsou základní a nezbytné pro EF vůbec fungovat.</span><span class="sxs-lookup"><span data-stu-id="debdd-114">Two of these services are fundamental and necessary for EF to function at all.</span></span> <span data-ttu-id="debdd-115">Jiné jsou volitelné a pouze potřeba je implementovat, pokud konkrétní funkce jsou nezbytné a/nebo výchozí implementace těchto služeb nefunguje pro konkrétní databázový server, který se cílí.</span><span class="sxs-lookup"><span data-stu-id="debdd-115">Others are optional and only need to be implemented if specific functionality is required and/or the default implementations of these services does not work for the specific database server being targeted.</span></span>

## <a name="fundamental-provider-types"></a><span data-ttu-id="debdd-116">Základní poskytovatel typů</span><span class="sxs-lookup"><span data-stu-id="debdd-116">Fundamental provider types</span></span>

### <a name="dbproviderfactory"></a><span data-ttu-id="debdd-117">DbProviderFactory</span><span class="sxs-lookup"><span data-stu-id="debdd-117">DbProviderFactory</span></span>

<span data-ttu-id="debdd-118">EF závisí na typu odvozeného z [System.Data.Common.DbProviderFactory](https://msdn.microsoft.com/library/system.data.common.dbproviderfactory.aspx) pro provádění veškerý přístup nízké úrovně databáze.</span><span class="sxs-lookup"><span data-stu-id="debdd-118">EF depends on having a type derived from [System.Data.Common.DbProviderFactory](https://msdn.microsoft.com/library/system.data.common.dbproviderfactory.aspx) for performing all low-level database access.</span></span> <span data-ttu-id="debdd-119">DbProviderFactory není ve skutečnosti součástí EF, ale místo toho je třída v rozhraní .NET Framework, která slouží jako vstupní bod pro poskytovatele ADO.NET, který je možné pomocí EF, jiné vstupně/RMS. Přitom nezáleží, nebo přímo prostřednictvím aplikace k získání instance připojení, příkazy, parametry a jiné technologie ADO.NET abstrakcí ve zprostředkovateli způsobem, který nezohledňuje.</span><span class="sxs-lookup"><span data-stu-id="debdd-119">DbProviderFactory is not actually part of EF but is instead a class in the .NET Framework that serves an entry point for ADO.NET providers that can be used by EF, other O/RMs or directly by an application to obtain instances of connections, commands, parameters and other ADO.NET abstractions in a provider agnostic way.</span></span> <span data-ttu-id="debdd-120">Další informace o DbProviderFactory najdete v [dokumentaci MSDN pro technologii ADO.NET](https://msdn.microsoft.com/library/a6cd7c08.aspx).</span><span class="sxs-lookup"><span data-stu-id="debdd-120">More information about DbProviderFactory can be found in the [MSDN documentation for ADO.NET](https://msdn.microsoft.com/library/a6cd7c08.aspx).</span></span>

### <a name="dbproviderservices"></a><span data-ttu-id="debdd-121">DbProviderServices</span><span class="sxs-lookup"><span data-stu-id="debdd-121">DbProviderServices</span></span>

<span data-ttu-id="debdd-122">EF závisí na typu odvozeného z DbProviderServices pro zajištění další funkce vyžadované EF nad funkce už poskytované zprostředkovateli ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="debdd-122">EF depends on having a type derived from DbProviderServices for providing additional functionality needed by EF on top of the functionality already provided by the ADO.NET provider.</span></span> <span data-ttu-id="debdd-123">Ve starších verzích EF třída DbProviderServices byla součástí rozhraní .NET Framework a byla nalezena v oboru názvů System.Data.Common.</span><span class="sxs-lookup"><span data-stu-id="debdd-123">In older versions of EF the DbProviderServices class was part of the .NET Framework and was found in the System.Data.Common namespace.</span></span> <span data-ttu-id="debdd-124">Počínaje EF6 Tato třída je nyní součástí EntityFramework.dll a je v oboru názvů System.Data.Entity.Core.Common.</span><span class="sxs-lookup"><span data-stu-id="debdd-124">Starting with EF6 this class is now part of EntityFramework.dll and is in the System.Data.Entity.Core.Common namespace.</span></span>

<span data-ttu-id="debdd-125">Další informace o základních funkcích DbProviderServices implementace najdete na [MSDN](https://msdn.microsoft.com/library/ee789835.aspx).</span><span class="sxs-lookup"><span data-stu-id="debdd-125">More details about the fundamental functionality of a DbProviderServices implementation can be found on [MSDN](https://msdn.microsoft.com/library/ee789835.aspx).</span></span> <span data-ttu-id="debdd-126">Mějte však na paměti, že k datu zápisu tyto informace není aktualizován pro EF6 i když většina koncepty jsou stále platné.</span><span class="sxs-lookup"><span data-stu-id="debdd-126">However, note that as of the time of writing this information is not updated for EF6 although most of the concepts are still valid.</span></span> <span data-ttu-id="debdd-127">Implementace systému SQL Server a SQL Server Compact DbProviderServices se také kontroluje do [základu kódu open source](https://github.com/aspnet/EntityFramework6/) a může sloužit jako užitečné odkazy pro jiné implementace.</span><span class="sxs-lookup"><span data-stu-id="debdd-127">The SQL Server and SQL Server Compact implementations of DbProviderServices are also checked into to the [open-source codebase](https://github.com/aspnet/EntityFramework6/) and can serve as useful references for other implementations.</span></span>

<span data-ttu-id="debdd-128">Ve starších verzích EF byl získán implementace DbProviderServices k použití přímo z poskytovatele ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="debdd-128">In older versions of EF the DbProviderServices implementation to use was obtained directly from an ADO.NET provider.</span></span> <span data-ttu-id="debdd-129">To bylo provedeno přetypování DbProviderFactory na IServiceProvider a voláním metody GetService.</span><span class="sxs-lookup"><span data-stu-id="debdd-129">This was done by casting DbProviderFactory to IServiceProvider and calling the GetService method.</span></span> <span data-ttu-id="debdd-130">Tento zprostředkovatel EF těsně spjat s DbProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="debdd-130">This tightly coupled the EF provider to the DbProviderFactory.</span></span> <span data-ttu-id="debdd-131">Toto párování blokovat EF přesouvaných mimo rozhraní .NET Framework a proto pro EF6 tento určitou úzkou svázanost byla odebrána a implementace DbProviderServices je teď zaregistrovaný přímo v konfiguračním souboru aplikace nebo na úrovni kódu konfigurace, jak je popsáno podrobněji _registrace DbProviderServices_ níže v části.</span><span class="sxs-lookup"><span data-stu-id="debdd-131">This coupling blocked EF from being moved out of the .NET Framework and therefore for EF6 this tight coupling has been removed and an implementation of DbProviderServices is now registered directly in the application’s configuration file or in code-based configuration as described in more detail the _Registering DbProviderServices_ section below.</span></span>

## <a name="additional-services"></a><span data-ttu-id="debdd-132">Další služby</span><span class="sxs-lookup"><span data-stu-id="debdd-132">Additional services</span></span>

<span data-ttu-id="debdd-133">Kromě základních služeb popsaných výše existují také mnoho dalších služeb používaných v EF které jsou vždy nebo někdy specifickým pro zprostředkovatele.</span><span class="sxs-lookup"><span data-stu-id="debdd-133">In addition to the fundamental services described above there are also many other services used by EF which are either always or sometimes provider-specific.</span></span> <span data-ttu-id="debdd-134">Implementací DbProviderServices lze je zadat výchozí implementace specifickým pro zprostředkovatele z těchto služeb.</span><span class="sxs-lookup"><span data-stu-id="debdd-134">Default provider-specific implementations of these services can be supplied by a DbProviderServices implementation.</span></span> <span data-ttu-id="debdd-135">Aplikace můžete také přepsat implementace těchto služeb nebo poskytnout implementace, pokud typ DbProviderServices neposkytuje výchozí.</span><span class="sxs-lookup"><span data-stu-id="debdd-135">Applications can also override the implementations of these services, or provide implementations when a DbProviderServices type does not provide a default.</span></span> <span data-ttu-id="debdd-136">To je popsáno podrobněji _řešení dalšími službami_ níže v části.</span><span class="sxs-lookup"><span data-stu-id="debdd-136">This is described in more detail in the _Resolving additional services_ section below.</span></span>

<span data-ttu-id="debdd-137">Typy další služby, které mohou být zprostředkovatele, abyste zprostředkovatele jsou uvedeny níže.</span><span class="sxs-lookup"><span data-stu-id="debdd-137">The additional service types that a provider may be of interest to a provider are listed below.</span></span> <span data-ttu-id="debdd-138">Další podrobnosti o každém z těchto typů služeb najdete v dokumentaci k rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="debdd-138">More details about each of these service types can be found in the API documentation.</span></span>

### <a name="idbexecutionstrategy"></a><span data-ttu-id="debdd-139">IDbExecutionStrategy</span><span class="sxs-lookup"><span data-stu-id="debdd-139">IDbExecutionStrategy</span></span>

<span data-ttu-id="debdd-140">Toto je volitelnou službu, která umožňuje poskytovateli implementovat opakování nebo jiné chování při spuštění dotazů a příkazů na databázi.</span><span class="sxs-lookup"><span data-stu-id="debdd-140">This is an optional service that allows a provider to implement retries or other behavior when queries and commands are executed against the database.</span></span> <span data-ttu-id="debdd-141">Pokud je k dispozici žádná implementace, pak EF jednoduše spustí příkazy a šířit všechny výjimky vyvolané.</span><span class="sxs-lookup"><span data-stu-id="debdd-141">If no implementation is provided, then EF will simply execute the commands and propagate any exceptions thrown.</span></span> <span data-ttu-id="debdd-142">Tato služba se pro SQL Server používá k poskytování zásady opakování, který je obzvláště užitečná při spouštění cloudové databázové servery, jako je například SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="debdd-142">For SQL Server this service is used to provide a retry policy which is especially useful when running against cloud-based database servers such as SQL Azure.</span></span>

### <a name="idbconnectionfactory"></a><span data-ttu-id="debdd-143">IDbConnectionFactory</span><span class="sxs-lookup"><span data-stu-id="debdd-143">IDbConnectionFactory</span></span>

<span data-ttu-id="debdd-144">Toto je volitelnou službu, která umožňuje poskytovateli k vytváření objektů DbConnection podle konvence při pouze název databáze.</span><span class="sxs-lookup"><span data-stu-id="debdd-144">This is an optional service that allows a provider to create DbConnection objects by convention when given only a database name.</span></span> <span data-ttu-id="debdd-145">Pamatujte, že zatímco tato služba dá vyřešit implementací DbProviderServices byla k dispozici od verze EF 4.1 a můžete také explicitně nastavit v konfiguračním souboru nebo v kódu.</span><span class="sxs-lookup"><span data-stu-id="debdd-145">Note that while this service can be resolved by a DbProviderServices implementation it has been present since EF 4.1 and can also be explicitly set in either the config file or in code.</span></span> <span data-ttu-id="debdd-146">Zprostředkovatel se zobrazí pouze příležitost dobře se vyřešit tuto službu, pokud je registrován jako výchozího zprostředkovatele (naleznete v tématu _výchozího zprostředkovatele_ níže) a pokud nebyl nastaven výchozí objekt factory připojení, jinde.</span><span class="sxs-lookup"><span data-stu-id="debdd-146">The provider will only get a chance to resolve this service if it registered as the default provider (see _The default provider_ below) and if a default connection factory has not been set elsewhere.</span></span>

### <a name="dbspatialservices"></a><span data-ttu-id="debdd-147">DbSpatialServices</span><span class="sxs-lookup"><span data-stu-id="debdd-147">DbSpatialServices</span></span>

<span data-ttu-id="debdd-148">Toto je volitelné služby, které umožňuje poskytovateli a přidat podporu pro typy prostorových zeměpisné oblasti a geometry.</span><span class="sxs-lookup"><span data-stu-id="debdd-148">This is an optional services that allows a provider to add support for geography and geometry spatial types.</span></span> <span data-ttu-id="debdd-149">Implementace této služby je nutné zadat v pořadí pro aplikace pomocí EF prostorové typy.</span><span class="sxs-lookup"><span data-stu-id="debdd-149">An implementation of this service must be supplied in order for an application to use EF with spatial types.</span></span> <span data-ttu-id="debdd-150">DbSptialServices se zobrazí výzva pro dvěma způsoby.</span><span class="sxs-lookup"><span data-stu-id="debdd-150">DbSptialServices is asked for in two ways.</span></span> <span data-ttu-id="debdd-151">První, specifickým pro zprostředkovatele prostorových služeb jsou požadovány pomocí objektu DbProviderInfo (obsahující invariantní vzhledem k názvu a manifestu token) jako klíč.</span><span class="sxs-lookup"><span data-stu-id="debdd-151">First, provider-specific spatial services are requested using a DbProviderInfo object (which contains invariant name and manifest token) as key.</span></span> <span data-ttu-id="debdd-152">Za druhé DbSpatialServices můžete požádat bez klíče.</span><span class="sxs-lookup"><span data-stu-id="debdd-152">Second, DbSpatialServices can be asked for with no key.</span></span> <span data-ttu-id="debdd-153">To se používá k překladu "globální prostorových poskytovatele", který se používá při vytváření samostatných DbGeography nebo DbGeometry typů.</span><span class="sxs-lookup"><span data-stu-id="debdd-153">This is used to resolve the “global spatial provider” that is used when creating stand-alone DbGeography or DbGeometry types.</span></span>

### <a name="migrationsqlgenerator"></a><span data-ttu-id="debdd-154">MigrationSqlGenerator</span><span class="sxs-lookup"><span data-stu-id="debdd-154">MigrationSqlGenerator</span></span>

<span data-ttu-id="debdd-155">Toto je volitelnou službu, která umožňuje migraci EF, který bude používán pro generování SQL použít při vytváření a úpravy databázových schématech Code First.</span><span class="sxs-lookup"><span data-stu-id="debdd-155">This is an optional service that allows EF Migrations to be used for the generation of SQL used in creating and modifying database schemas by Code First.</span></span> <span data-ttu-id="debdd-156">Implementace je nutné pro podporu migrace.</span><span class="sxs-lookup"><span data-stu-id="debdd-156">An implementation is required in order to support Migrations.</span></span> <span data-ttu-id="debdd-157">Pokud je k dispozici implementace pak také použije při vytváření databáze pomocí databáze inicializátory nebo Database.Create metody.</span><span class="sxs-lookup"><span data-stu-id="debdd-157">If an implementation is provided then it will also be used when databases are created using database initializers or the Database.Create method.</span></span>

### <a name="funcdbconnection-string-historycontextfactory"></a><span data-ttu-id="debdd-158">Func<DbConnection, string, HistoryContextFactory></span><span class="sxs-lookup"><span data-stu-id="debdd-158">Func<DbConnection, string, HistoryContextFactory></span></span>

<span data-ttu-id="debdd-159">Toto je volitelnou službu, která umožňuje poskytovateli ke konfiguraci mapování HistoryContext k `__MigrationHistory` tabulky používané migrace EF.</span><span class="sxs-lookup"><span data-stu-id="debdd-159">This is an optional service that allows a provider to configure the mapping of the HistoryContext to the `__MigrationHistory` table used by EF Migrations.</span></span> <span data-ttu-id="debdd-160">HistoryContext je první DbContext kódu a lze nakonfigurovat pomocí rozhraní fluent API pro běžné věci, jako je název tabulky a specifikace mapování sloupce změnit.</span><span class="sxs-lookup"><span data-stu-id="debdd-160">The HistoryContext is a Code First DbContext and can be configured using the normal fluent API to change things like the name of the table and the column mapping specifications.</span></span> <span data-ttu-id="debdd-161">Výchozí implementace této služby vrátil EF pro všemi zprostředkovateli může fungovat pro danou databázi serveru, pokud všechny výchozí sloupce a tabulky mapování podporovaných tímto poskytovatelem.</span><span class="sxs-lookup"><span data-stu-id="debdd-161">The default implementation of this service returned by EF for all providers may work for a given database server if all the default table and column mappings are supported by that provider.</span></span> <span data-ttu-id="debdd-162">V takovém případě zprostředkovatele není nutné poskytnout implementaci této služby.</span><span class="sxs-lookup"><span data-stu-id="debdd-162">In such a case the provider does not need to supply an implementation of this service.</span></span>

### <a name="idbproviderfactoryresolver"></a><span data-ttu-id="debdd-163">IDbProviderFactoryResolver</span><span class="sxs-lookup"><span data-stu-id="debdd-163">IDbProviderFactoryResolver</span></span>

<span data-ttu-id="debdd-164">Toto je volitelnou službu pro získání správné DbProviderFactory ze zadaný objekt DbConnection.</span><span class="sxs-lookup"><span data-stu-id="debdd-164">This is an optional service for obtaining the correct DbProviderFactory from a given DbConnection object.</span></span> <span data-ttu-id="debdd-165">Výchozí implementace této služby vrátil EF pro všech zprostředkovatelů by měla fungovat pro všechny poskytovatele.</span><span class="sxs-lookup"><span data-stu-id="debdd-165">The default implementation of this service returned by EF for all providers is intended to work for all providers.</span></span> <span data-ttu-id="debdd-166">Ale při spuštění v rozhraní .NET 4, DbProviderFactory není veřejně přístupná z jednoho pokud jeho DbConnections.</span><span class="sxs-lookup"><span data-stu-id="debdd-166">However, when running on .NET 4, the DbProviderFactory is not publicly accessible from one if its DbConnections.</span></span> <span data-ttu-id="debdd-167">Proto EF používá některé z heuristických metod k hledání registrovaných zprostředkovatelů pro vyhledání shody.</span><span class="sxs-lookup"><span data-stu-id="debdd-167">Therefore, EF uses some heuristics to search the registered providers to find a match.</span></span> <span data-ttu-id="debdd-168">Je možné, že pro někteří poskytovatelé tyto heuristiky selže a v takových situacích by mělo nabízet poskytovateli novou implementaci.</span><span class="sxs-lookup"><span data-stu-id="debdd-168">It is possible that for some providers these heuristics will fail and in such situations the provider should supply a new implementation.</span></span>

## <a name="registering-dbproviderservices"></a><span data-ttu-id="debdd-169">Registrace DbProviderServices</span><span class="sxs-lookup"><span data-stu-id="debdd-169">Registering DbProviderServices</span></span>

<span data-ttu-id="debdd-170">Implementace DbProviderServices použití lze zaregistrovat, buď v konfiguračním souboru (app.config nebo web.config) nebo pomocí konfigurace založená na kódu vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="debdd-170">The DbProviderServices implementation to use can be registered either in the application’s configuration file (app.config or web.config) or using code-based configuration.</span></span> <span data-ttu-id="debdd-171">V obou případech používá registraci poskytovatele "výchozím názvem" jako klíč.</span><span class="sxs-lookup"><span data-stu-id="debdd-171">In either case the registration uses the provider’s “invariant name” as a key.</span></span> <span data-ttu-id="debdd-172">To umožňuje více poskytovatelů zaregistrované a použít v jedné aplikaci.</span><span class="sxs-lookup"><span data-stu-id="debdd-172">This allows multiple providers to be registered and used in a single application.</span></span> <span data-ttu-id="debdd-173">Neutrální název použitý pro EF registrace je stejný jako výchozí název použitý pro registraci a připojovací řetězce zprostředkovatele ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="debdd-173">The invariant name used for EF registrations is the same as the invariant name used for ADO.NET provider registration and connection strings.</span></span> <span data-ttu-id="debdd-174">Například pro SQL Server výchozí název se používá "System.Data.SqlClient".</span><span class="sxs-lookup"><span data-stu-id="debdd-174">For example, for SQL Server the invariant name “System.Data.SqlClient” is used.</span></span>

### <a name="config-file-registration"></a><span data-ttu-id="debdd-175">Registrace konfiguračního souboru</span><span class="sxs-lookup"><span data-stu-id="debdd-175">Config file registration</span></span>

<span data-ttu-id="debdd-176">Typ DbProviderServices má být použit se zaregistruje jako prvek poskytovatele v seznamu poskytovatelů entityFramework oddílu konfiguračního souboru aplikace.</span><span class="sxs-lookup"><span data-stu-id="debdd-176">The DbProviderServices type to use is registered as a provider element in the providers list of the entityFramework section of the application’s config file.</span></span> <span data-ttu-id="debdd-177">Příklad:</span><span class="sxs-lookup"><span data-stu-id="debdd-177">For example:</span></span>

``` xml
<entityFramework>
  <providers>
    <provider invariantName="My.Invariant.Name" type="MyProvider.MyProviderServices, MyAssembly" />
  </providers>
</entityFramework>
```

<span data-ttu-id="debdd-178">_Typ_ řetězec musí být název typu kvalifikovaného pro sestavení implementace DbProviderServices používat.</span><span class="sxs-lookup"><span data-stu-id="debdd-178">The _type_ string must be the assembly-qualified type name of the DbProviderServices implementation to use.</span></span>

### <a name="code-based-registration"></a><span data-ttu-id="debdd-179">Registrace na úrovni kódu</span><span class="sxs-lookup"><span data-stu-id="debdd-179">Code-based registration</span></span>

<span data-ttu-id="debdd-180">Počínaje EF6 poskytovatelé lze také zaregistrovat pomocí kódu.</span><span class="sxs-lookup"><span data-stu-id="debdd-180">Starting with EF6 providers can also be registered using code.</span></span> <span data-ttu-id="debdd-181">To umožňuje na EF poskytovatele, který se dá používat bez změny do konfiguračního souboru aplikace.</span><span class="sxs-lookup"><span data-stu-id="debdd-181">This allows an EF provider to be used without any change to the application’s configuration file.</span></span> <span data-ttu-id="debdd-182">Použití konfigurace založená na kód aplikace by měl vytvořit třídu DbConfiguration jak je popsáno v [dokumentaci založený na kódu konfigurační](https://msdn.com/data/jj680699).</span><span class="sxs-lookup"><span data-stu-id="debdd-182">To use code-based configuration an application should create a DbConfiguration class as described in the [code-based configuration documentation](https://msdn.com/data/jj680699).</span></span> <span data-ttu-id="debdd-183">Konstruktor třídy DbConfiguration by měly volat pak SetProviderServices zaregistrujte poskytovatele EF.</span><span class="sxs-lookup"><span data-stu-id="debdd-183">The constructor of the DbConfiguration class should then call SetProviderServices to register the EF provider.</span></span> <span data-ttu-id="debdd-184">Příklad:</span><span class="sxs-lookup"><span data-stu-id="debdd-184">For example:</span></span>

``` csharp
public class MyConfiguration : DbConfiguration
{
    public MyConfiguration()
    {
        SetProviderServices("My.New.Provider", new MyProviderServices());
    }
}
```

## <a name="resolving-additional-services"></a><span data-ttu-id="debdd-185">Řešení dalších služeb</span><span class="sxs-lookup"><span data-stu-id="debdd-185">Resolving additional services</span></span>

<span data-ttu-id="debdd-186">Jak je uvedeno výše v _poskytovatele typů přehled_ části, DbProviderServices třídy lze použít také k vyřešení dalších služeb.</span><span class="sxs-lookup"><span data-stu-id="debdd-186">As mentioned above in the _Provider types overview_ section, a DbProviderServices class can also be used to resolve additional services.</span></span> <span data-ttu-id="debdd-187">To je možné, protože implementuje DbProviderServices IDbDependencyResolver a každý registrovaný typ DbProviderServices se přidá jako "výchozí překladač".</span><span class="sxs-lookup"><span data-stu-id="debdd-187">This is possible because DbProviderServices implements IDbDependencyResolver and each registered DbProviderServices type is added as a “default resolver”.</span></span> <span data-ttu-id="debdd-188">Mechanismus IDbDpendencyResolver je popsána podrobněji [řešení závislostí](~/ef6/fundamentals/configuring/dependency-resolution.md).</span><span class="sxs-lookup"><span data-stu-id="debdd-188">The IDbDpendencyResolver mechanism is described in more detail in [Dependency Resolution](~/ef6/fundamentals/configuring/dependency-resolution.md).</span></span> <span data-ttu-id="debdd-189">Není však nutné koncepce všechny v téhle specifikaci k vyřešení dalších služeb ve zprostředkovateli.</span><span class="sxs-lookup"><span data-stu-id="debdd-189">However, it is not necessary to understand all the concepts in this specification to resolve additional services in a provider.</span></span>

<span data-ttu-id="debdd-190">Nejběžnější způsob pro poskytovatelem a vyřešit dalších služeb je volat pro každou službu v konstruktoru třídy DbProviderServices DbProviderServices.AddDependencyResolver.</span><span class="sxs-lookup"><span data-stu-id="debdd-190">The most common way for a provider to resolve additional services is to call DbProviderServices.AddDependencyResolver for each service in the constructor of the DbProviderServices class.</span></span> <span data-ttu-id="debdd-191">Například SqlProviderServices (EF provider pro SQL Server) je podobný inicializaci kód:</span><span class="sxs-lookup"><span data-stu-id="debdd-191">For example, SqlProviderServices (the EF provider for SQL Server) has code similar to this for initialization:</span></span>

``` csharp
private SqlProviderServices()
{
    AddDependencyResolver(new SingletonDependencyResolver<IDbConnectionFactory>(
        new SqlConnectionFactory()));

    AddDependencyResolver(new ExecutionStrategyResolver<DefaultSqlExecutionStrategy>(
        "System.data.SqlClient", null, () => new DefaultSqlExecutionStrategy()));

    AddDependencyResolver(new SingletonDependencyResolver<Func<MigrationSqlGenerator>>(
        () => new SqlServerMigrationSqlGenerator(), "System.data.SqlClient"));

    AddDependencyResolver(new SingletonDependencyResolver<DbSpatialServices>(
        SqlSpatialServices.Instance,
        k =>
        {
            var asSpatialKey = k as DbProviderInfo;
            return asSpatialKey == null
                || asSpatialKey.ProviderInvariantName == ProviderInvariantName;
        }));
}
```

<span data-ttu-id="debdd-192">Tento konstruktor používá následující tříd pomocných rutin:</span><span class="sxs-lookup"><span data-stu-id="debdd-192">This constructor uses the following helper classes:</span></span>

*   <span data-ttu-id="debdd-193">SingletonDependencyResolver: poskytuje jednoduchý způsob, jak vyřešit deklarace služeb typu Singleton – to znamená, služby, pro které stejnou instanci je vrácena pokaždé, když, že je volat GetService.</span><span class="sxs-lookup"><span data-stu-id="debdd-193">SingletonDependencyResolver: provides a simple way to resolve Singleton services—that is, services for which the same instance is returned each time that GetService is called.</span></span> <span data-ttu-id="debdd-194">Přechodné služby jsou často registrován jako objekt pro vytváření jednotlivý prvek, který se použije pro vytvoření přechodné instancí na vyžádání.</span><span class="sxs-lookup"><span data-stu-id="debdd-194">Transient services are often registered as a singleton factory that will be used to create transient instances on demand.</span></span>
*   <span data-ttu-id="debdd-195">ExecutionStrategyResolver: překladače specifické pro vrácení IExecutionStrategy implementace.</span><span class="sxs-lookup"><span data-stu-id="debdd-195">ExecutionStrategyResolver: a resolver specific to returning IExecutionStrategy implementations.</span></span>

<span data-ttu-id="debdd-196">Namísto použití DbProviderServices.AddDependencyResolver je také možné přepsat DbProviderServices.GetService a dalších služeb vyřešit přímo.</span><span class="sxs-lookup"><span data-stu-id="debdd-196">Instead of using DbProviderServices.AddDependencyResolver it is also possible to override DbProviderServices.GetService and resolve additional services directly.</span></span> <span data-ttu-id="debdd-197">Tato metoda bude volána, když EF potřebuje služba definovány dobou určitého typu a v některých případech se pro zadaný klíč.</span><span class="sxs-lookup"><span data-stu-id="debdd-197">This method will be called when EF needs a service defined by a certain type and, in some cases, for a given key.</span></span> <span data-ttu-id="debdd-198">Metoda by měla vrátit služby, pokud můžete, nebo vrátit hodnotu null se odhlásit vrácení službu a místo toho bylo jiné třídy k jeho vyřešení.</span><span class="sxs-lookup"><span data-stu-id="debdd-198">The method should return the service if it can, or return null to opt-out of returning the service and instead allow another class to resolve it.</span></span> <span data-ttu-id="debdd-199">Například chcete-li vyřešit výchozí objekt pro vytváření připojení kódu v GetService může vypadat přibližně takto:</span><span class="sxs-lookup"><span data-stu-id="debdd-199">For example, to resolve the default connection factory the code in GetService might look something like this:</span></span>

``` csharp
public override object GetService(Type type, object key)
{
    if (type == typeof(IDbConnectionFactory))
    {
        return new SqlConnectionFactory();
    }
    return null;
}
```

### <a name="registration-order"></a><span data-ttu-id="debdd-200">Registrace pořadí</span><span class="sxs-lookup"><span data-stu-id="debdd-200">Registration order</span></span>

<span data-ttu-id="debdd-201">Když více implementací DbProviderServices zaregistrovaní v konfiguračním souboru aplikace budou přidány jako sekundární překladače v pořadí, ve kterém jsou uvedené.</span><span class="sxs-lookup"><span data-stu-id="debdd-201">When multiple DbProviderServices implementations are registered in an application’s config file they will be added as secondary resolvers in the order that they are listed.</span></span> <span data-ttu-id="debdd-202">Protože překladače jsou vždy přidány na začátek řetězce sekundární překladače, to znamená, že poskytovatel na konci seznamu mít šanci vyřešit závislosti než ostatní.</span><span class="sxs-lookup"><span data-stu-id="debdd-202">Since resolvers are always added to the top of the secondary resolver chain this means that the provider at the end of the list will get a chance to resolve dependencies before the others.</span></span> <span data-ttu-id="debdd-203">(To se může zdát trochu counter-intuitive zpočátku, ale dává smysl, pokud si představíte, přičemž každý poskytovatel ze seznamu a skládání nad existující poskytovatelé.)</span><span class="sxs-lookup"><span data-stu-id="debdd-203">(This can seem a little counter-intuitive at first, but it makes sense if you imagine taking each provider out of the list and stacking it on top of the existing providers.)</span></span>

<span data-ttu-id="debdd-204">Toto uspořádání obvykle nebude vadit, protože většina poskytovatele služeb jsou specifické pro zprostředkovatele a s klíči ve výchozí název zprostředkovatele.</span><span class="sxs-lookup"><span data-stu-id="debdd-204">This ordering usually doesn’t matter because most provider services are provider-specific and keyed by provider invariant name.</span></span> <span data-ttu-id="debdd-205">Ale pro služby, které nejsou označenými pomocí výchozí název zprostředkovatele nebo některé jiné specifickým pro zprostředkovatele klíč, který se vyřeší služby založené na tomto pořadí.</span><span class="sxs-lookup"><span data-stu-id="debdd-205">However, for services that are not keyed by provider invariant name or some other provider-specific key the service will be resolved based on this ordering.</span></span> <span data-ttu-id="debdd-206">Například pokud není explicitně nastavena jinak někde jinde, pak výchozí objekt pro vytváření připojení budou přicházet z nejvyšší zprostředkovatele v řetězci.</span><span class="sxs-lookup"><span data-stu-id="debdd-206">For example, if it is not explicitly set differently somewhere else, then the default connection factory will come from the topmost provider in the chain.</span></span>

## <a name="additional-config-file-registrations"></a><span data-ttu-id="debdd-207">Další konfigurační soubor registrace</span><span class="sxs-lookup"><span data-stu-id="debdd-207">Additional config file registrations</span></span>

<span data-ttu-id="debdd-208">Je možné explicitně zaregistrovat některé další poskytovatele služeb bylo popsáno výše přímo v konfiguračním souboru aplikace.</span><span class="sxs-lookup"><span data-stu-id="debdd-208">It is possible to explicitly register some of the additional provider services described above directly in an application’s config file.</span></span> <span data-ttu-id="debdd-209">Když to se provádí registraci v konfiguračním souboru se použijí místo nic vrácený metodou GetService DbProviderServices implementace.</span><span class="sxs-lookup"><span data-stu-id="debdd-209">When this is done the registration in the config file will be used instead of anything returned by the GetService method of the DbProviderServices implementation.</span></span>

### <a name="registering-the-default-connection-factory"></a><span data-ttu-id="debdd-210">Registruje výchozí objekt pro vytváření připojení</span><span class="sxs-lookup"><span data-stu-id="debdd-210">Registering the default connection factory</span></span>

<span data-ttu-id="debdd-211">Počínaje EF5 balíček EntityFramework NuGet automaticky registrovaný objekt factory připojení SQL Express nebo objekt factory LocalDb připojení v konfiguračním souboru.</span><span class="sxs-lookup"><span data-stu-id="debdd-211">Starting with EF5 the EntityFramework NuGet package automatically registered either the SQL Express connection factory or the LocalDb connection factory in the config file.</span></span>

<span data-ttu-id="debdd-212">Příklad:</span><span class="sxs-lookup"><span data-stu-id="debdd-212">For example:</span></span>

``` xml
<entityFramework>
  <defaultConnectionFactory type="System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework" >
</entityFramework>
```

<span data-ttu-id="debdd-213">_Typ_ je název typu kvalifikovaného pro sestavení pro objekt factory připojení výchozí musí implementovat IDbConnectionFactory.</span><span class="sxs-lookup"><span data-stu-id="debdd-213">The _type_ is the assembly-qualified type name for the default connection factory, which must implement IDbConnectionFactory.</span></span>

<span data-ttu-id="debdd-214">Doporučuje se, že balíček NuGet zprostředkovatele nastavit tímto způsobem při instalaci výchozí objekt factory připojení.</span><span class="sxs-lookup"><span data-stu-id="debdd-214">It is recommended that a provider NuGet package set the default connection factory in this way when installed.</span></span> <span data-ttu-id="debdd-215">Zobrazit _balíčky NuGet pro poskytovatele_ níže.</span><span class="sxs-lookup"><span data-stu-id="debdd-215">See _NuGet Packages for providers_ below.</span></span>

## <a name="additional-ef6-provider-changes"></a><span data-ttu-id="debdd-216">Další změny poskytovatele EF6</span><span class="sxs-lookup"><span data-stu-id="debdd-216">Additional EF6 provider changes</span></span>

### <a name="spatial-provider-changes"></a><span data-ttu-id="debdd-217">Prostorový poskytovatel změny</span><span class="sxs-lookup"><span data-stu-id="debdd-217">Spatial provider changes</span></span>

<span data-ttu-id="debdd-218">Poskytovatelé, které podporují prostorové typy nyní musí implementovat některé další metody u tříd odvozených z DbSpatialDataReader:</span><span class="sxs-lookup"><span data-stu-id="debdd-218">Providers that support spatial types must now implement some additional methods on classes deriving from DbSpatialDataReader:</span></span>

*   `public abstract bool IsGeographyColumn(int ordinal)`
*   `public abstract bool IsGeometryColumn(int ordinal)`

<span data-ttu-id="debdd-219">Existují také nové asynchronní verze stávající metody, které se doporučují jako výchozí implementace delegovat na synchronní metody a proto se neprovedou asynchronně přepsání:</span><span class="sxs-lookup"><span data-stu-id="debdd-219">There are also new asynchronous versions of existing methods that are recommended to be overridden as the default implementations delegate to the synchronous methods and therefore do not execute asynchronously:</span></span>

*   `public virtual Task<DbGeography> GetGeographyAsync(int ordinal, CancellationToken cancellationToken)`
*   `public virtual Task<DbGeometry> GetGeometryAsync(int ordinal, CancellationToken cancellationToken)`

### <a name="native-support-for-enumerablecontains"></a><span data-ttu-id="debdd-220">Nativní podpora pro Enumerable.Contains</span><span class="sxs-lookup"><span data-stu-id="debdd-220">Native support for Enumerable.Contains</span></span>

<span data-ttu-id="debdd-221">EF6 zavádí nový typ výrazu DbInExpression, který se přidal k řešení potíží s výkonem kolem užívání Enumerable.Contains v dotazech LINQ.</span><span class="sxs-lookup"><span data-stu-id="debdd-221">EF6 introduces a new expression type, DbInExpression, which was added to address performance issues around use of Enumerable.Contains in LINQ queries.</span></span> <span data-ttu-id="debdd-222">Třída DbProviderManifest má novou virtuální metodou, SupportsInExpression, které je voláno rozhraním EF k určení, pokud zprostředkovatel zpracovává nový typ výrazu.</span><span class="sxs-lookup"><span data-stu-id="debdd-222">The DbProviderManifest class has a new virtual method, SupportsInExpression, which is called by EF to determine if a provider handles the new expression type.</span></span> <span data-ttu-id="debdd-223">Z důvodu kompatibility s existující implementace poskytovatele metoda vrátí hodnotu false.</span><span class="sxs-lookup"><span data-stu-id="debdd-223">For compatibility with existing provider implementations the method returns false.</span></span> <span data-ttu-id="debdd-224">Toto vylepšení využít, poskytovatele EF6 přidat kód pro zpracování DbInExpression a přepsání SupportsInExpression vrátit hodnotu true.</span><span class="sxs-lookup"><span data-stu-id="debdd-224">To benefit from this improvement, an EF6 provider can add code to handle DbInExpression and override SupportsInExpression to return true.</span></span> <span data-ttu-id="debdd-225">Instance DbInExpression lze vytvořit voláním metody DbExpressionBuilder.In.</span><span class="sxs-lookup"><span data-stu-id="debdd-225">An instance of DbInExpression can be created by calling the DbExpressionBuilder.In method.</span></span> <span data-ttu-id="debdd-226">DbInExpression instance se skládá z DbExpression, obvykle představuje sloupci tabulky a seznam DbConstantExpression testování shody.</span><span class="sxs-lookup"><span data-stu-id="debdd-226">A DbInExpression instance is composed of a DbExpression, usually representing a table column, and a list of DbConstantExpression to test for a match.</span></span>

## <a name="nuget-packages-for-providers"></a><span data-ttu-id="debdd-227">Balíčky NuGet pro poskytovatele</span><span class="sxs-lookup"><span data-stu-id="debdd-227">NuGet packages for providers</span></span>

<span data-ttu-id="debdd-228">Jedním ze způsobů zpřístupnit poskytovatele EF6 je verze jako balíček NuGet.</span><span class="sxs-lookup"><span data-stu-id="debdd-228">One way to make an EF6 provider available is to release it as a NuGet package.</span></span> <span data-ttu-id="debdd-229">Pomocí balíčku NuGet má následující výhody:</span><span class="sxs-lookup"><span data-stu-id="debdd-229">Using a NuGet package has the following advantages:</span></span>

*   <span data-ttu-id="debdd-230">Je snadno použitelný NuGet pro přidání registrace poskytovatele do konfiguračního souboru aplikace</span><span class="sxs-lookup"><span data-stu-id="debdd-230">It is easy to use NuGet to add the provider registration to the application’s config file</span></span>
*   <span data-ttu-id="debdd-231">Další změny, které můžete provést do konfiguračního souboru k nastavení výchozí objekt pro vytváření připojení tak, aby provedené při vytváření připojení budou používat registrovaného zprostředkovatele</span><span class="sxs-lookup"><span data-stu-id="debdd-231">Additional changes can be made to the config file to set the default connection factory so that connections made by convention will use the registered provider</span></span>
*   <span data-ttu-id="debdd-232">Obslužné rutiny NuGet tak, aby zprostředkovatel EF6 by měly být nadále fungovat i po vydání nového balíčku EF přidání přesměrování vazeb</span><span class="sxs-lookup"><span data-stu-id="debdd-232">NuGet handles adding binding redirects so that the EF6 provider should continue to work even after a new EF package is released</span></span>

<span data-ttu-id="debdd-233">Příkladem je EntityFramework.SqlServerCompact balíček, který je součástí [opensourcových codebase](http://github.com/aspnet/entityframework6).</span><span class="sxs-lookup"><span data-stu-id="debdd-233">An example of this is the EntityFramework.SqlServerCompact package which is included in the [open source codebase](http://github.com/aspnet/entityframework6).</span></span> <span data-ttu-id="debdd-234">Tento balíček poskytuje dobré šablony pro vytváření balíčků NuGet EF zprostředkovatele.</span><span class="sxs-lookup"><span data-stu-id="debdd-234">This package provides a good template for creating EF provider NuGet packages.</span></span>

### <a name="powershell-commands"></a><span data-ttu-id="debdd-235">Příkazy prostředí PowerShell</span><span class="sxs-lookup"><span data-stu-id="debdd-235">PowerShell commands</span></span>

<span data-ttu-id="debdd-236">Při instalaci balíčku EntityFramework NuGet registruje modul Powershellu, který obsahuje dva příkazy, které jsou velmi užitečné pro zprostředkovatele balíčky:</span><span class="sxs-lookup"><span data-stu-id="debdd-236">When the EntityFramework NuGet package is installed it registers a PowerShell module that contains two commands that are very useful for provider packages:</span></span>

*   <span data-ttu-id="debdd-237">Přidat EFProvider přidá novou entitu pro zprostředkovatele v konfiguračním souboru na cílový projekt a je zajištěno, že je na konci seznamu registrovaných zprostředkovatelů.</span><span class="sxs-lookup"><span data-stu-id="debdd-237">Add-EFProvider adds a new entity for the provider in the target project’s configuration file and makes sure it is at the end of the list of registered providers.</span></span>
*   <span data-ttu-id="debdd-238">Přidat EFDefaultConnectionFactory přidá nebo aktualizuje defaultConnectionFactory registrace v konfiguračním souboru na cílový projekt.</span><span class="sxs-lookup"><span data-stu-id="debdd-238">Add-EFDefaultConnectionFactory either adds or updates the defaultConnectionFactory registration in the target project’s configuration file.</span></span>

<span data-ttu-id="debdd-239">Oba tyto příkazy se postará o přidání oddíl entityFramework do konfiguračního souboru a přidání kolekce poskytovatelů v případě potřeby.</span><span class="sxs-lookup"><span data-stu-id="debdd-239">Both these commands take care of adding an entityFramework section to the config file and adding a providers collection if necessary.</span></span>

<span data-ttu-id="debdd-240">Předpokládá se, že tyto příkazy volat z NuGet skript install.ps1.</span><span class="sxs-lookup"><span data-stu-id="debdd-240">It is intended that these commands be called from the install.ps1 NuGet script.</span></span> <span data-ttu-id="debdd-241">Například install.ps1 SQL Compact poskytovatele vypadá podobně jako tento:</span><span class="sxs-lookup"><span data-stu-id="debdd-241">For example, install.ps1 for the SQL Compact provider looks similar to this:</span></span>

``` powershell
param($installPath, $toolsPath, $package, $project)
Add-EFDefaultConnectionFactory $project 'System.Data.Entity.Infrastructure.SqlCeConnectionFactory, EntityFramework' -ConstructorArguments 'System.Data.SqlServerCe.4.0'
Add-EFProvider $project 'System.Data.SqlServerCe.4.0' 'System.Data.Entity.SqlServerCompact.SqlCeProviderServices, EntityFramework.SqlServerCompact'</pre>
```

<span data-ttu-id="debdd-242">Další informace o těchto příkazech získáte pomocí get-help v okně konzoly Správce balíčků.</span><span class="sxs-lookup"><span data-stu-id="debdd-242">More information about these commands can be obtained by using get-help in the Package Manager Console window.</span></span>

## <a name="wrapping-providers"></a><span data-ttu-id="debdd-243">Zabalení zprostředkovatelů</span><span class="sxs-lookup"><span data-stu-id="debdd-243">Wrapping providers</span></span>

<span data-ttu-id="debdd-244">Zabalení poskytovatele je poskytovatele EF a/nebo ADO.NET, která obaluje existujícího poskytovatele rozšíření s další funkce, jako je například profilace, nebo trasování funkce.</span><span class="sxs-lookup"><span data-stu-id="debdd-244">A wrapping provider is an EF and/or ADO.NET provider that wraps an existing provider to extend it with other functionality such as profiling or tracing capabilities.</span></span> <span data-ttu-id="debdd-245">Obtékání poskytovatelé mohou být registrovány běžným způsobem, ale často je vhodné nastavení poskytovatele obtékání za běhu zachycením řešení související poskytovatele služeb.</span><span class="sxs-lookup"><span data-stu-id="debdd-245">Wrapping providers can be registered in the normal way, but it is often more convenient to setup the wrapping provider at runtime by intercepting the resolution of provider-related services.</span></span> <span data-ttu-id="debdd-246">Statické události OnLockingConfiguration DbConfiguration třídy lze použít k tomu.</span><span class="sxs-lookup"><span data-stu-id="debdd-246">The static event OnLockingConfiguration on the DbConfiguration class can be used to do this.</span></span>

<span data-ttu-id="debdd-247">OnLockingConfiguration je volána po EF určil, kde budou všechny EF konfigurace domény aplikace získané, ale než se uzamkne pro použití.</span><span class="sxs-lookup"><span data-stu-id="debdd-247">OnLockingConfiguration is called after EF has determined where all EF configuration for the app domain will be obtained from but before it is locked for use.</span></span> <span data-ttu-id="debdd-248">Při spuštění aplikace (před použitím EF) by měla aplikace zaregistrovat obslužnou rutinu události pro tuto událost.</span><span class="sxs-lookup"><span data-stu-id="debdd-248">At app startup (before EF is used) the app should register an event handler for this event.</span></span> <span data-ttu-id="debdd-249">(Jsme zvažuje přidání podpory pro registraci této obslužné rutiny v konfiguračním souboru, ale ještě to není podporováno.) Proveďte volání ReplaceService pro každou službu, která musí být zabaleny by měla obslužná rutina události.</span><span class="sxs-lookup"><span data-stu-id="debdd-249">(We are considering adding support for registering this handler in the config file but this is not yet supported.) The event handler should then make a call to ReplaceService for every service that needs to be wrapped.</span></span>  

<span data-ttu-id="debdd-250">Například při zabalení IDbConnectionFactory a DbProviderService, by měly být zaregistrovány obslužnou rutinu podobný následujícímu:</span><span class="sxs-lookup"><span data-stu-id="debdd-250">For example, to wrap IDbConnectionFactory and DbProviderService, a handler something like this should be registered:</span></span>

``` csharp
DbConfiguration.OnLockingConfiguration +=
    (_, a) =>
    {
        a.ReplaceService<DbProviderServices>(
            (s, k) => new MyWrappedProviderServices(s));

        a.ReplaceService<IDbConnectionFactory>(
            (s, k) => new MyWrappedConnectionFactory(s));
    };
```

<span data-ttu-id="debdd-251">Služby, který byl vyřešen a teď by měl být uzavřen společně s klíčem, který se použil při překladu služby jsou předány do obslužné rutiny.</span><span class="sxs-lookup"><span data-stu-id="debdd-251">The service that has been resolved and should now be wrapped together with the key that was used to resolve the service are passed to the handler.</span></span> <span data-ttu-id="debdd-252">Obslužná rutina můžete zabalit tuto službu a nahraďte zabalené verze vrácený služby.</span><span class="sxs-lookup"><span data-stu-id="debdd-252">The handler can then wrap this service and replace the returned service with the wrapped version.</span></span>

## <a name="resolving-a-dbproviderfactory-with-ef"></a><span data-ttu-id="debdd-253">Řešení DbProviderFactory s EF</span><span class="sxs-lookup"><span data-stu-id="debdd-253">Resolving a DbProviderFactory with EF</span></span>

<span data-ttu-id="debdd-254">DbProviderFactory je jeden z typů základní zprostředkovatel vyžadované EF, jak je popsáno v _poskytovatele typů přehled_ výše uvedené části.</span><span class="sxs-lookup"><span data-stu-id="debdd-254">DbProviderFactory is one of the fundamental provider types needed by EF as described in the _Provider types overview_ section above.</span></span> <span data-ttu-id="debdd-255">Které jsou už bylo zmíněno, není typem EF a registrace není obvykle jako součást konfigurace EF, ale místo toho je normální registrace zprostředkovatele ADO.NET v souboru machine.config nebo v konfiguračním souboru aplikace.</span><span class="sxs-lookup"><span data-stu-id="debdd-255">As already mentioned, It is not an EF type and registration is usually not part of EF configuration, but is instead the normal ADO.NET provider registration in the machine.config file and/or application’s config file.</span></span>

<span data-ttu-id="debdd-256">Bez ohledu na toto EF dál používá svůj mechanismus rozlišení normální závislostí při hledání DbProviderFactory používat.</span><span class="sxs-lookup"><span data-stu-id="debdd-256">Despite this EF still uses its normal dependency resolution mechanism when looking for a DbProviderFactory to use.</span></span> <span data-ttu-id="debdd-257">Výchozí překladač používá normální registrace technologie ADO.NET v konfiguračních souborech a proto je obvykle transparentní.</span><span class="sxs-lookup"><span data-stu-id="debdd-257">The default resolver uses the normal ADO.NET registration in the config files and so this is usually transparent.</span></span> <span data-ttu-id="debdd-258">Z důvodu řešení normální závislostí se používá mechanismus, ale znamená, že IDbDependencyResolver lze vyřešit DbProviderFactory i v případě, že normální ADO.NET registraci nebylo provedeno.</span><span class="sxs-lookup"><span data-stu-id="debdd-258">But because of the normal dependency resolution mechanism is used it means that an IDbDependencyResolver can be used to resolve a DbProviderFactory even when normal ADO.NET registration has not been done.</span></span>

<span data-ttu-id="debdd-259">Tímto způsobem řešení DbProviderFactory má vliv na několik:</span><span class="sxs-lookup"><span data-stu-id="debdd-259">Resolving DbProviderFactory in this way has several implications:</span></span>

*   <span data-ttu-id="debdd-260">Aplikace pomocí konfigurace založená na kódu můžete přidat volání ve své třídě DbConfiguration k registraci DbProviderFactory odpovídající.</span><span class="sxs-lookup"><span data-stu-id="debdd-260">An application using code-based configuration can add calls in their DbConfiguration class to register the appropriate DbProviderFactory.</span></span> <span data-ttu-id="debdd-261">To je užitečné pro aplikace, které nechcete povolit (nebo nemůže) ujistěte se, použít všechny konfigurace souborové vůbec.</span><span class="sxs-lookup"><span data-stu-id="debdd-261">This is especially useful for applications that do not want to (or cannot) make use of any file-based configuration at all.</span></span>
*   <span data-ttu-id="debdd-262">Službě mohou být zabaleny nebo nahradit pomocí ReplaceService, jak je popsáno v _obtékání poskytovatelé_ výše uvedené části</span><span class="sxs-lookup"><span data-stu-id="debdd-262">The service can be wrapped or replaced using ReplaceService as described in the _Wrapping providers_ section above</span></span>
*   <span data-ttu-id="debdd-263">Implementace DbProviderServices teoreticky by se dala přeložit DbProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="debdd-263">Theoretically, a DbProviderServices implementation could resolve a DbProviderFactory.</span></span>

<span data-ttu-id="debdd-264">Důležité si uvědomit o tom, jak žádnou z těchto akcí je, že se ovlivní pouze vyhledávání DbProviderFactory pomocí EF.</span><span class="sxs-lookup"><span data-stu-id="debdd-264">The important point to note about doing any of these things is that they will only affect the lookup of DbProviderFactory by EF.</span></span> <span data-ttu-id="debdd-265">Jiný kód bez EF stále očekávaným poskytovatele ADO.NET k registraci běžným způsobem a může selhat, pokud registrace nebyla nalezena.</span><span class="sxs-lookup"><span data-stu-id="debdd-265">Other non-EF code may still expect the ADO.NET provider to be registered in the normal way and may fail if the registration is not found.</span></span> <span data-ttu-id="debdd-266">Z tohoto důvodu je obvykle vhodnější k běžným způsobem ADO.NET registraci DbProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="debdd-266">For this reason it is normally better for a DbProviderFactory to be registered in the normal ADO.NET way.</span></span>

### <a name="related-services"></a><span data-ttu-id="debdd-267">Související služby</span><span class="sxs-lookup"><span data-stu-id="debdd-267">Related services</span></span>

<span data-ttu-id="debdd-268">Pokud EF se používá k překladu DbProviderFactory, pak by se měl také vyřešit IProviderInvariantName a IDbProviderFactoryResolver služby.</span><span class="sxs-lookup"><span data-stu-id="debdd-268">If EF is used to resolve a DbProviderFactory, then it should also resolve the IProviderInvariantName and IDbProviderFactoryResolver services.</span></span>

<span data-ttu-id="debdd-269">IProviderInvariantName je služba, která se používá k určení výchozí název zprostředkovatele pro daný typ DbProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="debdd-269">IProviderInvariantName is a service that is used to determine a provider invariant name for a given type of DbProviderFactory.</span></span> <span data-ttu-id="debdd-270">Výchozí implementace této služby používá registrace zprostředkovatele ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="debdd-270">The default implementation of this service uses the ADO.NET provider registration.</span></span> <span data-ttu-id="debdd-271">To znamená, že pokud zprostředkovatele ADO.NET není zaregistrován běžným způsobem, protože probíhá DbProviderFactory řešení pomocí EF, pak bude také potřeba vyřešit tuto službu.</span><span class="sxs-lookup"><span data-stu-id="debdd-271">This means that if the ADO.NET provider is not registered in the normal way because DbProviderFactory is being resolved by EF, then it will also be necessary to resolve this service.</span></span> <span data-ttu-id="debdd-272">Všimněte si, že se při použití metody DbConfiguration.SetProviderFactory překladač pro tuto službu automaticky přidá.</span><span class="sxs-lookup"><span data-stu-id="debdd-272">Note that a resolver for this service is automatically added when using the DbConfiguration.SetProviderFactory method.</span></span>

<span data-ttu-id="debdd-273">Jak je popsáno v _poskytovatele typů přehled_ výše uvedené části, IDbProviderFactoryResolver slouží k získání správné DbProviderFactory z daný objekt DbConnection.</span><span class="sxs-lookup"><span data-stu-id="debdd-273">As described in the _Provider types overview_ section above, the IDbProviderFactoryResolver is used to obtain the correct DbProviderFactory from a given DbConnection object.</span></span> <span data-ttu-id="debdd-274">Výchozí implementace této služby při spuštění v rozhraní .NET 4 používá registrace zprostředkovatele ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="debdd-274">The default implementation of this service when running on .NET 4 uses the ADO.NET provider registration.</span></span> <span data-ttu-id="debdd-275">To znamená, že pokud zprostředkovatele ADO.NET není zaregistrován běžným způsobem, protože probíhá DbProviderFactory řešení pomocí EF, pak bude také potřeba vyřešit tuto službu.</span><span class="sxs-lookup"><span data-stu-id="debdd-275">This means that if the ADO.NET provider is not registered in the normal way because DbProviderFactory is being resolved by EF, then it will also be necessary to resolve this service.</span></span>
