---
title: Samosledovací entity - EF6
author: divega
ms.date: 10/23/2016
ms.assetid: 5e60f5be-7bbb-4bf8-835e-0ac808d6c84a
ms.openlocfilehash: 3bb9759d89fbd0c10b911625aa7d0afd7747de14
ms.sourcegitcommit: 9b562663679854c37c05fca13d93e180213fb4aa
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/07/2020
ms.locfileid: "78419523"
---
# <a name="self-tracking-entities"></a><span data-ttu-id="9f45f-102">Samosledovací entity</span><span class="sxs-lookup"><span data-stu-id="9f45f-102">Self-tracking entities</span></span>

> [!IMPORTANT]
> <span data-ttu-id="9f45f-103">Už nedoporučujeme používat šablonu self-tracking-entities.</span><span class="sxs-lookup"><span data-stu-id="9f45f-103">We no longer recommend using the self-tracking-entities template.</span></span> <span data-ttu-id="9f45f-104">Bude i nadále k dispozici pouze pro podporu stávajících aplikací.</span><span class="sxs-lookup"><span data-stu-id="9f45f-104">It will only continue to be available to support existing applications.</span></span> <span data-ttu-id="9f45f-105">Pokud vaše aplikace vyžaduje práci s odpojenými grafy entit, zvažte jiné alternativy, jako jsou [sledovatelné entity](https://trackableentities.github.io/), což je technologie podobná samoobslužným sledovacím entitám, která je aktivněji vyvinuta komunitou, nebo psaní vlastního kódu pomocí nízkoúrovňových nastavení api pro sledování změn.</span><span class="sxs-lookup"><span data-stu-id="9f45f-105">If your application requires working with disconnected graphs of entities, consider other alternatives such as [Trackable Entities](https://trackableentities.github.io/), which is a technology similar to Self-Tracking-Entities that is more actively developed by the community, or writing custom code using the low-level change tracking APIs.</span></span>

<span data-ttu-id="9f45f-106">V aplikaci založené na rozhraní entity kontext je zodpovědný za sledování změn v objektech.</span><span class="sxs-lookup"><span data-stu-id="9f45f-106">In an Entity Framework-based application, a context is responsible for tracking changes in your objects.</span></span> <span data-ttu-id="9f45f-107">Potom použít SaveChanges metoda zachovat změny v databázi.</span><span class="sxs-lookup"><span data-stu-id="9f45f-107">You then use the SaveChanges method to persist the changes to the database.</span></span> <span data-ttu-id="9f45f-108">Při práci s n-vrstvé aplikace, entity objekty jsou obvykle odpojeny od kontextu a musíte se rozhodnout, jak sledovat změny a sestavy těchto změn zpět do kontextu.</span><span class="sxs-lookup"><span data-stu-id="9f45f-108">When working with N-Tier applications, the entity objects are usually disconnected from the context and you must decide how to track changes and report those changes back to the context.</span></span> <span data-ttu-id="9f45f-109">Samoobslužné sledovací entity vám mohou pomoci sledovat změny v libovolné vrstvě a pak tyto změny přehrát do kontextu, který se má uložit.</span><span class="sxs-lookup"><span data-stu-id="9f45f-109">Self-Tracking Entities (STEs) can help you track changes in any tier and then replay these changes into a context to be saved.</span></span>  

<span data-ttu-id="9f45f-110">MTE pouze v případě, že kontext není k dispozici na vrstvě, kde jsou provedeny změny grafu objektu.</span><span class="sxs-lookup"><span data-stu-id="9f45f-110">Use STEs only if the context is not available on a tier where the changes to the object graph are made.</span></span> <span data-ttu-id="9f45f-111">Pokud je k dispozici kontext, není nutné používat stinné služby, protože kontext se postará o sledování změn.</span><span class="sxs-lookup"><span data-stu-id="9f45f-111">If the context is available, there is no need to use STEs because the context will take care of tracking changes.</span></span>  

<span data-ttu-id="9f45f-112">Tato položka šablony generuje dva soubory TT (textová šablona):</span><span class="sxs-lookup"><span data-stu-id="9f45f-112">This template item generates two .tt (text template) files:</span></span>  

- <span data-ttu-id="9f45f-113">Soubor \*\* \<tt\>modelu\*\* generuje typy entit a pomocnou třídu, která obsahuje logiku sledování změn, která se používá entity samočinného sledování a metody rozšíření, které umožňují nastavení stavu na entitách samočinného sledování.</span><span class="sxs-lookup"><span data-stu-id="9f45f-113">The **\<model name\>.tt** file generates the entity types and a helper class that contains the change-tracking logic that is used by self-tracking entities and the extension methods that allow setting state on self-tracking entities.</span></span>  
- <span data-ttu-id="9f45f-114">\*\* \<Název\>modelu . Context.tt\*\* soubor generuje odvozený kontext a třídu rozšíření, která obsahuje metody **ApplyChanges** pro třídy **ObjectContext** a **ObjectSet.**</span><span class="sxs-lookup"><span data-stu-id="9f45f-114">The **\<model name\>.Context.tt** file generates a derived context and an extension class that contains **ApplyChanges** methods for the **ObjectContext** and **ObjectSet** classes.</span></span> <span data-ttu-id="9f45f-115">Tyto metody prozkoumat informace o sledování změn, která je obsažena v grafu samosledování entit odvodit sadu operací, které musí být provedeny uložit změny v databázi.</span><span class="sxs-lookup"><span data-stu-id="9f45f-115">These methods examine the change-tracking information that is contained in the graph of self-tracking entities to infer the set of operations that must be performed to save the changes in the database.</span></span>  

## <a name="get-started"></a><span data-ttu-id="9f45f-116">Začínáme</span><span class="sxs-lookup"><span data-stu-id="9f45f-116">Get Started</span></span>  

<span data-ttu-id="9f45f-117">Chcete-li začít, navštivte [stránku samosledování entit návod.](walkthrough.md)</span><span class="sxs-lookup"><span data-stu-id="9f45f-117">To get started, visit the [Self-Tracking Entities Walkthrough](walkthrough.md) page.</span></span>  

## <a name="functional-considerations-when-working-with-self-tracking-entities"></a><span data-ttu-id="9f45f-118">Funkční aspekty při práci s entitami samočinného sledování</span><span class="sxs-lookup"><span data-stu-id="9f45f-118">Functional Considerations When Working with Self-Tracking Entities</span></span>  
> [!IMPORTANT]
> <span data-ttu-id="9f45f-119">Už nedoporučujeme používat šablonu self-tracking-entities.</span><span class="sxs-lookup"><span data-stu-id="9f45f-119">We no longer recommend using the self-tracking-entities template.</span></span> <span data-ttu-id="9f45f-120">Bude i nadále k dispozici pouze pro podporu stávajících aplikací.</span><span class="sxs-lookup"><span data-stu-id="9f45f-120">It will only continue to be available to support existing applications.</span></span> <span data-ttu-id="9f45f-121">Pokud vaše aplikace vyžaduje práci s odpojenými grafy entit, zvažte jiné alternativy, jako jsou [sledovatelné entity](https://trackableentities.github.io/), což je technologie podobná samoobslužným sledovacím entitám, která je aktivněji vyvinuta komunitou, nebo psaní vlastního kódu pomocí nízkoúrovňových nastavení api pro sledování změn.</span><span class="sxs-lookup"><span data-stu-id="9f45f-121">If your application requires working with disconnected graphs of entities, consider other alternatives such as [Trackable Entities](https://trackableentities.github.io/), which is a technology similar to Self-Tracking-Entities that is more actively developed by the community, or writing custom code using the low-level change tracking APIs.</span></span>

<span data-ttu-id="9f45f-122">Při práci s entitami samočinného sledování zvažte následující:</span><span class="sxs-lookup"><span data-stu-id="9f45f-122">Consider the following when working with self-tracking entities:</span></span>  

- <span data-ttu-id="9f45f-123">Ujistěte se, že váš klientský projekt obsahuje odkaz na sestavení obsahující typy entit.</span><span class="sxs-lookup"><span data-stu-id="9f45f-123">Make sure that your client project has a reference to the assembly containing the entity types.</span></span> <span data-ttu-id="9f45f-124">Pokud přidáte pouze odkaz na službu do klientského projektu, klientský projekt bude používat typy proxy WCF a nikoli skutečné typy vlastních sledovacích entit.</span><span class="sxs-lookup"><span data-stu-id="9f45f-124">If you add only the service reference to the client project, the client project will use the WCF proxy types and not the actual self-tracking entity types.</span></span> <span data-ttu-id="9f45f-125">To znamená, že nezískáte funkce automatického oznámení, které spravují sledování entit v klientovi.</span><span class="sxs-lookup"><span data-stu-id="9f45f-125">This means that you will not get the automated notification features that manage the tracking of the entities on the client.</span></span> <span data-ttu-id="9f45f-126">Pokud záměrně nechcete zahrnout typy entit, budete muset ručně nastavit informace o sledování změn na straně klienta pro změny, které mají být odeslány zpět do služby.</span><span class="sxs-lookup"><span data-stu-id="9f45f-126">If you intentionally do not want to include the entity types, you will have to manually set change-tracking information on the client for the changes to be sent back to the service.</span></span>  
- <span data-ttu-id="9f45f-127">Volání operace služby by měla být bezstavová a vytvořit novou instanci kontextu objektu.</span><span class="sxs-lookup"><span data-stu-id="9f45f-127">Calls to the service operation should be stateless and create a new instance of object context.</span></span> <span data-ttu-id="9f45f-128">Doporučujeme také vytvořit kontext objektu v **using** bloku.</span><span class="sxs-lookup"><span data-stu-id="9f45f-128">We also recommend that you create object context in a **using** block.</span></span>  
- <span data-ttu-id="9f45f-129">Při odeslání grafu, který byl změněn na straně klienta do služby a pak chcete pokračovat v práci se stejným grafem na straně klienta, je nutné ručně iteraci prostřednictvím grafu a volání **AcceptChanges** metoda na každý objekt obnovit změnu tracker.</span><span class="sxs-lookup"><span data-stu-id="9f45f-129">When you send the graph that was modified on the client to the service and then intend to continue working with the same graph on the client, you have to manually iterate through the graph and call the **AcceptChanges** method on each object to reset the change tracker.</span></span>  

    > <span data-ttu-id="9f45f-130">Pokud objekty v grafu obsahují vlastnosti s hodnotami generovanými databázemi (například hodnoty identity nebo souběžnosti), entity Framework nahradí hodnoty těchto vlastností hodnotami generovanými databázemi po volání metody **SaveChanges.**</span><span class="sxs-lookup"><span data-stu-id="9f45f-130">If objects in your graph contain properties with database-generated values (for example, identity or concurrency values), Entity Framework will replace values of these properties with the database-generated values after the **SaveChanges** method is called.</span></span> <span data-ttu-id="9f45f-131">Můžete implementovat operaci služby vrátit uložené objekty nebo seznam generovaných hodnot vlastností pro objekty zpět klientovi.</span><span class="sxs-lookup"><span data-stu-id="9f45f-131">You can implement your service operation to return saved objects or a list of generated property values for the objects back to the client.</span></span> <span data-ttu-id="9f45f-132">Klient by pak musel nahradit instance objektu nebo hodnoty vlastností objektu hodnotami nebo hodnotami vlastností vrácenými z operace služby.</span><span class="sxs-lookup"><span data-stu-id="9f45f-132">The client would then need to replace the object instances or object property values with the objects or property values returned from the service operation.</span></span>  
- <span data-ttu-id="9f45f-133">Sloučení grafů z více požadavků na služby může zavést objekty s duplicitními hodnotami klíče ve výsledném grafu.</span><span class="sxs-lookup"><span data-stu-id="9f45f-133">Merging graphs from multiple service requests may introduce objects with duplicate key values in the resulting graph.</span></span> <span data-ttu-id="9f45f-134">Entity Framework neodebere objekty s duplicitními klíči při volání **ApplyChanges** metoda, ale místo toho vyvolá výjimku.</span><span class="sxs-lookup"><span data-stu-id="9f45f-134">Entity Framework does not remove the objects with duplicate keys when you call the **ApplyChanges** method but instead throws an exception.</span></span> <span data-ttu-id="9f45f-135">Chcete-li se vyhnout grafy s duplicitní hodnoty klíče postupujte podle jednoho ze vzorků popsaných v následujícím blogu: [Self-tracking entity: ApplyChanges a duplicitní entity](https://go.microsoft.com/fwlink/?LinkID=205119&clcid=0x409).</span><span class="sxs-lookup"><span data-stu-id="9f45f-135">To avoid having graphs with duplicate key values follow one of the patterns described in the following blog: [Self-Tracking Entities: ApplyChanges and duplicate entities](https://go.microsoft.com/fwlink/?LinkID=205119&clcid=0x409).</span></span>  
- <span data-ttu-id="9f45f-136">Změníte-li vztah mezi objekty nastavením vlastnosti cizího klíče, je vlastnost reference navigace nastavena na hodnotu null a není synchronizována s příslušnou hlavní entitou v klientovi.</span><span class="sxs-lookup"><span data-stu-id="9f45f-136">When you change the relationship between objects by setting the foreign key property, the reference navigation property is set to null and not synchronized to the appropriate principal entity on the client.</span></span> <span data-ttu-id="9f45f-137">Po grafu je připojen k kontextu objektu (například po volání **ApplyChanges** metoda), vlastnosti cizího klíče a navigační vlastnosti jsou synchronizovány.</span><span class="sxs-lookup"><span data-stu-id="9f45f-137">After the graph is attached to the object context (for example, after you call the **ApplyChanges** method), the foreign key properties and navigation properties are synchronized.</span></span>  

    > <span data-ttu-id="9f45f-138">Není-li referenční navigační vlastnost synchronizována s příslušným objektem zabezpečení může být problém, pokud jste zadali kaskádové odstranění ve vztahu cizího klíče.</span><span class="sxs-lookup"><span data-stu-id="9f45f-138">Not having a reference navigation property synchronized with the appropriate principal object could be an issue if you have specified cascade delete on the foreign key relationship.</span></span> <span data-ttu-id="9f45f-139">Pokud odstraníte objekt zabezpečení, odstranění nebude rozšířeno na závislé objekty.</span><span class="sxs-lookup"><span data-stu-id="9f45f-139">If you delete the principal, the delete will not be propagated to the dependent objects.</span></span> <span data-ttu-id="9f45f-140">Pokud máte kaskádové odstranění zadané, použijte navigační vlastnosti změnit vztahy namísto nastavení vlastnosti cizího klíče.</span><span class="sxs-lookup"><span data-stu-id="9f45f-140">If you have cascade deletes specified, use navigation properties to change relationships instead of setting the foreign key property.</span></span>  
- <span data-ttu-id="9f45f-141">Samoobslužné sledování entity nejsou povoleny k provádění opožděné načítání.</span><span class="sxs-lookup"><span data-stu-id="9f45f-141">Self-tracking entities are not enabled to perform lazy loading.</span></span>  
- <span data-ttu-id="9f45f-142">Binární serializace a serializace ASP.NET objekty správy stavu není podporována entity samočinného sledování.</span><span class="sxs-lookup"><span data-stu-id="9f45f-142">Binary serialization and serialization to ASP.NET state management objects is not supported by self-tracking entities.</span></span> <span data-ttu-id="9f45f-143">Šablonu však můžete přizpůsobit tak, aby byla podpora binární serializace.</span><span class="sxs-lookup"><span data-stu-id="9f45f-143">However, you can customize the template to add the binary serialization support.</span></span> <span data-ttu-id="9f45f-144">Další informace naleznete [v tématu Použití binární serializace a ViewState s entity samočinného sledování](https://go.microsoft.com/fwlink/?LinkId=199208).</span><span class="sxs-lookup"><span data-stu-id="9f45f-144">For more information, see [Using Binary Serialization and ViewState with Self-Tracking Entities](https://go.microsoft.com/fwlink/?LinkId=199208).</span></span>  

## <a name="security-considerations"></a><span data-ttu-id="9f45f-145">Aspekty zabezpečení</span><span class="sxs-lookup"><span data-stu-id="9f45f-145">Security Considerations</span></span>  

<span data-ttu-id="9f45f-146">Při práci s entitami samosledování je třeba vzít v úvahu následující aspekty zabezpečení:</span><span class="sxs-lookup"><span data-stu-id="9f45f-146">The following security considerations should be taken into account when working with self-tracking entities:</span></span>  

- <span data-ttu-id="9f45f-147">Služba by neměla důvěřovat požadavkům na načtení nebo aktualizaci dat z nedůvěryhodného klienta nebo prostřednictvím nedůvěryhodného kanálu.</span><span class="sxs-lookup"><span data-stu-id="9f45f-147">A service should not trust requests to retrieve or update data from a non-trusted client or through a non-trusted channel.</span></span> <span data-ttu-id="9f45f-148">Klient musí být ověřen: měl by být použit zabezpečený kanál nebo obálka se zprávou.</span><span class="sxs-lookup"><span data-stu-id="9f45f-148">A client must be authenticated: a secure channel or message envelope should be used.</span></span> <span data-ttu-id="9f45f-149">Požadavky klientů na aktualizaci nebo načtení dat musí být ověřeny, aby bylo zajištěno, že odpovídají očekávaným a legitimním změnám pro daný scénář.</span><span class="sxs-lookup"><span data-stu-id="9f45f-149">Clients' requests to update or retrieve data must be validated to ensure they conform to expected and legitimate changes for the given scenario.</span></span>  
- <span data-ttu-id="9f45f-150">Nepoužívejte citlivé informace jako klíče entit (například čísla sociálního pojištění).</span><span class="sxs-lookup"><span data-stu-id="9f45f-150">Avoid using sensitive information as entity keys (for example, social security numbers).</span></span> <span data-ttu-id="9f45f-151">To zmírňuje možnost neúmyslnéserializace citlivých informací v grafech entity samočinného sledování klientovi, který není plně důvěryhodný.</span><span class="sxs-lookup"><span data-stu-id="9f45f-151">This mitigates the possibility of inadvertently serializing sensitive information in the self-tracking entity graphs to a client that is not fully trusted.</span></span> <span data-ttu-id="9f45f-152">S nezávislými přidruženími může být klientovi odeslán také původní klíč entity, který souvisí s entitou, která je serializována.</span><span class="sxs-lookup"><span data-stu-id="9f45f-152">With independent associations, the original key of an entity that is related to the one that is being serialized might be sent to the client as well.</span></span>  
- <span data-ttu-id="9f45f-153">Chcete-li se vyhnout šíření zpráv výjimek, které obsahují citlivá data na úroveň klienta, volání **ApplyChanges** a **SaveChanges** na úrovni serveru by měla být zabalena v kódu zpracování výjimek.</span><span class="sxs-lookup"><span data-stu-id="9f45f-153">To avoid propagating exception messages that contain sensitive data to the client tier, calls to **ApplyChanges** and **SaveChanges** on the server tier should be wrapped in exception-handling code.</span></span>  
