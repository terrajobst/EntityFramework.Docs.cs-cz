---
title: Sledování vs. Dotazy bez sledování – základní ef
author: smitpatel
ms.date: 10/10/2019
ms.assetid: e17e060c-929f-4180-8883-40c438fbcc01
uid: core/querying/tracking
ms.openlocfilehash: a6c71c12f429f1324abe91d1b2cef96312bec051
ms.sourcegitcommit: 9b562663679854c37c05fca13d93e180213fb4aa
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/07/2020
ms.locfileid: "78417647"
---
# <a name="tracking-vs-no-tracking-queries"></a><span data-ttu-id="08f47-102">Sledování vs. dotazy bez sledování</span><span class="sxs-lookup"><span data-stu-id="08f47-102">Tracking vs. No-Tracking Queries</span></span>

<span data-ttu-id="08f47-103">Sledování chování řídí, pokud core entity framework uchová informace o instanci entity v jeho sledování změn.</span><span class="sxs-lookup"><span data-stu-id="08f47-103">Tracking behavior controls if Entity Framework Core will keep information about an entity instance in its change tracker.</span></span> <span data-ttu-id="08f47-104">Pokud je entita sledována, budou všechny změny zjištěné `SaveChanges()`v entitě v databázi zachovány během .</span><span class="sxs-lookup"><span data-stu-id="08f47-104">If an entity is tracked, any changes detected in the entity will be persisted to the database during `SaveChanges()`.</span></span> <span data-ttu-id="08f47-105">EF Core také opraví navigační vlastnosti mezi entitami ve výsledku sledování dotazu a entitami, které jsou v sledování změn.</span><span class="sxs-lookup"><span data-stu-id="08f47-105">EF Core will also fix up navigation properties between the entities in a tracking query result and the entities that are in the change tracker.</span></span>

> [!NOTE]
> <span data-ttu-id="08f47-106">[Bezklíčové typy entit](xref:core/modeling/keyless-entity-types) nejsou nikdy sledovány.</span><span class="sxs-lookup"><span data-stu-id="08f47-106">[Keyless entity types](xref:core/modeling/keyless-entity-types) are never tracked.</span></span> <span data-ttu-id="08f47-107">Všude tam, kde tento článek zmiňuje typy entit, odkazuje na typy entit, které mají definovaný klíč.</span><span class="sxs-lookup"><span data-stu-id="08f47-107">Wherever this article mentions entity types, it refers to entity types which have a key defined.</span></span>

> [!TIP]  
> <span data-ttu-id="08f47-108">Ukázku tohoto článku [sample](https://github.com/dotnet/EntityFramework.Docs/tree/master/samples/core/Querying) můžete zobrazit na GitHubu.</span><span class="sxs-lookup"><span data-stu-id="08f47-108">You can view this article's [sample](https://github.com/dotnet/EntityFramework.Docs/tree/master/samples/core/Querying) on GitHub.</span></span>

## <a name="tracking-queries"></a><span data-ttu-id="08f47-109">Sledování dotazů</span><span class="sxs-lookup"><span data-stu-id="08f47-109">Tracking queries</span></span>

<span data-ttu-id="08f47-110">Ve výchozím nastavení jsou dotazy, které vracejí typy entit, sledování.</span><span class="sxs-lookup"><span data-stu-id="08f47-110">By default, queries that return entity types are tracking.</span></span> <span data-ttu-id="08f47-111">To znamená, že můžete provádět změny v těchto instancích entit a tyto změny zachovat . `SaveChanges()`</span><span class="sxs-lookup"><span data-stu-id="08f47-111">Which means you can make changes to those entity instances and have those changes persisted by `SaveChanges()`.</span></span> <span data-ttu-id="08f47-112">V následujícím příkladu bude zjištěna změna hodnocení blogů a bude `SaveChanges()`zachována v databázi během .</span><span class="sxs-lookup"><span data-stu-id="08f47-112">In the following example, the change to the blogs rating will be detected and persisted to the database during `SaveChanges()`.</span></span>

[!code-csharp[Main](../../../samples/core/Querying/Tracking/Sample.cs#Tracking)]

## <a name="no-tracking-queries"></a><span data-ttu-id="08f47-113">Dotazy bez sledování</span><span class="sxs-lookup"><span data-stu-id="08f47-113">No-tracking queries</span></span>

<span data-ttu-id="08f47-114">Žádné sledování dotazy jsou užitečné při výsledky se používají ve scénáři jen pro čtení.</span><span class="sxs-lookup"><span data-stu-id="08f47-114">No tracking queries are useful when the results are used in a read-only scenario.</span></span> <span data-ttu-id="08f47-115">Jejich spuštění je rychlejší, protože není nutné nastavovat informace o sledování změn.</span><span class="sxs-lookup"><span data-stu-id="08f47-115">They're quicker to execute because there's no need to set up the change tracking information.</span></span> <span data-ttu-id="08f47-116">Pokud nepotřebujete aktualizovat entity načtené z databáze, měl by být použit dotaz bez sledování.</span><span class="sxs-lookup"><span data-stu-id="08f47-116">If you don't need to update the entities retrieved from the database, then a no-tracking query should be used.</span></span> <span data-ttu-id="08f47-117">Můžete vyměnit jednotlivé dotazy, které mají být bez sledování.</span><span class="sxs-lookup"><span data-stu-id="08f47-117">You can swap an individual query to be no-tracking.</span></span>

[!code-csharp[Main](../../../samples/core/Querying/Tracking/Sample.cs#NoTracking)]

<span data-ttu-id="08f47-118">Můžete také změnit výchozí chování sledování na úrovni instance kontextu:</span><span class="sxs-lookup"><span data-stu-id="08f47-118">You can also change the default tracking behavior at the context instance level:</span></span>

[!code-csharp[Main](../../../samples/core/Querying/Tracking/Sample.cs#ContextDefaultTrackingBehavior)]

## <a name="identity-resolution"></a><span data-ttu-id="08f47-119">Rozlišení identity</span><span class="sxs-lookup"><span data-stu-id="08f47-119">Identity resolution</span></span>

<span data-ttu-id="08f47-120">Vzhledem k tomu, že sledovací dotaz používá sledování změn, EF Core provede rozlišení identity v dotazu sledování.</span><span class="sxs-lookup"><span data-stu-id="08f47-120">Since a tracking query uses the change tracker, EF Core will do identity resolution in a tracking query.</span></span> <span data-ttu-id="08f47-121">Při materializaci entity EF Core vrátí stejnou instanci entity z nástroje pro sledování změn, pokud je již sledována.</span><span class="sxs-lookup"><span data-stu-id="08f47-121">When materializing an entity, EF Core will return the same entity instance from the change tracker if it's already being tracked.</span></span> <span data-ttu-id="08f47-122">Pokud výsledek obsahuje stejnou entitu vícekrát, získáte zpět stejnou instanci pro každý výskyt.</span><span class="sxs-lookup"><span data-stu-id="08f47-122">If the result contains same entity multiple times, you get back same instance for each occurrence.</span></span> <span data-ttu-id="08f47-123">Žádné sledování dotazů nepoužívá sledování změn a nedělají rozlišení identity.</span><span class="sxs-lookup"><span data-stu-id="08f47-123">No-tracking queries don't use the change tracker and don't do identity resolution.</span></span> <span data-ttu-id="08f47-124">Takže získáte zpět novou instanci entity i v případě, že je stejná entita obsažena ve výsledku vícekrát.</span><span class="sxs-lookup"><span data-stu-id="08f47-124">So you get back new instance of entity even when the same entity is contained in the result multiple times.</span></span> <span data-ttu-id="08f47-125">Toto chování se lišilo ve verzích před EF Core 3.0, viz [předchozí verze](#previous-versions).</span><span class="sxs-lookup"><span data-stu-id="08f47-125">This behavior was different in versions before EF Core 3.0, see [previous versions](#previous-versions).</span></span>

## <a name="tracking-and-custom-projections"></a><span data-ttu-id="08f47-126">Sledování a vlastní projekce</span><span class="sxs-lookup"><span data-stu-id="08f47-126">Tracking and custom projections</span></span>

<span data-ttu-id="08f47-127">I v případě, že typ výsledku dotazu není typ entity, EF Core bude stále sledovat typy entit obsažené ve výsledku ve výchozím nastavení.</span><span class="sxs-lookup"><span data-stu-id="08f47-127">Even if the result type of the query isn't an entity type, EF Core will still track entity types contained in the result by default.</span></span> <span data-ttu-id="08f47-128">V následujícím dotazu, který vrací anonymní typ, budou sledovány instance `Blog` v sadě výsledků.</span><span class="sxs-lookup"><span data-stu-id="08f47-128">In the following query, which returns an anonymous type, the instances of `Blog` in the result set will be tracked.</span></span>

[!code-csharp[Main](../../../samples/core/Querying/Tracking/Sample.cs#CustomProjection1)]

<span data-ttu-id="08f47-129">Pokud sada výsledků obsahuje typy entit vycházející z kompozice LINQ, EF Core je bude sledovat.</span><span class="sxs-lookup"><span data-stu-id="08f47-129">If the result set contains entity types coming out from LINQ composition, EF Core will track them.</span></span>

[!code-csharp[Main](../../../samples/core/Querying/Tracking/Sample.cs#CustomProjection2)]

<span data-ttu-id="08f47-130">Pokud sada výsledků neobsahuje žádné typy entit, neprovádí se žádné sledování.</span><span class="sxs-lookup"><span data-stu-id="08f47-130">If the result set doesn't contain any entity types, then no tracking is done.</span></span> <span data-ttu-id="08f47-131">V následujícím dotazu vrátíme anonymní typ s některými hodnotami z entity (ale žádné instance skutečného typu entity).</span><span class="sxs-lookup"><span data-stu-id="08f47-131">In the following query, we return an anonymous type with some of the values from the entity (but no instances of the actual entity type).</span></span> <span data-ttu-id="08f47-132">Z dotazu nejsou žádné sledované entity.</span><span class="sxs-lookup"><span data-stu-id="08f47-132">There are no tracked entities coming out of the query.</span></span>

[!code-csharp[Main](../../../samples/core/Querying/Tracking/Sample.cs#CustomProjection3)]

 <span data-ttu-id="08f47-133">EF Core podporuje hodnocení klienta v projekci nejvyšší úrovně.</span><span class="sxs-lookup"><span data-stu-id="08f47-133">EF Core supports doing client evaluation in the top-level projection.</span></span> <span data-ttu-id="08f47-134">Pokud EF Core zhmotní instanci entity pro vyhodnocení klienta, bude sledována.</span><span class="sxs-lookup"><span data-stu-id="08f47-134">If EF Core materializes an entity instance for client evaluation, it will be tracked.</span></span> <span data-ttu-id="08f47-135">Tady, protože jsme `blog` předávání entit do `StandardizeURL`klientské metody , EF Core bude sledovat blog instance příliš.</span><span class="sxs-lookup"><span data-stu-id="08f47-135">Here, since we're passing `blog` entities to the client method `StandardizeURL`, EF Core will track the blog instances too.</span></span>

[!code-csharp[Main](../../../samples/core/Querying/Tracking/Sample.cs#ClientProjection)]

[!code-csharp[Main](../../../samples/core/Querying/Tracking/Sample.cs#ClientMethod)]

<span data-ttu-id="08f47-136">EF Core nesleduje bezklíčové instance entit obsažené ve výsledku.</span><span class="sxs-lookup"><span data-stu-id="08f47-136">EF Core doesn't track the keyless entity instances contained in the result.</span></span> <span data-ttu-id="08f47-137">Ale EF Core sleduje všechny ostatní instance typů entit s klíčem podle výše uvedených pravidel.</span><span class="sxs-lookup"><span data-stu-id="08f47-137">But EF Core tracks all the other instances of entity types with key according to rules above.</span></span>

<span data-ttu-id="08f47-138">Některá z výše uvedených pravidel fungovala před EF Core 3.0 odlišně.</span><span class="sxs-lookup"><span data-stu-id="08f47-138">Some of the above rules worked differently before EF Core 3.0.</span></span> <span data-ttu-id="08f47-139">Další informace naleznete v [předchozích verzích](#previous-versions).</span><span class="sxs-lookup"><span data-stu-id="08f47-139">For more information, see [previous versions](#previous-versions).</span></span>

## <a name="previous-versions"></a><span data-ttu-id="08f47-140">Předchozí verze</span><span class="sxs-lookup"><span data-stu-id="08f47-140">Previous versions</span></span>

<span data-ttu-id="08f47-141">Před verzí 3.0 ef core měl některé rozdíly v tom, jak bylo měření provedeno.</span><span class="sxs-lookup"><span data-stu-id="08f47-141">Before version 3.0, EF Core had some differences in how tracking was done.</span></span> <span data-ttu-id="08f47-142">Významné rozdíly jsou následující:</span><span class="sxs-lookup"><span data-stu-id="08f47-142">Notable differences are as follows:</span></span>

- <span data-ttu-id="08f47-143">Jak je vysvětleno na stránce [Vyhodnocení klienta vs serveru,](xref:core/querying/client-eval) EF Core podporoval ohodnocení klienta v libovolné části dotazu před verzí 3.0.</span><span class="sxs-lookup"><span data-stu-id="08f47-143">As explained in [Client vs Server Evaluation](xref:core/querying/client-eval) page, EF Core supported client evaluation in any part of the query before version 3.0.</span></span> <span data-ttu-id="08f47-144">Vyhodnocení klienta způsobilo zhmotnění entit, které nebyly součástí výsledku.</span><span class="sxs-lookup"><span data-stu-id="08f47-144">Client evaluation caused materialization of entities, which weren't part of the result.</span></span> <span data-ttu-id="08f47-145">Takže EF Core analyzoval výsledek, aby zjistil, co sledovat. Tento návrh měl určité rozdíly takto:</span><span class="sxs-lookup"><span data-stu-id="08f47-145">So EF Core analyzed the result to detect what to track. This design had certain differences as follows:</span></span>
  - <span data-ttu-id="08f47-146">Vyhodnocení klienta v projekci, které způsobilo materializaci, ale nevrátilo zhmotněnou entitu, nebylo sledováno.</span><span class="sxs-lookup"><span data-stu-id="08f47-146">Client evaluation in the projection, which caused materialization but didn't return the materialized entity instance wasn't tracked.</span></span> <span data-ttu-id="08f47-147">Následující příklad nesledoval `blog` entity.</span><span class="sxs-lookup"><span data-stu-id="08f47-147">The following example didn't track `blog` entities.</span></span>
    [!code-csharp[Main](../../../samples/core/Querying/Tracking/Sample.cs#ClientProjection)]

  - <span data-ttu-id="08f47-148">EF Core nesledoval objekty přicházející z linq složení v určitých případech.</span><span class="sxs-lookup"><span data-stu-id="08f47-148">EF Core didn't track the objects coming out of LINQ composition in certain cases.</span></span> <span data-ttu-id="08f47-149">Následující příklad nesledoval `Post`.</span><span class="sxs-lookup"><span data-stu-id="08f47-149">The following example didn't track `Post`.</span></span>
    [!code-csharp[Main](../../../samples/core/Querying/Tracking/Sample.cs#CustomProjection2)]

- <span data-ttu-id="08f47-150">Kdykoli výsledky dotazu obsahovaly typy bezklíčových entit, celý dotaz byl proveden bez sledování.</span><span class="sxs-lookup"><span data-stu-id="08f47-150">Whenever query results contained keyless entity types, the whole query was made non-tracking.</span></span> <span data-ttu-id="08f47-151">To znamená, že typy entit s klíči, které jsou výsledkem nebyly sledovány jeden.</span><span class="sxs-lookup"><span data-stu-id="08f47-151">That means that entity types with keys, which are in result weren't being tracked either.</span></span>
- <span data-ttu-id="08f47-152">EF Core provedl rozlišení identity v dotazu bez sledování.</span><span class="sxs-lookup"><span data-stu-id="08f47-152">EF Core did identity resolution in no-tracking query.</span></span> <span data-ttu-id="08f47-153">Používá slabé odkazy ke sledování entit, které již byly vráceny.</span><span class="sxs-lookup"><span data-stu-id="08f47-153">It used weak references to keep track of entities that had already been returned.</span></span> <span data-ttu-id="08f47-154">Takže pokud sada výsledků obsahovala násobek stejné entity, získali byste stejnou instanci pro každý výskyt.</span><span class="sxs-lookup"><span data-stu-id="08f47-154">So if a result set contained the same entity multiples times, you would get the same instance for each occurrence.</span></span> <span data-ttu-id="08f47-155">Ačkoli pokud předchozí výsledek se stejnou identitou přešel mimo rozsah a získal uvolňování paměti, EF Core vrátil novou instanci.</span><span class="sxs-lookup"><span data-stu-id="08f47-155">Though if a previous result with the same identity went out of scope and got garbage collected, EF Core returned a new instance.</span></span>
