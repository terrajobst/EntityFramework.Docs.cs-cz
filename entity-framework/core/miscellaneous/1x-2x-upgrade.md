---
title: Upgrade z předchozí verze na EF Core 2 - EF Core
author: divega
ms.date: 08/13/2017
ms.assetid: 8BD43C8C-63D9-4F3A-B954-7BC518A1B7DB
uid: core/miscellaneous/1x-2x-upgrade
ms.openlocfilehash: f0d85b3ba22c09d2bd48e8b34ed628a7474322d3
ms.sourcegitcommit: 2b787009fd5be5627f1189ee396e708cd130e07b
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 09/13/2018
ms.locfileid: "45490490"
---
# <a name="upgrading-applications-from-previous-versions-to-ef-core-20"></a><span data-ttu-id="e80d0-102">Upgrade aplikací z předchozí verze na EF Core 2.0</span><span class="sxs-lookup"><span data-stu-id="e80d0-102">Upgrading applications from previous versions to EF Core 2.0</span></span>

<span data-ttu-id="e80d0-103">Přesměrovali jsme možnost výrazně vylepšit naše stávající rozhraní API a chování ve verzi 2.0.</span><span class="sxs-lookup"><span data-stu-id="e80d0-103">We have taken the opportunity to significantly refine our existing APIs and behaviors in 2.0.</span></span> <span data-ttu-id="e80d0-104">Existuje několik vylepšení, které může vyžadovat úprava existující kód aplikace, i když se budeme domnívat, že pro většinu aplikací dopad bude nízká, ve většině případů vyžaduje právě rekompilace a minimální změny s průvodcem k nahrazení zastaralé rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="e80d0-104">There are a few improvements that can require modifying existing application code, although we believe that for the majority of applications the impact will be low, in most cases requiring just recompilation and minimal guided changes to replace obsolete APIs.</span></span>

## <a name="procedures-common-to-all-applications"></a><span data-ttu-id="e80d0-105">Běžné postupy pro všechny aplikace</span><span class="sxs-lookup"><span data-stu-id="e80d0-105">Procedures Common to All Applications</span></span>

<span data-ttu-id="e80d0-106">Aktualizuje existující aplikaci na EF Core 2.0 může vyžadovat:</span><span class="sxs-lookup"><span data-stu-id="e80d0-106">Updating an existing application to EF Core 2.0 may require:</span></span>

1. <span data-ttu-id="e80d0-107">Inovace platformy .NET aplikace, který podporuje .NET Standard 2.0.</span><span class="sxs-lookup"><span data-stu-id="e80d0-107">Upgrading the target .NET platform of the application to one that supports .NET Standard 2.0.</span></span> <span data-ttu-id="e80d0-108">Zobrazit [podporované platformy](../platforms/index.md) další podrobnosti.</span><span class="sxs-lookup"><span data-stu-id="e80d0-108">See [Supported Platforms](../platforms/index.md) for more details.</span></span>

2. <span data-ttu-id="e80d0-109">Identifikujte zprostředkovatele pro cílovou databázi, která je kompatibilní s EF Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="e80d0-109">Identify a provider for the target database which is compatible with EF Core 2.0.</span></span> <span data-ttu-id="e80d0-110">Zobrazit [EF Core 2.0 vyžaduje poskytovatele 2.0 databáze](#ef-core-20-requires-a-20-database-provider) níže.</span><span class="sxs-lookup"><span data-stu-id="e80d0-110">See [EF Core 2.0 requires a 2.0 database provider](#ef-core-20-requires-a-20-database-provider) below.</span></span>

3. <span data-ttu-id="e80d0-111">Upgrade všech balíčků EF Core (runtime a nástroje) 2.0.</span><span class="sxs-lookup"><span data-stu-id="e80d0-111">Upgrading all the EF Core packages (runtime and tooling) to 2.0.</span></span> <span data-ttu-id="e80d0-112">Odkazovat na [instalace EF Core](../get-started/install/index.md) další podrobnosti.</span><span class="sxs-lookup"><span data-stu-id="e80d0-112">Refer to [Installing EF Core](../get-started/install/index.md) for more details.</span></span>

4. <span data-ttu-id="e80d0-113">Proveďte změny nezbytného kódu jako kompenzaci za rozbíjející změny.</span><span class="sxs-lookup"><span data-stu-id="e80d0-113">Make any necessary code changes to compensate for breaking changes.</span></span> <span data-ttu-id="e80d0-114">Zobrazit [Breaking Changes](#breaking-changes) níže v části Další podrobnosti.</span><span class="sxs-lookup"><span data-stu-id="e80d0-114">See the [Breaking Changes](#breaking-changes) section below for more details.</span></span>

## <a name="aspnet-core-applications"></a><span data-ttu-id="e80d0-115">Aplikace ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="e80d0-115">ASP.NET Core applications</span></span>

1. <span data-ttu-id="e80d0-116">Viz zejména [nový vzor pro inicializaci aplikace poskytovatele služeb](#new-way-of-getting-application-services) je popsáno níže.</span><span class="sxs-lookup"><span data-stu-id="e80d0-116">See in particular the [new pattern for initializing the application's service provider](#new-way-of-getting-application-services) described below.</span></span>

> [!TIP]  
> <span data-ttu-id="e80d0-117">Přijetí tohoto nového modelu při aktualizaci aplikace na 2.0 se důrazně doporučuje a je nutná pro funkce produktu, jako je migrace Entity Framework Core pracovat.</span><span class="sxs-lookup"><span data-stu-id="e80d0-117">The adoption of this new pattern when updating applications to 2.0 is highly recommended and is required in order for product features like Entity Framework Core Migrations to work.</span></span> <span data-ttu-id="e80d0-118">Běžnou alternativou je [implementovat *IDesignTimeDbContextFactory\<TContext >*](xref:core/miscellaneous/cli/dbcontext-creation#from-a-design-time-factory).</span><span class="sxs-lookup"><span data-stu-id="e80d0-118">The other common alternative is to [implement *IDesignTimeDbContextFactory\<TContext>*](xref:core/miscellaneous/cli/dbcontext-creation#from-a-design-time-factory).</span></span>

2. <span data-ttu-id="e80d0-119">Aplikace pro ASP.NET Core 2.0, můžete použít EF Core 2.0 bez další závislosti kromě poskytovatelé databází výrobců.</span><span class="sxs-lookup"><span data-stu-id="e80d0-119">Applications targeting ASP.NET Core 2.0 can use EF Core 2.0 without additional dependencies besides third party database providers.</span></span> <span data-ttu-id="e80d0-120">Aplikace cílené na předchozích verzích technologie ASP.NET Core je však nutné upgradovat na ASP.NET Core 2.0, aby bylo možné používat EF Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="e80d0-120">However, applications targeting previous versions of ASP.NET Core need to upgrade to ASP.NET Core 2.0 in order to use EF Core 2.0.</span></span> <span data-ttu-id="e80d0-121">Další podrobnosti o upgradu aplikace ASP.NET Core 2.0 najdete v tématu [dokumentace k ASP.NET Core v předmětu](https://docs.microsoft.com/aspnet/core/migration/1x-to-2x/).</span><span class="sxs-lookup"><span data-stu-id="e80d0-121">For more details on upgrading ASP.NET Core applications to 2.0 see [the ASP.NET Core documentation on the subject](https://docs.microsoft.com/aspnet/core/migration/1x-to-2x/).</span></span>

## <a name="new-way-of-getting-application-services"></a><span data-ttu-id="e80d0-122">Nový způsob získávání aplikační služby</span><span class="sxs-lookup"><span data-stu-id="e80d0-122">New way of getting application services</span></span>

<span data-ttu-id="e80d0-123">Doporučený model pro webové aplikace ASP.NET Core se aktualizovala tak, aby se podařilo přerušit návrhu logiky, použita v 1.x EF Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="e80d0-123">The recommended pattern for ASP.NET Core web applications has been updated for 2.0 in a way that broke the design-time logic EF Core used in 1.x.</span></span> <span data-ttu-id="e80d0-124">Dříve v době návrhu, EF Core se pokusit o vyvolání `Startup.ConfigureServices` přímo, aby bylo možné získat přístup k poskytovateli služby vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="e80d0-124">Previously at design-time, EF Core would try to invoke `Startup.ConfigureServices` directly in order to access the application's service provider.</span></span> <span data-ttu-id="e80d0-125">V technologii ASP.NET Core 2.0, je konfigurace inicializována mimo `Startup` třídy.</span><span class="sxs-lookup"><span data-stu-id="e80d0-125">In ASP.NET Core 2.0, Configuration is initialized outside of the `Startup` class.</span></span> <span data-ttu-id="e80d0-126">Aplikace obvykle pomocí EF Core k jejich připojovací řetězec z konfigurace, takže `Startup` sám o sobě už nestačí.</span><span class="sxs-lookup"><span data-stu-id="e80d0-126">Applications using EF Core typically access their connection string from Configuration, so `Startup` by itself is no longer sufficient.</span></span> <span data-ttu-id="e80d0-127">Pokud upgradujete aplikaci ASP.NET Core 1.x, může zobrazit následující chyba, při používání nástrojů EF Core.</span><span class="sxs-lookup"><span data-stu-id="e80d0-127">If you upgrade an ASP.NET Core 1.x application, you may receive the following error when using the EF Core tools.</span></span>

> <span data-ttu-id="e80d0-128">Na 'ApplicationContext' nebyl nalezen žádný konstruktor bez parametrů.</span><span class="sxs-lookup"><span data-stu-id="e80d0-128">No parameterless constructor was found on 'ApplicationContext'.</span></span> <span data-ttu-id="e80d0-129">Přidejte konstruktor bez parametrů "ApplicationContext" nebo implementace "IDesignTimeDbContextFactory&lt;ApplicationContext&gt;" ve stejném sestavení jako "ApplicationContext.</span><span class="sxs-lookup"><span data-stu-id="e80d0-129">Either add a parameterless constructor to 'ApplicationContext' or add an implementation of 'IDesignTimeDbContextFactory&lt;ApplicationContext&gt;' in the same assembly as 'ApplicationContext'</span></span>

<span data-ttu-id="e80d0-130">Byl přidán nový hook návrhu v výchozí šablony ASP.NET Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="e80d0-130">A new design-time hook has been added in ASP.NET Core 2.0's default template.</span></span> <span data-ttu-id="e80d0-131">Statické `Program.BuildWebHost` metoda umožňuje EF Core při přístupu k poskytovateli služby vaší aplikace v době návrhu.</span><span class="sxs-lookup"><span data-stu-id="e80d0-131">The static `Program.BuildWebHost` method enables EF Core to access the application's service provider at design time.</span></span> <span data-ttu-id="e80d0-132">Pokud provádíte upgrade aplikace ASP.NET Core 1.x, budete muset aktualizovat `Program` třídy tak, aby připomínala následující.</span><span class="sxs-lookup"><span data-stu-id="e80d0-132">If you are upgrading an ASP.NET Core 1.x application, you will need to update you `Program` class to resemble the following.</span></span>

``` csharp
using Microsoft.AspNetCore;
using Microsoft.AspNetCore.Hosting;

namespace AspNetCoreDotNetCore2._0App
{
    public class Program
    {
        public static void Main(string[] args)
        {
            BuildWebHost(args).Run();
        }

        public static IWebHost BuildWebHost(string[] args) =>
            WebHost.CreateDefaultBuilder(args)
                .UseStartup<Startup>()
                .Build();
    }
}
```

## <a name="idbcontextfactory-renamed"></a><span data-ttu-id="e80d0-133">IDbContextFactory přejmenovat</span><span class="sxs-lookup"><span data-stu-id="e80d0-133">IDbContextFactory renamed</span></span>

<span data-ttu-id="e80d0-134">Aby bylo možné podporovat zpracování různých aplikací a dává uživatelům větší kontrolu nad jak jejich `DbContext` se používá v době návrhu, uvádíme, v minulosti `IDbContextFactory<TContext>` rozhraní.</span><span class="sxs-lookup"><span data-stu-id="e80d0-134">In order to support diverse application patterns and give users more control over how their `DbContext` is used at design time, we have, in the past, provided the `IDbContextFactory<TContext>` interface.</span></span> <span data-ttu-id="e80d0-135">V době návrhu, EF Core tools zjistí implementace tohoto rozhraní ve vašem projektu a použijte ji k vytvoření `DbContext` objekty.</span><span class="sxs-lookup"><span data-stu-id="e80d0-135">At design-time, the EF Core tools will discover implementations of this interface in your project and use it to create `DbContext` objects.</span></span>

<span data-ttu-id="e80d0-136">Toto rozhraní má velmi obecný název, který v omyl zkusit znovu použít pro ostatní někteří uživatelé `DbContext`– vytvoření scénářů.</span><span class="sxs-lookup"><span data-stu-id="e80d0-136">This interface had a very general name which mislead some users to try re-using it for other `DbContext`-creating scenarios.</span></span> <span data-ttu-id="e80d0-137">Byla zachycena vypnout guard při nástroje EF poté se pokusil použít jejich implementace v době návrhu a způsobila příkazů, jako jsou `Update-Database` nebo `dotnet ef database update` selhání.</span><span class="sxs-lookup"><span data-stu-id="e80d0-137">They were caught off guard when the EF Tools then tried to use their implementation at design-time and caused commands like `Update-Database` or `dotnet ef database update` to fail.</span></span>

<span data-ttu-id="e80d0-138">Chcete-li komunikovat silné sémantiku návrhu tohoto rozhraní, jsme přejmenovali na `IDesignTimeDbContextFactory<TContext>`.</span><span class="sxs-lookup"><span data-stu-id="e80d0-138">In order to communicate the strong design-time semantics of this interface, we have renamed it to `IDesignTimeDbContextFactory<TContext>`.</span></span>

<span data-ttu-id="e80d0-139">Rozhraní příkazového řádku 2.0 vydání `IDbContextFactory<TContext>` stále existuje, ale je označen jako zastaralý.</span><span class="sxs-lookup"><span data-stu-id="e80d0-139">For the 2.0 release the `IDbContextFactory<TContext>` still exists but is marked as obsolete.</span></span>

## <a name="dbcontextfactoryoptions-removed"></a><span data-ttu-id="e80d0-140">Odebrat DbContextFactoryOptions</span><span class="sxs-lookup"><span data-stu-id="e80d0-140">DbContextFactoryOptions removed</span></span>

<span data-ttu-id="e80d0-141">Z důvodu změn v ASP.NET Core 2.0 je popsáno výše, jsme zjistili, že `DbContextFactoryOptions` byl už je nepotřebujete na novém `IDesignTimeDbContextFactory<TContext>` rozhraní.</span><span class="sxs-lookup"><span data-stu-id="e80d0-141">Because of the ASP.NET Core 2.0 changes described above, we found that `DbContextFactoryOptions` was no longer needed on the new `IDesignTimeDbContextFactory<TContext>` interface.</span></span> <span data-ttu-id="e80d0-142">Tady jsou alternativy, které byste měli použít místo toho.</span><span class="sxs-lookup"><span data-stu-id="e80d0-142">Here are the alternatives you should be using instead.</span></span>

| <span data-ttu-id="e80d0-143">DbContextFactoryOptions</span><span class="sxs-lookup"><span data-stu-id="e80d0-143">DbContextFactoryOptions</span></span> | <span data-ttu-id="e80d0-144">Alternativní</span><span class="sxs-lookup"><span data-stu-id="e80d0-144">Alternative</span></span>                                                  |
|:------------------------|:-------------------------------------------------------------|
| <span data-ttu-id="e80d0-145">ApplicationBasePath</span><span class="sxs-lookup"><span data-stu-id="e80d0-145">ApplicationBasePath</span></span>     | <span data-ttu-id="e80d0-146">AppContext.BaseDirectory</span><span class="sxs-lookup"><span data-stu-id="e80d0-146">AppContext.BaseDirectory</span></span>                                     |
| <span data-ttu-id="e80d0-147">ContentRootPath</span><span class="sxs-lookup"><span data-stu-id="e80d0-147">ContentRootPath</span></span>         | <span data-ttu-id="e80d0-148">Directory.GetCurrentDirectory()</span><span class="sxs-lookup"><span data-stu-id="e80d0-148">Directory.GetCurrentDirectory()</span></span>                              |
| <span data-ttu-id="e80d0-149">EnvironmentName</span><span class="sxs-lookup"><span data-stu-id="e80d0-149">EnvironmentName</span></span>         | <span data-ttu-id="e80d0-150">Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT")</span><span class="sxs-lookup"><span data-stu-id="e80d0-150">Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT")</span></span> |

## <a name="design-time-working-directory-changed"></a><span data-ttu-id="e80d0-151">Změnit návrhu pracovního adresáře</span><span class="sxs-lookup"><span data-stu-id="e80d0-151">Design-time working directory changed</span></span>

<span data-ttu-id="e80d0-152">ASP.NET Core 2.0 změny také potřebné pracovní adresář, který používá `dotnet ef` souladu s pracovní adresář, který používá sada Visual Studio při spuštění aplikace.</span><span class="sxs-lookup"><span data-stu-id="e80d0-152">The ASP.NET Core 2.0 changes also required the working directory used by `dotnet ef` to align with the working directory used by Visual Studio when running your application.</span></span> <span data-ttu-id="e80d0-153">Jeden pozorovatelný vedlejší účinek tohoto objektu je tento SQLite názvy souborů jsou nyní relativní k adresáři projektu a ne k adresáři výstupu jako dříve.</span><span class="sxs-lookup"><span data-stu-id="e80d0-153">One observable side effect of this is that SQLite filenames are now relative to the project directory and not the output directory like they used to be.</span></span>

## <a name="ef-core-20-requires-a-20-database-provider"></a><span data-ttu-id="e80d0-154">EF Core 2.0 vyžaduje poskytovatele 2.0 databáze</span><span class="sxs-lookup"><span data-stu-id="e80d0-154">EF Core 2.0 requires a 2.0 database provider</span></span>

<span data-ttu-id="e80d0-155">EF Core 2.0 provedli jsme řadu zjednodušení a vylepšení v poskytovatelé databází způsob, jak pracovat.</span><span class="sxs-lookup"><span data-stu-id="e80d0-155">For EF Core 2.0 we have made many simplifications and improvements in the way database providers work.</span></span> <span data-ttu-id="e80d0-156">To znamená, že zprostředkovatele 1.0.x a 1.1.x nebude fungovat s EF Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="e80d0-156">This means that 1.0.x and 1.1.x providers will not work with EF Core 2.0.</span></span>

<span data-ttu-id="e80d0-157">Zprostředkovatele SQL Server a SQLite se dodávají týmem EF, verze 2.0 bude k dispozici jako součást rozhraní příkazového řádku 2.0 release.</span><span class="sxs-lookup"><span data-stu-id="e80d0-157">The SQL Server and SQLite providers are shipped by the EF team and 2.0 versions will be available as part of the 2.0 release.</span></span> <span data-ttu-id="e80d0-158">Zprostředkovatelé open source třetích stran pro [SQL Compact](https://github.com/ErikEJ/EntityFramework.SqlServerCompact), [PostgreSQL](https://github.com/npgsql/Npgsql.EntityFrameworkCore.PostgreSQL), a [MySQL](https://github.com/PomeloFoundation/Pomelo.EntityFrameworkCore.MySql) aktualizované 2.0.</span><span class="sxs-lookup"><span data-stu-id="e80d0-158">The open-source third party providers for [SQL Compact](https://github.com/ErikEJ/EntityFramework.SqlServerCompact), [PostgreSQL](https://github.com/npgsql/Npgsql.EntityFrameworkCore.PostgreSQL), and [MySQL](https://github.com/PomeloFoundation/Pomelo.EntityFrameworkCore.MySql) are being updated for 2.0.</span></span> <span data-ttu-id="e80d0-159">U jiných poskytovatelů obraťte se prosím na poskytovatele zapisovače.</span><span class="sxs-lookup"><span data-stu-id="e80d0-159">For all other providers, please contact the provider writer.</span></span>

## <a name="logging-and-diagnostics-events-have-changed"></a><span data-ttu-id="e80d0-160">Změnil se události protokolování a Diagnostika</span><span class="sxs-lookup"><span data-stu-id="e80d0-160">Logging and Diagnostics events have changed</span></span>

<span data-ttu-id="e80d0-161">Poznámka: tyto změny by neměla mít vliv většinu kódu aplikace.</span><span class="sxs-lookup"><span data-stu-id="e80d0-161">Note: these changes should not impact most application code.</span></span>

<span data-ttu-id="e80d0-162">ID událostí pro zprávy odeslané do [ILogger](https://github.com/aspnet/Logging/blob/dev/src/Microsoft.Extensions.Logging.Abstractions/ILogger.cs) jste změnili ve verzi 2.0.</span><span class="sxs-lookup"><span data-stu-id="e80d0-162">The event IDs for messages sent to an [ILogger](https://github.com/aspnet/Logging/blob/dev/src/Microsoft.Extensions.Logging.Abstractions/ILogger.cs) have changed in 2.0.</span></span> <span data-ttu-id="e80d0-163">ID událostí jsou nyní jedinečné v EF Core kódu.</span><span class="sxs-lookup"><span data-stu-id="e80d0-163">The event IDs are now unique across EF Core code.</span></span> <span data-ttu-id="e80d0-164">Tyto zprávy nyní také použít standardní vzor strukturované protokolování používá, například MVC.</span><span class="sxs-lookup"><span data-stu-id="e80d0-164">These messages now also follow the standard pattern for structured logging used by, for example, MVC.</span></span>

<span data-ttu-id="e80d0-165">Kategorie protokolovací nástroj se také změnily.</span><span class="sxs-lookup"><span data-stu-id="e80d0-165">Logger categories have also changed.</span></span> <span data-ttu-id="e80d0-166">Má nyní prostřednictvím dobře známé sady kategorií [DbLoggerCategory](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/DbLoggerCategory.cs).</span><span class="sxs-lookup"><span data-stu-id="e80d0-166">There is now a well-known set of categories accessed through [DbLoggerCategory](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/DbLoggerCategory.cs).</span></span>

<span data-ttu-id="e80d0-167">[DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md) události teď používají stejné ID názvy událostí jako odpovídající `ILogger` zprávy.</span><span class="sxs-lookup"><span data-stu-id="e80d0-167">[DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md) events now use the same event ID names as the corresponding `ILogger` messages.</span></span> <span data-ttu-id="e80d0-168">Datové části události jsou všechny nominální typy odvozené od [EventData](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/EventData.cs).</span><span class="sxs-lookup"><span data-stu-id="e80d0-168">The event payloads are all nominal types derived from [EventData](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/EventData.cs).</span></span>

<span data-ttu-id="e80d0-169">ID událostí, datové typy a kategorie jsou dokumentovány v článku [CoreEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/CoreEventId.cs) a [RelationalEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore.Relational/Diagnostics/RelationalEventId.cs) třídy.</span><span class="sxs-lookup"><span data-stu-id="e80d0-169">Event IDs, payload types, and categories are documented in the [CoreEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/CoreEventId.cs) and the [RelationalEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore.Relational/Diagnostics/RelationalEventId.cs) classes.</span></span>

<span data-ttu-id="e80d0-170">ID také přesunuli do nového oboru názvů Microsoft.EntityFrameworkCore.Diagnostics z Microsoft.EntityFrameworkCore.Infraestructure.</span><span class="sxs-lookup"><span data-stu-id="e80d0-170">IDs have also moved from Microsoft.EntityFrameworkCore.Infraestructure to the new Microsoft.EntityFrameworkCore.Diagnostics namespace.</span></span>

## <a name="ef-core-relational-metadata-api-changes"></a><span data-ttu-id="e80d0-171">Změny relační metadat rozhraní API EF Core</span><span class="sxs-lookup"><span data-stu-id="e80d0-171">EF Core relational metadata API changes</span></span>

<span data-ttu-id="e80d0-172">EF Core 2.0 nyní vytvořit jiný [IModel](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IModel.cs) pro každý jiný poskytovatel používá.</span><span class="sxs-lookup"><span data-stu-id="e80d0-172">EF Core 2.0 will now build a different [IModel](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IModel.cs) for each different provider being used.</span></span> <span data-ttu-id="e80d0-173">Toto je obvykle zřejmé do aplikace.</span><span class="sxs-lookup"><span data-stu-id="e80d0-173">This is usually transparent to the application.</span></span> <span data-ttu-id="e80d0-174">To má zajišťované zjednodušení nižší úrovně metadat rozhraní API tak, aby žádný přístup k _běžné koncepty relační metadat_ se vždycky provádí pomocí volání `.Relational` místo `.SqlServer`, `.Sqlite`atd. Například 1.1.x kód následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="e80d0-174">This has facilitated a simplification of lower-level metadata APIs such that any access to _common relational metadata concepts_ is always made through a call to `.Relational` instead of `.SqlServer`, `.Sqlite`, etc. For example, 1.1.x code like this:</span></span>

``` csharp
var tableName = context.Model.FindEntityType(typeof(User)).SqlServer().TableName;
```

<span data-ttu-id="e80d0-175">Musí teď zapisují takto:</span><span class="sxs-lookup"><span data-stu-id="e80d0-175">Should now be written like this:</span></span>

``` csharp
var tableName = context.Model.FindEntityType(typeof(User)).Relational().TableName;
```

<span data-ttu-id="e80d0-176">Namísto použití metody, jako je `ForSqlServerToTable`, rozšiřující metody jsou nyní k dispozici pro zápis podmíněný kód podle aktuálního zprostředkovatele používá.</span><span class="sxs-lookup"><span data-stu-id="e80d0-176">Instead of using methods like `ForSqlServerToTable`, extension methods are now available to write conditional code based on the current provider in use.</span></span> <span data-ttu-id="e80d0-177">Příklad:</span><span class="sxs-lookup"><span data-stu-id="e80d0-177">For example:</span></span>

```C#
modelBuilder.Entity<User>().ToTable(
    Database.IsSqlServer() ? "SqlServerName" : "OtherName");
```

<span data-ttu-id="e80d0-178">Všimněte si, že tato změna platí pouze pro rozhraní API nebo metadata, která je definována pro _všechny_ relační poskytovatelů.</span><span class="sxs-lookup"><span data-stu-id="e80d0-178">Note that this change only applies to APIs/metadata that is defined for _all_ relational providers.</span></span> <span data-ttu-id="e80d0-179">Rozhraní API a metadata zůstává při je specifická pro pouze jednoho poskytovatele.</span><span class="sxs-lookup"><span data-stu-id="e80d0-179">The API and metadata remains the same when it is specific to only a single provider.</span></span> <span data-ttu-id="e80d0-180">Clusterované indexy jsou například specifické pro SQL Server, takže `ForSqlServerIsClustered` a `.SqlServer().IsClustered()` musí být použita.</span><span class="sxs-lookup"><span data-stu-id="e80d0-180">For example, clustered indexes are specific to SQL Sever, so `ForSqlServerIsClustered` and  `.SqlServer().IsClustered()` must still be used.</span></span>

## <a name="dont-take-control-of-the-ef-service-provider"></a><span data-ttu-id="e80d0-181">Není převzít kontrolu nad EF poskytovatele služeb</span><span class="sxs-lookup"><span data-stu-id="e80d0-181">Don’t take control of the EF service provider</span></span>

<span data-ttu-id="e80d0-182">EF Core využívá interní `IServiceProvider` (kontejner vkládání závislostí) pro vnitřní implementace.</span><span class="sxs-lookup"><span data-stu-id="e80d0-182">EF Core uses an internal `IServiceProvider` (a dependency injection container) for its internal implementation.</span></span> <span data-ttu-id="e80d0-183">Aplikace by měla umožňovat EF Core k vytváření a správě tohoto zprostředkovatele s výjimkou ve zvláštních případech.</span><span class="sxs-lookup"><span data-stu-id="e80d0-183">Applications should allow EF Core to create and manage this provider except in special cases.</span></span> <span data-ttu-id="e80d0-184">Důkladně zvážit možnost odebrání všechna volání do `UseInternalServiceProvider`.</span><span class="sxs-lookup"><span data-stu-id="e80d0-184">Strongly consider removing any calls to `UseInternalServiceProvider`.</span></span> <span data-ttu-id="e80d0-185">Pokud aplikace potřebuje k volání `UseInternalServiceProvider`, pak zvažte [založením problému](https://github.com/aspnet/EntityFramework/Issues) tak nám prozkoumat další možnosti, jak zpracovat váš scénář.</span><span class="sxs-lookup"><span data-stu-id="e80d0-185">If an application does need to call `UseInternalServiceProvider`, then please consider [filing an issue](https://github.com/aspnet/EntityFramework/Issues) so we can investigate other ways to handle your scenario.</span></span>

<span data-ttu-id="e80d0-186">Volání `AddEntityFramework`, `AddEntityFrameworkSqlServer`, atd. není vyžadován kód aplikace, není-li `UseInternalServiceProvider` se označuje taky jako.</span><span class="sxs-lookup"><span data-stu-id="e80d0-186">Calling `AddEntityFramework`, `AddEntityFrameworkSqlServer`, etc. is not required by application code unless `UseInternalServiceProvider` is also called.</span></span> <span data-ttu-id="e80d0-187">Odeberte všechny existující volání `AddEntityFramework` nebo `AddEntityFrameworkSqlServer`atd `AddDbContext` měli stále použít stejným způsobem jako předtím.</span><span class="sxs-lookup"><span data-stu-id="e80d0-187">Remove any existing calls to `AddEntityFramework` or `AddEntityFrameworkSqlServer`, etc. `AddDbContext` should still be used in the same way as before.</span></span>

## <a name="in-memory-databases-must-be-named"></a><span data-ttu-id="e80d0-188">Musí mít název databáze v paměti</span><span class="sxs-lookup"><span data-stu-id="e80d0-188">In-memory databases must be named</span></span>

<span data-ttu-id="e80d0-189">Globální nepojmenované databáze v paměti jsme odebrali a místo toho musí mít název všechny databáze v paměti.</span><span class="sxs-lookup"><span data-stu-id="e80d0-189">The global unnamed in-memory database has been removed and instead all in-memory databases must be named.</span></span> <span data-ttu-id="e80d0-190">Příklad:</span><span class="sxs-lookup"><span data-stu-id="e80d0-190">For example:</span></span>

``` csharp
optionsBuilder.UseInMemoryDatabase("MyDatabase");
```

<span data-ttu-id="e80d0-191">To vytváří a používá databázi s názvem "Databáze".</span><span class="sxs-lookup"><span data-stu-id="e80d0-191">This creates/uses a database with the name “MyDatabase”.</span></span> <span data-ttu-id="e80d0-192">Pokud `UseInMemoryDatabase` volána znovu se stejným názvem, pak stejnou databázi v paměti se použije, což umožňuje sdílet více instancí kontextu.</span><span class="sxs-lookup"><span data-stu-id="e80d0-192">If `UseInMemoryDatabase` is called again with the same name, then the same in-memory database will be used, allowing it to be shared by multiple context instances.</span></span>

## <a name="read-only-api-changes"></a><span data-ttu-id="e80d0-193">Jen pro čtení změn rozhraní API</span><span class="sxs-lookup"><span data-stu-id="e80d0-193">Read-only API changes</span></span>

<span data-ttu-id="e80d0-194">`IsReadOnlyBeforeSave`, `IsReadOnlyAfterSave`, a `IsStoreGeneratedAlways` bylo vyřazeno a nahradí [BeforeSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L39) a [AfterSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L55).</span><span class="sxs-lookup"><span data-stu-id="e80d0-194">`IsReadOnlyBeforeSave`, `IsReadOnlyAfterSave`, and `IsStoreGeneratedAlways` have been obsoleted and replaced with [BeforeSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L39) and [AfterSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L55).</span></span> <span data-ttu-id="e80d0-195">Tyto chování platí pro všechny vlastnosti (nejen generovaných úložištěm vlastnosti) a určit, jak hodnota vlastnosti má být použita při vkládání do řádku databáze (`BeforeSaveBehavior`) nebo když existující databáze se aktualizuje řádek (`AfterSaveBehavior`).</span><span class="sxs-lookup"><span data-stu-id="e80d0-195">These behaviors apply to any property (not only store-generated properties) and determine how the value of the property should be used when inserting into a database row (`BeforeSaveBehavior`) or when updating an existing database row (`AfterSaveBehavior`).</span></span>

<span data-ttu-id="e80d0-196">Vlastnosti jsou označeny jako [ValueGenerated.OnAddOrUpdate](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/ValueGenerated.cs) (třeba u počítaných sloupcích) bude ve výchozím nastavení ignorovat libovolná hodnota aktuálně nastavená na vlastnost.</span><span class="sxs-lookup"><span data-stu-id="e80d0-196">Properties marked as [ValueGenerated.OnAddOrUpdate](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/ValueGenerated.cs) (for example, for computed columns) will by default ignore any value currently set on the property.</span></span> <span data-ttu-id="e80d0-197">To znamená, že hodnota generovaná úložištěm se budou získávat vždy bez ohledu na to, jestli nastavit nebo změnit u sledovaných entity libovolnou hodnotu.</span><span class="sxs-lookup"><span data-stu-id="e80d0-197">This means that a store-generated value will always be obtained regardless of whether any value has been set or modified on the tracked entity.</span></span> <span data-ttu-id="e80d0-198">To se dá změnit tak, že nastavíte jinou `Before\AfterSaveBehavior`.</span><span class="sxs-lookup"><span data-stu-id="e80d0-198">This can be changed by setting a different `Before\AfterSaveBehavior`.</span></span>

## <a name="new-clientsetnull-delete-behavior"></a><span data-ttu-id="e80d0-199">Nové chování při odstraňování ClientSetNull</span><span class="sxs-lookup"><span data-stu-id="e80d0-199">New ClientSetNull delete behavior</span></span>

<span data-ttu-id="e80d0-200">V předchozích verzích [DeleteBehavior.Restrict](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/DeleteBehavior.cs) měl chování entit sledován pomocí funkce kontextu, že více uzavřený odpovídající `SetNull` sémantiku.</span><span class="sxs-lookup"><span data-stu-id="e80d0-200">In previous releases, [DeleteBehavior.Restrict](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/DeleteBehavior.cs) had a behavior for entities tracked by the context that more closed matched `SetNull` semantics.</span></span> <span data-ttu-id="e80d0-201">V EF Core 2.0 nový `ClientSetNull` chování je zavedený jako výchozí pro volitelné vztahy.</span><span class="sxs-lookup"><span data-stu-id="e80d0-201">In EF Core 2.0, a new `ClientSetNull` behavior has been introduced as the default for optional relationships.</span></span> <span data-ttu-id="e80d0-202">Toto chování je `SetNull` sémantiku sledované entit a `Restrict` chování pro databáze vytvořené využitím EF Core.</span><span class="sxs-lookup"><span data-stu-id="e80d0-202">This behavior has `SetNull` semantics for tracked entities and `Restrict` behavior for databases created using EF Core.</span></span> <span data-ttu-id="e80d0-203">Podle našich zkušeností jedná se očekával/nejužitečnější chování sledované entit a databáze.</span><span class="sxs-lookup"><span data-stu-id="e80d0-203">In our experience, these are the most expected/useful behaviors for tracked entities and the database.</span></span> <span data-ttu-id="e80d0-204">`DeleteBehavior.Restrict` Zachovaný nyní sledované entit, pokud jsou nastavené pro volitelné vztahy.</span><span class="sxs-lookup"><span data-stu-id="e80d0-204">`DeleteBehavior.Restrict` is now honored for tracked entities when set for optional relationships.</span></span>

## <a name="provider-design-time-packages-removed"></a><span data-ttu-id="e80d0-205">Balíčky návrhu zprostředkovatele odebrat</span><span class="sxs-lookup"><span data-stu-id="e80d0-205">Provider design-time packages removed</span></span>

<span data-ttu-id="e80d0-206">`Microsoft.EntityFrameworkCore.Relational.Design` Odebral balíček.</span><span class="sxs-lookup"><span data-stu-id="e80d0-206">The `Microsoft.EntityFrameworkCore.Relational.Design` package has been removed.</span></span> <span data-ttu-id="e80d0-207">Jeho obsah konsolidovalo do `Microsoft.EntityFrameworkCore.Relational` a `Microsoft.EntityFrameworkCore.Design`.</span><span class="sxs-lookup"><span data-stu-id="e80d0-207">It's contents were consolidated into `Microsoft.EntityFrameworkCore.Relational` and `Microsoft.EntityFrameworkCore.Design`.</span></span>

<span data-ttu-id="e80d0-208">To se rozšíří do balíčků návrhu zprostředkovatele.</span><span class="sxs-lookup"><span data-stu-id="e80d0-208">This propagates into the provider design-time packages.</span></span> <span data-ttu-id="e80d0-209">Tyto balíčky (`Microsoft.EntityFrameworkCore.Sqlite.Design`, `Microsoft.EntityFrameworkCore.SqlServer.Design`atd) byly odebrány a jejich obsah konsolidované do hlavní poskytovatel balíčky.</span><span class="sxs-lookup"><span data-stu-id="e80d0-209">Those packages (`Microsoft.EntityFrameworkCore.Sqlite.Design`, `Microsoft.EntityFrameworkCore.SqlServer.Design`, etc.) were removed and their contents consolidated into the main provider packages.</span></span>

<span data-ttu-id="e80d0-210">Chcete-li povolit `Scaffold-DbContext` nebo `dotnet ef dbcontext scaffold` v EF Core 2.0, je potřeba jenom odkazujte na balíček jednoho zprostředkovatele:</span><span class="sxs-lookup"><span data-stu-id="e80d0-210">To enable `Scaffold-DbContext` or `dotnet ef dbcontext scaffold` in EF Core 2.0, you only need to reference the single provider package:</span></span>

``` xml
<PackageReference Include="Microsoft.EntityFrameworkCore.SqlServer"
    Version="2.0.0" />
<PackageReference Include="Microsoft.EntityFrameworkCore.Tools"
    Version="2.0.0"
    PrivateAssets="All" />
<DotNetCliToolReference Include="Microsoft.EntityFrameworkCore.Tools.DotNet"
    Version="2.0.0" />
```
